BigWorld.FolderModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},elementCount:{notEmpty:!0,integer:0}};return{name:"Folder",initData:{elementCount:0},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ItemModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},e={folderId:{id:!0},objectId:{notEmpty:!0,id:!0},objectPart:{notEmpty:!0,size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:t},left:{data:!0,detail:t},up:{data:!0,detail:t},right:{data:!0,detail:t}}}}}}}};return{name:"Item",initData:{kinds:[{name:{en:"Kind 1"}}],states:{}},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.MapModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}};return{name:"Map",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={notEmpty:!0,integer:!0,min:0},e={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},a={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},sectionLevels:{notEmpty:!0,data:!0,detail:{left:t,up:t,right:t,down:t}},sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},touchArea:{notEmpty:!0,data:!0,detail:{x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},width:{notEmpty:!0,integer:!0},height:{notEmpty:!0,integer:!0}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:e},left:{data:!0,detail:e},up:{data:!0,detail:e},right:{data:!0,detail:e}}}}}}}};return{name:"Object",initData:{sectionLevels:{left:0,up:0,right:0,down:0},sectionMap:[[{z:0}]],touchArea:{x:0,y:0,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight},kinds:[{name:{en:"Kind 1"}}],states:{idle:{name:{en:"Idle"},parts:[]}}},methodConfig:{create:{valid:VALID(a)},update:{valid:VALID(a)}}}}}),BigWorld.TileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}}}}}}}},e=[];return REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let t=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{t.push({z:0})}),e.push(t)}),{name:"Tile",initData:{kinds:[{name:{en:"Kind 1"}}],states:{center:{sectionMap:e,parts:[]}}},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.TILE_STATES=["center","left","leftTop","top","rightTop","right","rightBottom","bottom","leftBottom","fillLeftBottom","fillLeftTop","fillRightTop","fillRightBottom"],BigWorld.MapObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={mapId:{notEmpty:!0,id:!0},objectId:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0},state:{notEmpty:!0,size:{max:255}},items:{notEmpty:!0,array:!0,element:{data:!0,detail:{id:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0}}}},direction:{notEmpty:!0,one:["down","right","up","left"]},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},isReverse:{bool:!0}};return{name:"MapObject",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.MapTileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={};EACH(BigWorld.TILE_STATES,e=>{t[e]={notEmpty:!0,integer:!0}});let e={mapId:{notEmpty:!0,id:!0},tileId:{notEmpty:!0,id:!0},kindMap:{notEmpty:!0,data:!0,details:t},col:{notEmpty:!0,integer:!0},row:{notEmpty:!0,integer:!0}};return{name:"MapTile",methodConfig:{create:{valid:VALID(e),role:"System"},update:{valid:VALID(e)}}}}});BigWorld.MAIN=METHOD({run:e=>{BigWorld.MATCH_VIEW({uri:["","folder/{folderId}"],target:BigWorld.Explorer}),BigWorld.MATCH_VIEW({uri:"map/{mapId}",target:BigWorld.MapEditor}),BigWorld.MATCH_VIEW({uri:"tile/{tileId}",target:BigWorld.TileEditor}),BigWorld.MATCH_VIEW({uri:"object/{objectId}",target:BigWorld.ObjectEditor}),BigWorld.MATCH_VIEW({uri:"item/{itemId}",target:BigWorld.ItemEditor})}}),BigWorld.SectionMapPreview=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,o)=>{let i=o.sectionMap,n=o.sectionLevels,r=o.touchAreaInfo,d=o.borderScale,l=o.direction,c=o.isEditMode,a=o.selectSection;CONFIG.BigWorld.tileSectionLevel/2,t.refresh=RAR(()=>{t.empty(),EACH(i,(e,o)=>{EACH(e,(e,i)=>{let r,d;"down"===l&&(r=(i-n.left)*CONFIG.BigWorld.sectionWidth,d=(o-n.up)*CONFIG.BigWorld.sectionHeight),"left"===l&&(r=-(o-n.up)*CONFIG.BigWorld.sectionHeight,d=(i-n.left)*CONFIG.BigWorld.sectionWidth),"up"===l&&(r=-(i-n.left)*CONFIG.BigWorld.sectionWidth,d=-(o-n.up)*CONFIG.BigWorld.sectionHeight),"right"===l&&(r=(o-n.up)*CONFIG.BigWorld.sectionHeight,d=-(i-n.left)*CONFIG.BigWorld.sectionWidth),t.append(SkyEngine.Rect({x:r,y:d,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight,color:e.isTrigger===!0?"rgb(0, 174, 221)":e.isBlock===!0?"rgb(255, 0, 0)":"rgb(0, 255, 0)",alpha:.2,touchArea:c===!0?SkyEngine.Rect({width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}):void 0,on:c===!0?{touchstart:e=>{e.stop()},tap:()=>{a(i,o)}}:void 0}))})}),void 0!==r&&t.append(SkyEngine.Rect({x:r.x,y:r.y,width:r.width,height:r.height,border:d+"px solid #00FF00"}))})}}),BigWorld.Item=CLASS({init:(e,t,o)=>{let i=o.itemData,n=o.kind;t.draw=(e=>{let t=e.object,o=e.state,r=e.direction,d=[];if(void 0!==o&&void 0!==r){let e=i.states[o];void 0!==e&&EACH(e.parts,(e,o)=>{let i=e[r];if(void 0!==i){let e=i.frames[n];void 0!==e&&d.push(SkyEngine.Sprite({src:BigWorld.RF(e),fps:i.fps,frameCount:i.frameCount,zIndex:i.zIndex,x:i.x,y:i.y}).appendTo(t))}})}return d})}}),BigWorld.Map=CLASS(()=>{const e=.3,t=9.99;return{preset:()=>{return SkyEngine.Node},init:(o,i,n)=>{let r=n.mapData,d=n.isMovable,l=n.isZoomable,c=n.minScale,a=n.maxScale,s=n.isToShowGrid,p=n.changeScale,u=n.movePosition,g=n.pickPosition,f=n.contextmenu;void 0===c&&(c=e),void 0===a&&(a=t);let m,k,T=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,I=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,B=T/2,h=I/2,y={},v={},S={},W={},M={},E={},D={},C={},b={},R={},x={},N={},A={},G={},L={},w={},O={},F={},H={},V={},P={};s===!0&&(m=SkyEngine.Node({zIndex:-999999}).appendTo(i));let j,U=SkyEngine.Node({zIndex:-999998}).appendTo(i),_=(e,t)=>{let o=v[e+","+t];if(void 0!==o)return E[o].tileId},z=(e,t)=>{let o=v[e+","+t];if(void 0!==o)return W[o]},X=(e,t,o)=>{let i;i=z(t-1,o),void 0!==i&&i.setRightTileId(e),i=z(t-1,o-1),void 0!==i&&i.setRightBottomTileId(e),i=z(t,o-1),void 0!==i&&i.setBottomTileId(e),i=z(t+1,o-1),void 0!==i&&i.setLeftBottomTileId(e),i=z(t+1,o),void 0!==i&&i.setLeftTileId(e),i=z(t+1,o+1),void 0!==i&&i.setLeftTopTileId(e),i=z(t,o+1),void 0!==i&&i.setTopTileId(e),i=z(t-1,o+1),void 0!==i&&i.setRightTopTileId(e)},Y=(e,t)=>{let o=e.col,i=e.row,n=BigWorld.Tile({col:o,row:i,tileData:t,kindMap:e.kindMap,leftTileId:_(o-1,i),leftTopTileId:_(o-1,i-1),topTileId:_(o,i-1),rightTopTileId:_(o+1,i-1),rightTileId:_(o+1,i),rightBottomTileId:_(o+1,i+1),bottomTileId:_(o,i+1),leftBottomTileId:_(o-1,i+1)}).appendTo(U);n.draw(),W[e.id]=n,X(t.id,o,i)},Z=(e,t,o)=>{void 0!==W[e]&&(W[e].remove(),delete W[e]),X(void 0,t,o)},$=(e,t)=>{let o=BigWorld.Object({objectData:t,kind:e.kind,state:e.state,direction:e.direction,x:e.x,y:e.y,isReverse:e.isReverse}).appendTo(i);M[e.id]=o},K=e=>{void 0!==M[e]&&(M[e].remove(),delete M[e])},q=(e,t,o)=>{let i=M[e];void 0!==i&&i.attachItem({id:t.id,item:BigWorld.Item({itemData:t,kind:o})})},J=(e,t)=>{let o=M[e];void 0!==o&&o.removeItem(itemData.id)},Q=(e,t)=>{if(void 0===N[e]){N[e]=0,BigWorld.TileModel.get(e,t=>{void 0!==N[e]&&(R[e]=t,EACH(A[e],e=>{e(t)}),delete A[e])});let t=BigWorld.ROOM("Tile/"+e);t.on("update",t=>{R[e]=t}),t.on("remove",()=>{ee(e)}),x[e]=t}void 0!==R[e]?t(R[e]):(void 0===A[e]&&(A[e]=[]),A[e].push(t)),N[e]+=1},ee=e=>{N[e]-=1,0===N[e]&&(x[e].exit(),delete R[e],delete x[e],delete N[e])},te=(e,t)=>{if(void 0===w[e]){w[e]=0,BigWorld.ObjectModel.get(e,t=>{void 0!==w[e]&&(G[e]=t,EACH(O[e],e=>{e(t)}),delete O[e])});let t=BigWorld.ROOM("Object/"+e);t.on("update",t=>{G[e]=t}),t.on("remove",()=>{oe(e)}),L[e]=t}void 0!==G[e]?t(G[e]):(void 0===O[e]&&(O[e]=[]),O[e].push(t)),w[e]+=1},oe=e=>{w[e]-=1,0===w[e]&&(L[e].exit(),delete G[e],delete L[e],delete w[e])},ie=(e,t)=>{if(void 0===V[e]){V[e]=0,BigWorld.ItemModel.get(e,t=>{void 0!==V[e]&&(F[e]=t,EACH(P[e],e=>{e(t)}),delete P[e])});let t=BigWorld.ROOM("Item/"+e);t.on("update",t=>{F[e]=t}),t.on("remove",()=>{ne(e)}),H[e]=t}void 0!==F[e]?t(F[e]):(void 0===P[e]&&(P[e]=[]),P[e].push(t)),V[e]+=1},ne=e=>{V[e]-=1,0===V[e]&&(H[e].exit(),delete F[e],delete H[e],delete V[e])},re=e=>{let t=E[e],o=t.col+","+t.row;delete v[o],ee(t.tileId),delete E[e],D[e].exit(),delete D[e],Z(e,t.col,t.row)},de=e=>{let t=C[e],o=Math.round(t.x/T)+","+Math.round(t.y/I);REMOVE({array:S[o],value:e}),oe(t.objectId),t.items.forEach(e=>{ne(e.id)}),delete C[e],b[e].exit(),delete b[e],K(e)},le=e=>{let t=e.col+","+e.row;if(void 0!==y[t]){v[t]=e.id,Q(e.tileId,t=>{Y(e,t)});let o=BigWorld.ROOM("MapTile/"+e.id);o.on("update",t=>{t.tileId!==e.tileId&&(ee(e.tileId),Q(t.tileId,o=>{Z(e.id,e.col,e.row),Y(t,o)})),E[e.id]=t,e=t}),o.on("remove",()=>{re(e.id)}),E[e.id]=e,D[e.id]=o}},ce=e=>{let t=Math.round(e.x/T)+","+Math.round(e.y/I);if(void 0!==y[t]){S[t].push(e.id),te(e.objectId,t=>{$(e,t)}),e.items.forEach(t=>{ie(t.id,o=>{q(e.id,o,t.kind)})});let o=BigWorld.ROOM("MapObject/"+e.id);o.on("update",t=>{t.objectId!==e.objectId&&(oe(e.objectId),te(t.objectId,o=>{K(e.id),$(t,o)})),e.items.forEach(o=>{let i=!0;t.items.forEach(e=>{if(o.id===e.id)return i=!1,!1}),i===!0&&(ne(o.id),J(e.id,itemData.id))}),t.items.forEach(o=>{let i=!0;e.items.forEach(e=>{if(o.id===e.id)return i=!1,!1}),i===!0&&ie(o.id,e=>{q(t.id,e,o.kind)})}),C[e.id]=t,e=t}),o.on("remove",()=>{de(e.id)}),C[e.id]=e,b[e.id]=o}},ae=e=>{y[e].exit();let t=v[e];void 0!==t&&re(t),S[e].forEach(de),delete y[e],delete v[e],delete S[e]},se=RAR(()=>{let e=WIN_WIDTH()/2/i.getScaleX(),t=WIN_HEIGHT()/2/i.getScaleY(),o=-i.getX()/i.getScaleX()-e,n=-i.getY()/i.getScaleY()-t,d=BigWorld.Tile.getTileCol(o,n)-1,l=BigWorld.Tile.getTileRow(o,n)-1,c=-i.getX()/i.getScaleX()+e,a=-i.getY()/i.getScaleY()+t,p=BigWorld.Tile.getTileCol(c,a)+1,u=BigWorld.Tile.getTileRow(c,a)+1,g={};for(let f=d;f<=p;f+=1)for(let v=l;v<=u;v+=1)g[f+","+v]={col:f,row:v};EACH(y,(e,t)=>{void 0!==g[t]?delete g[t]:ae(t)});let W=[],M=[];EACH(g,(e,t)=>{let o=BigWorld.ROOM("Zone/"+t);o.on("putTile",le),o.on("putObject",ce),y[t]=o,S[t]=[];let i=e.col,n=e.row;W.push({mapId:r.id,col:i,row:n});let d=BigWorld.Tile.getTileX(i,n),l=BigWorld.Tile.getTileY(i,n);M.push({mapId:r.id,x:{$gt:d-B,$lte:d+B},y:{$gt:l-h,$lte:l+h}})}),W.length>0&&BigWorld.MapTileModel.find({filter:{$or:W}},EACH(le)),M.length>0&&BigWorld.MapObjectModel.find({filter:{$or:M}},EACH(ce)),s===!0&&(void 0!==k&&k.remove(),k=DELAY(.3,()=>{k=void 0,m.empty();for(let e=d;e<=p;e+=1)for(let t=l;t<=u;t+=1)SkyEngine.Rect({x:e*T,y:t*I,width:T,height:I,border:1/i.getScaleX()+"px solid #000666",color:"#000333"}).appendTo(m);[SkyEngine.Rect({width:3/i.getScaleX(),height:3/i.getScaleX(),color:"#000FFF"}),SkyEngine.Line({startX:-200,endX:200,border:1/i.getScaleX()+"px solid #000FFF"}),SkyEngine.Line({startY:-200,endY:200,border:1/i.getScaleX()+"px solid #000FFF"})].forEach(m.append)}))});i.findMapTileId=(e=>{let t=e.col,o=e.row;return v[t+","+o]}),i.findMapObjectId=(e=>{let t,o=e.x,i=e.y,n=Math.round(o/BigWorld.Tile.getTileWidth()),r=Math.round(i/BigWorld.Tile.getTileHeight()),d=-999999;for(let l=n-2;l<=n+2;l+=1)for(let c=r-2;c<=r+2;c+=1){let e=S[l+","+c];void 0!==e&&e.forEach(e=>{let n=M[e],r=G[C[e].objectId].touchArea;o>=n.getX()+r.x-r.width/2&&o<=n.getX()+r.x+r.width/2&&i>=n.getY()+r.y-r.height/2&&i<=n.getY()+r.y+r.height/2&&d<n.getZIndex()&&(d=n.getZIndex(),t=e)})}return t});OVERRIDE(i.setScale,e=>{j=i.setScale=(t=>{t<c&&(t=c),t>a&&(t=a),e(t),void 0!==p&&p(t)})});let pe;OVERRIDE(i.setPosition,e=>{pe=i.setPosition=(t=>{e(t),se(),void 0!==u&&u(i.getX(),i.getY())})});let ue,ge,fe=(i.setCursorNode=(e=>{let t=e.node,o=e.moveType;void 0!==ue&&ue.remove(),ue=t,ge=o,t.appendTo(i)}),i.setCursorNodeMoveType=(e=>{ge=e}),i.removeCursorNode=(()=>{void 0!==ue&&(ue.remove(),ue=void 0)}),EVENT("resize",se)),me=DIV({style:{position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:-1},on:{touchmove:e=>{if(void 0!==ue){let t=(e.getLeft()-WIN_WIDTH()/2-i.getX())/i.getScaleX(),o=(e.getTop()-WIN_HEIGHT()/2-i.getY())/i.getScaleY();"tile"===ge?(t=Math.round(t/BigWorld.Tile.getTileWidth())*BigWorld.Tile.getTileWidth(),o=Math.round(o/BigWorld.Tile.getTileHeight())*BigWorld.Tile.getTileHeight()):"section"===ge&&(t=Math.round(t/CONFIG.BigWorld.sectionWidth)*CONFIG.BigWorld.sectionWidth,o=Math.round(o/CONFIG.BigWorld.sectionHeight)*CONFIG.BigWorld.sectionHeight),ue.setPosition({x:t,y:o})}},touchstart:e=>{if(0===e.getButtonIndex()&&void 0!==g){let t=e.getLeft(),o=e.getTop();EVENT_ONCE("touchend",e=>{if(Math.sqrt(Math.pow(e.getLeft()-t,2)+Math.pow(e.getTop()-o,2))<5){let t=(e.getLeft()-WIN_WIDTH()/2-i.getX())/i.getScaleX(),o=(e.getTop()-WIN_HEIGHT()/2-i.getY())/i.getScaleY(),n=Math.round(t/CONFIG.BigWorld.sectionWidth),r=Math.round(o/CONFIG.BigWorld.sectionHeight),d=Math.round(t/BigWorld.Tile.getTileWidth()),l=Math.round(o/BigWorld.Tile.getTileHeight());g(t,o,n,r,d,l)}})}},contextmenu:e=>{if(void 0!==f){let t=(e.getLeft()-WIN_WIDTH()/2-i.getX())/i.getScaleX(),o=(e.getTop()-WIN_HEIGHT()/2-i.getY())/i.getScaleY(),n=Math.round(t/CONFIG.BigWorld.sectionWidth),r=Math.round(o/CONFIG.BigWorld.sectionHeight),d=Math.round(t/BigWorld.Tile.getTileWidth()),l=Math.round(o/BigWorld.Tile.getTileHeight());f(e,t,o,n,r,d,l)}}}}).appendTo(BODY);i.getController=(()=>{return me});l===!0&&me.on("wheel",e=>{let t=i.getX()/i.getScaleX(),o=i.getY()/i.getScaleY();j(i.getScaleX()+e.getWheelDelta()/1e3),pe({x:t*i.getScaleX(),y:o*i.getScaleY()})});d===!0&&EVENT_LOW({name:"mousedown",node:me},e=>{let t=e.getLeft(),o=e.getTop(),n=i.getX(),r=i.getY(),d=EVENT_LOW("mousemove",e=>{pe({x:n+e.getLeft()-t,y:r+e.getTop()-o})}),l=EVENT_LOW("mouseup",()=>{d.remove(),l.remove()})});let ke,Te,Ie;EVENT_LOW({name:"touchstart",node:me},e=>{ke=void 0,Te=void 0,Ie=void 0}),EVENT_LOW({name:"touchmove",node:me},e=>{if(l===!0&&e.getPositions().length>=2){let t=e.getPositions()[0],o=e.getPositions()[1],n=Math.sqrt(Math.pow(o.left-t.left,2)+Math.pow(o.top-t.top,2));if(void 0!==ke){let e=i.getX()/i.getScaleX(),t=i.getY()/i.getScaleY();j(i.getScaleX()+(n-ke)/100),pe({x:e*i.getScaleX(),y:t*i.getScaleY()})}ke=n}else if(d===!0&&void 0===ke){let t=e.getLeft(),o=e.getTop();void 0!==Te&&void 0!==Ie&&Math.abs(t-Te)<50&&Math.abs(o-Ie)<50&&pe({x:i.getX()+t-Te,y:i.getY()+o-Ie}),Te=t,Ie=o}}),i.on("remove",()=>{me.remove(),fe.remove()})}}}),BigWorld.Object=CLASS({preset:()=>{return SkyEngine.Node},params:()=>{return{isY2ZIndex:!0}},init:(e,t,o)=>{let i=o.objectData,n=o.kind,r=o.state,d=o.direction,l=o.isReverse,c=[],a={},s=RAR(()=>{EACH(c,e=>{e.remove()}),c=[];let e=i.states[r];void 0!==e&&EACH(e.parts,(e,o)=>{let i=e[d];if(void 0!==i){let e=i.frames[n];void 0!==e&&c.push(SkyEngine.Sprite({src:BigWorld.RF(e),fps:i.fps,frameCount:i.frameCount,zIndex:i.zIndex,x:i.x,y:i.y}).appendTo(t))}}),EACH(a,e=>{EXTEND({origin:c,extend:e.draw({object:t,state:r,direction:d})})})});l===!0&&t.flipX();t.reverse=(()=>{l=l!==!0,t.flipX()}),t.attachItem=(e=>{let t=e.id,o=e.item;a[t]=o,s()}),t.removeItem=(e=>{delete a[e],s()})}}),BigWorld.Tile=CLASS(e=>{let t=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,o=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,i=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let e=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{e.push({z:0})}),i.push(e)});e.getInitSectionMap=(()=>{return i}),e.getTileWidth=((e,o)=>{return t}),e.getTileHeight=((e,t)=>{return o}),e.getTileCol=((e,o)=>{return Math.round(e/t)}),e.getTileRow=((e,o)=>{return Math.round(o/t)}),e.getTileX=((e,o)=>{return e*t}),e.getTileY=((e,t)=>{return t*o});return{preset:()=>{return SkyEngine.Node},init:(e,i,n)=>{let r=n.col,d=n.row,l=n.tileData,c=n.kindMap,a=n.leftTileId,s=n.leftTopTileId,p=n.topTileId,u=n.rightTopTileId,g=n.rightTileId,f=n.rightBottomTileId,m=n.bottomTileId,k=n.leftBottomTileId;i.setX(r*t),i.setY(d*o);let T=(e,t,o)=>{let n=[],r=l.states[e];return void 0!==r&&EACH(r.parts,(r,d)=>{let l=r.frames[c[e][d]];void 0!==l&&n.push(SkyEngine.Sprite({src:BigWorld.RF(l),fps:r.fps,frameCount:r.frameCount,zIndex:r.zIndex,x:i.getX()+r.x+t,y:i.getY()+r.y+o}).appendTo(i.getParent()))}),n},I=[],B=[],h=[],y=[],v=[],S=[],W=[],M=[],E=[],D=e=>{e.forEach(e=>{e.remove()})},C=()=>{D(B),B=a!==l.id?s===l.id&&k===l.id?T("center",-t,0):s===l.id?T("fillRightTop",-t,0):k===l.id?T("fillRightBottom",-t,0):T("left",-t,0):[]},b=()=>{D(h),h=a!==l.id&&s!==l.id&&p!==l.id?T("leftTop",-t,-o):[]},R=()=>{D(y),y=p!==l.id?s===l.id&&u===l.id?T("center",0,-o):s===l.id?T("fillLeftBottom",0,-o):u===l.id?[]:T("top",0,-o):[]},x=()=>{D(v),v=p!==l.id&&u!==l.id&&g!==l.id?T("rightTop",t,-o):[]},N=()=>{D(S),S=g!==l.id?u===l.id&&f===l.id?T("center",t,0):u===l.id?T("fillLeftTop",t,0):f===l.id?[]:T("right",t,0):[]},A=()=>{D(W),W=g!==l.id&&f!==l.id&&m!==l.id?T("rightBottom",t,o):[]},G=()=>{D(M),M=m!==l.id?k===l.id&&f===l.id?T("center",0,o):k===l.id?[]:f===l.id?[]:T("bottom",0,o):[]},L=()=>{D(E),E=m!==l.id&&k!==l.id&&a!==l.id?T("leftBottom",-t,o):[]};i.draw=(()=>{D(I),I=T("center",0,0),C(),b(),R(),x(),N(),A(),G(),L()});i.on("remove",()=>{D(I),D(B),D(h),D(y),D(v),D(S),D(W),D(M),D(E)});i.setLeftTileId=(e=>{a=e,C(),b(),L()}),i.setLeftTopTileId=(e=>{s=e,C(),b(),R()}),i.setTopTileId=(e=>{p=e,b(),R(),x()}),i.setRightTopTileId=(e=>{u=e,R(),x(),N()}),i.setRightTileId=(e=>{g=e,x(),N(),A()}),i.setRightBottomTileId=(e=>{f=e,N(),A(),G()}),i.setBottomTileId=(e=>{m=e,A(),G(),L()}),i.setLeftBottomTileId=(e=>{k=e,G(),L(),C()})}}}),OVERRIDE(BigWorld.MapTileModel,e=>{BigWorld.MapTileModel=OBJECT({preset:()=>{return e},init:(e,t)=>{t.put=((e,o)=>{t.getRoom().send({methodName:"put",data:e},o)})}})}),BigWorld.ExplorerElement=CLASS({preset:()=>{return DIV},params:()=>{return{style:{flt:"left",padding:10}}},init:(e,t,o)=>{let i,n=o.type,r=o.name;t.append(i=UUI.BUTTON({icon:IMG({src:BigWorld.R("explorer/element/"+n+".png"),on:{touchstart:e=>{e.stopDefault()}}}),title:r})),t.on("mouseover",()=>{t.addStyle({backgroundColor:void 0!==BROWSER_CONFIG.SkyDesktop&&"dark"===BROWSER_CONFIG.SkyDesktop.theme?"#003333":"#AFCEFF"})}),t.on("mouseout",()=>{t.addStyle({backgroundColor:"transparent"})});t.changeName=(e=>{r=e,i.setTitle(r)})}}),BigWorld.PartEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n,r,d,l,c,a,s=o.partInfo,p=o.kind,u=o.direction,g=o.save,f=o.removePart,m={zIndex:0,frameCount:1,x:0,y:0,frames:[]};t.append(TABLE({c:TR({c:[TD({style:{width:250},c:r=FORM({style:{position:"relative",backgroundColor:"#ccc",padding:10,width:230},c:[d=UUI.FULL_INPUT({style:{flt:"left",width:100},name:"name.ko",placeholder:"이름 (한국어)",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{flt:"right",width:100},name:"zIndex",placeholder:"z-index",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"frameCount",placeholder:"프레임 수",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"fps",placeholder:"FPS",on:{change:()=>{n===!0&&r.submit()}}}),DIV({style:{marginTop:10,flt:"left",width:110},c:[l=UUI.FULL_INPUT({style:{flt:"left",width:48},name:"x",placeholder:"X",on:{change:()=>{n===!0&&r.submit()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/left.png")}),on:{tap:()=>{T(),g()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/right.png")}),on:{tap:()=>{I(),g()}}})]}),DIV({style:{marginTop:10,flt:"right",width:110},c:[c=UUI.FULL_INPUT({style:{flt:"left",width:48},name:"y",placeholder:"Y",on:{change:()=>{n===!0&&r.submit()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/up.png")}),on:{tap:()=>{B(),g()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/down.png")}),on:{tap:()=>{h(),g()}}})]}),CLEAR_BOTH(),UUI.FULL_UPLOAD_FORM({style:{marginTop:10},box:BigWorld},{overSizeFile:()=>{SkyDesktop.Alert({msg:"업로드 용량을 초과했습니다. "+CONFIG.maxUploadFileMB+"MB 이하의 파일을 올려주세요."})},success:e=>{"image/png"===e.type?(k(e.id),r.submit()):SkyDesktop.Alert({msg:"PNG 파일만 등록할 수 있습니다."})}}),UUI.ICON_BUTTON({style:{position:"absolute",right:-10,top:-10},icon:IMG({src:BigWorld.R("parteditor/x.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 ["+MSG(s.name)+"] 파트를 제거하시겠습니까?"},()=>{f(),t.remove()})}}})],on:{submit:()=>{let e=r.getData();s.name=e.name,void 0===u?(s.zIndex=INTEGER(e.zIndex),s.frameCount=INTEGER(e.frameCount),s.fps=""===e.fps?TO_DELETE:INTEGER(e.fps),s.x=INTEGER(e.x),s.y=INTEGER(e.y),void 0!==i&&(s.frames[p]=i)):(void 0===s[u]&&(s[u]={frames:[]}),s[u].zIndex=INTEGER(e.zIndex),s[u].frameCount=INTEGER(e.frameCount),s[u].fps=""===e.fps?TO_DELETE:INTEGER(e.fps),s[u].x=INTEGER(e.x),s[u].y=INTEGER(e.y),void 0!==i&&(s[u].frames[p]=i)),g()}}})}),a=TD({style:{paddingLeft:15}})]})})),r.setData(void 0===u?s:void 0===s[u]?m:s[u]),void 0!==u&&d.setValue(s.name.ko);let k=e=>{i=e,a.empty(),a.append(IMG({style:{border:"1px solid #ccc",maxHeight:160},src:BigWorld.RF(i)}))};void 0===u?void 0!==s.frames[p]&&k(s.frames[p]):void 0!==s[u]&&void 0!==s[u].frames[p]&&k(s[u].frames[p]),n=!0;let T=t.moveLeft1Pixel=(()=>{n=!1,void 0===u?(s.x-=1,l.setValue(s.x)):(void 0===s[u]&&(s[u]=m),s[u].x-=1,l.setValue(s[u].x)),n=!0}),I=t.moveRight1Pixel=(()=>{n=!1,void 0===u?(s.x+=1,l.setValue(s.x)):(void 0===s[u]&&(s[u]=m),s[u].x+=1,l.setValue(s[u].x)),n=!0}),B=t.moveUp1Pixel=(()=>{n=!1,void 0===u?(s.y-=1,c.setValue(s.y)):(void 0===s[u]&&(s[u]=m),s[u].y-=1,c.setValue(s[u].y)),n=!0}),h=t.moveDown1Pixel=(()=>{n=!1,void 0===u?(s.y+=1,c.setValue(s.y)):(void 0===s[u]&&(s[u]=m),s[u].y+=1,c.setValue(s[u].y)),n=!0})}}),BigWorld.PartsEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n,r=o.stateInfos,d=o.state,l=o.kind,c=o.direction,a=o.save;t.append(DIV({c:[SkyDesktop.Button({style:{flt:"left"},icon:IMG({src:BigWorld.R("parteditor/part.png")}),title:"파트 추가",on:{tap:()=>{let e=r[d];void 0===e&&(e=r[d]={parts:[]});let t;t=void 0===c?{name:{ko:"파트 "+e.parts.length},zIndex:0,frameCount:1,x:0,y:0,frames:[]}:{name:{ko:"파트 "+e.parts.length}},e.parts.push(t),s(t),a()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/left.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveLeft1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/right.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveRight1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/up.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveUp1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/down.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveDown1Pixel()}),a())}}}),CLEAR_BOTH(),P({style:{marginTop:5},c:"방향 버튼을 누르면 모든 파트들의 위치를 1픽셀 이동시킵니다."}),n=DIV()]}));let s=t.addPartEditor=(e=>{n.append(BigWorld.PartEditor({style:{marginTop:10},partInfo:e,kind:l,direction:i,save:a,removePart:()=>{REMOVE({array:r[d].parts,value:e}),void 0===r[d].name&&0===r[d].parts.length&&delete r[d],a()}}))});t.changeDirection=(e=>{i=e,n.empty();let t=r[d];void 0!==t&&EACH(t.parts,s)})}}),BigWorld.SectionEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n=o.mode,r=o.sectionMap,d=o.sectionLevels,l=o.touchAreaInfo,c=o.save,a=o.changeDirection,s=o.refresh,p=BigWorld.STORE("sectionEditorStore"),u="down",g="tile"===n?0:107;t.append(i=SkyEngine.SubScreen({style:{flt:"left",backgroundColor:"#666",color:"#fff"},width:414,height:414,y:g}));let f,m=EVENT("keydown",e=>{"Control"===e.getKey()&&(f=!0)}),k=EVENT("keyup",e=>{"Control"===e.getKey()&&(f=!1)});t.on("remove",()=>{m.remove(),k.remove()}),void 0===p.get("isToShowSection")&&p.save({name:"isToShowSection",value:!0});let T,I=t.refresh=RAR(()=>{i.empty(),EACH([SkyEngine.Rect({width:3/i.getScaleX(),height:3/i.getScaleX(),color:"#00FFFF"}),SkyEngine.Line({startX:-207/i.getScaleX(),endX:207/i.getScaleX(),border:1/i.getScaleX()+"px solid #00FFFF"}),SkyEngine.Line({startY:(-207-g)/i.getScaleX(),endY:(207-g)/i.getScaleX(),border:1/i.getScaleX()+"px solid #00FFFF"})],i.append),s(i,u),"item"!==n&&(i.append(T=BigWorld.SectionMapPreview({zIndex:999999,sectionMap:r,sectionLevels:d,touchAreaInfo:l,borderScale:1/i.getScaleX(),direction:u,isEditMode:!0,selectSection:(e,t)=>{let o=r[t][e];f===!0?(o.isTrigger===!0?delete o.isTrigger:o.isTrigger=!0,delete o.isBlock):(o.isTrigger!==!0&&(o.isBlock===!0?delete o.isBlock:o.isBlock=!0),delete o.isTrigger),T.refresh(),c()}})),p.get("isToShowSection")!==!0&&T.hide())});"item"!==n&&(t.addStyle({position:"relative"}),t.append(UUI.FULL_CHECKBOX({style:{position:"absolute",left:10,top:7,fontSize:12},label:"섹션 보기",value:p.get("isToShowSection"),on:{change:(e,t)=>{t.getValue()===!0?T.show():T.hide(),p.save({name:"isToShowSection",value:t.getValue()})}}}))),"tile"!==n&&t.append(DIV({style:{marginLeft:10,flt:"left"},c:["object"===n?DIV({style:{backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"섹션 크기 늘리기"}),SkyDesktop.Button({style:{flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/left.png")}),spacing:0,on:{tap:()=>{d.left+=1,EACH(r,e=>{e.unshift({z:0})}),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/up.png")}),spacing:0,on:{tap:()=>{d.up+=1;let e=[];REPEAT(d.left+d.right+1,()=>{e.push({z:0})}),r.unshift(e),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/right.png")}),spacing:0,on:{tap:()=>{d.right+=1,EACH(r,e=>{e.push({z:0})}),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/down.png")}),spacing:0,on:{tap:()=>{d.down+=1;let e=[];REPEAT(d.left+d.right+1,()=>{e.push({z:0})}),r.push(e),c()}}}),CLEAR_BOTH()]}):void 0,"object"===n?DIV({style:{marginTop:10,backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"섹션 크기 줄이기"}),SkyDesktop.Button({style:{flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/right.png")}),spacing:0,on:{tap:()=>{d.left>=1&&(d.left-=1,EACH(r,e=>{e.shift()}),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/down.png")}),spacing:0,on:{tap:()=>{d.up>=1&&(d.up-=1,r.shift(),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/left.png")}),spacing:0,on:{tap:()=>{d.right>=1&&(d.right-=1,EACH(r,e=>{e.pop()}),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/up.png")}),spacing:0,on:{tap:()=>{d.down>=1&&(d.down-=1,r.pop(),c())}}}),CLEAR_BOTH()]}):void 0,DIV({style:{marginTop:"object"===n?10:0,backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"회전시키기"}),SkyDesktop.Button({style:{flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/down.png")}),spacing:0,on:{tap:()=>{u="down",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/left.png")}),spacing:0,on:{tap:()=>{u="left",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/up.png")}),spacing:0,on:{tap:()=>{u="up",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/right.png")}),spacing:0,on:{tap:()=>{u="right",a(u),I()}}}),CLEAR_BOTH()]}),"object"===n?DIV({style:{marginTop:10,backgroundColor:"#ccc",color:"#000",padding:10,width:214},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"터치 영역 지정"}),UUI.FULL_INPUT({style:{flt:"left",width:92},name:"x",placeholder:"x",value:l.x,on:{change:(e,t)=>{l.x=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{flt:"right",width:92},name:"y",placeholder:"y",value:l.y,on:{change:(e,t)=>{l.y=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:92},name:"width",placeholder:"width",value:l.width,on:{change:(e,t)=>{l.width=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:92},name:"height",placeholder:"height",value:l.height,on:{change:(e,t)=>{l.height=INTEGER(t.getValue()),c()}}}),CLEAR_BOTH()]}):void 0]})),t.append(CLEAR_BOTH());t.setScale=(e=>{i.setScale(e),I()}),t.getDirection=(()=>{return u})}}),BigWorld.TilePreview=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i=o.y;void 0===i&&(i=0);let n,r=(o.changeDirection,o.refresh),d="down";t.append(n=SkyEngine.SubScreen({style:{backgroundColor:"#666",color:"#fff"},width:414,height:414,y:i})),t.addStyle({position:"relative"}),t.append(DIV({style:{position:"absolute",left:10,top:7,fontSize:12},c:"타일 미리보기"}));let l=t.refresh=RAR(()=>{n.empty(),r(n,d)});t.setScale=(e=>{n.setScale(e),l()}),t.getDirection=(()=>{return d})}}),BigWorld.ValidPrompt=METHOD({run:(e,t)=>{let o,i,n,r,d=e.title,l=e.inputName,c=e.placeholder,a=e.value,s=e.inputName2,p=e.placeholder2,u=e.value2,g=e.errorMsgs,f=e.okButtonTitle,m=e.isToSelectObject,k=SkyDesktop.Confirm({okButtonTitle:f,msg:[H2({style:{fontWeight:"bold"},c:d}),m===!0?SkyDesktop.Button({style:{margin:"auto",marginTop:10},icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:"대상 오브젝트 선택",on:{tap:(e,t)=>{BigWorld.SelectObjectPopup((e,i)=>{o=e,t.setTitle(i)})}}}):void 0,i=UUI.VALID_FORM({style:{marginTop:10},errorMsgs:g,errorMsgStyle:{color:"red"},c:[n=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:l,placeholder:c,value:a}),void 0!==s?r=INPUT({style:{marginTop:10,width:222,padding:8,border:"1px solid #999",borderRadius:4},name:s,placeholder:p,value:u}):void 0]})]},()=>{return m===!0?void 0!==r?t(o,n.getValue(),r.getValue(),i.showErrors,k.remove):t(o,n.getValue(),i.showErrors,k.remove):void 0!==r?t(n.getValue(),r.getValue(),i.showErrors,k.remove):t(n.getValue(),i.showErrors,k.remove),!1});n.select()}}),BigWorld.SelectFolderPopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"폴더 선택"}},init:(e,t,o)=>{e.init(o)}}),BigWorld.SelectObjectPopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"오브젝트 선택"}},init:(e,t,o)=>{e.init(o,(t,o)=>{return BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(o,i,n)=>{let r;t.addItem({key:o.id,item:r=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:MSG(o.name),on:{tap:()=>{e.selectElement(r,o.id,MSG(o.name))}}})})}})})}}),BigWorld.SelectPopup=CLASS({init:(e,t,o)=>{let i,n,r,d,l,c,a=o.title,s=BigWorld.STORE("folderOpenedStore"),p=(e,t)=>{let o,i,n=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:t},sort:{createTime:1}},{handler:(t,o,i)=>{let n;e.addItem({key:t.id,item:n=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:s.get(t.id),title:t.name,on:{open:()=>{s.save({name:t.id,value:!0}),p(n,t.id)},close:()=>{s.remove(t.id)},tap:()=>{u(n,void 0===c?t.id:void 0,void 0===c?t.name:void 0)}}})})},success:()=>{void 0!==c&&(o=c(e,t))}});e.on("close",i=(()=>{void 0!==n&&(n(),n=void 0),void 0!==o&&(o(),o=void 0),e.removeAllItems(),e.off("close",i)})),e.on("remove",()=>{void 0!==n&&(n(),n=void 0),void 0!==o&&(o(),o=void 0)})};SkyDesktop.Confirm({style:{onDisplayResize:(e,t)=>{return e>600?{width:500}:{width:"90%"}}},msg:[H2({style:{fontWeight:"bold"},c:a}),SkyDesktop.FileTree({style:{marginTop:8,overflowY:"scroll",padding:8,borderRadius:4,textAlign:"left",backgroundColor:"#000",color:"#fff",onDisplayResize:(e,t)=>{return t>500?{height:300}:{height:150}}},items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/root.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")})),p(i,TO_DELETE)},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")}))},tap:()=>{u(i,void 0===c?TO_DELETE:void 0,void 0===c?"root":void 0)}}})}})],okButtonTitle:"선택 완료"},()=>{return void 0!==r&&void l(r,d)});let u=e.selectElement=((e,t,o)=>{void 0!==n&&n.deselect(),e.select(),n=e,r=t,d=o});e.init=((e,t)=>{l=e,c=t,i.open()})}}),BigWorld.SelectTilePopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"타일 선택"}},init:(e,t,o)=>{e.init(o,(t,o)=>{return BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(o,i,n)=>{let r;t.addItem({key:o.id,item:r=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/menu/tile.png")}),title:o.name,on:{tap:()=>{e.selectElement(r,o.id,o.name)}}})})}})})}}),BigWorld.Explorer=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 탐색기");let o,i,n,r,d,l,c=BigWorld.STORE("folderOpenedStore"),a=[],s=(e,t)=>{let i,r=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:t},sort:{createTime:1}},{handler:(i,r,d,a)=>{let u;e.addItem({key:i.id,item:u=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:c.get(i.id),title:i.name,on:{open:()=>{c.save({name:i.id,value:!0}),s(u,i.id)},close:()=>{c.remove(i.id)},tap:()=>{void 0!==n&&n.deselect(),u.select(),n=u,BigWorld.GO("folder/"+i.id)},touchstart:e=>{l={type:"folder",id:i.id,name:i.name,startLeft:e.getLeft(),startTop:e.getTop()}},touchend:()=>{void 0!==l&&l.id!==i.id&&p(l.type,l.id,i.id)},contextmenu:e=>{g(e,i)}}})}),void 0===n&&i.id===o&&(u.select(),n=u),r(o=>{o.folderId!==(t===TO_DELETE?void 0:t)?(a(),e.removeItem(i.id)):u.setTitle(o.name)}),d(()=>{e.removeItem(i.id)})}});e.on("close",i=(()=>{r(),r=void 0,e.removeAllItems(),e.off("close",i)})),e.on("remove",()=>{void 0!==r&&(r(),r=void 0)})},p=(e,t,o)=>{let i=SkyDesktop.LoadingBar("lime");"folder"===e?BigWorld.FolderModel.update({id:t,folderId:o},()=>{i.done()}):"map"===e?BigWorld.MapModel.update({id:t,folderId:o},()=>{i.done()}):"tile"===e?BigWorld.TileModel.update({id:t,folderId:o},()=>{i.done()}):"object"===e?BigWorld.ObjectModel.update({id:t,folderId:o},()=>{i.done()}):"item"===e&&BigWorld.ItemModel.update({id:t,folderId:o},()=>{i.done()})},u=(e,t,o,i)=>{let n=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"폴더 이동",icon:IMG({src:BigWorld.R("explorer/contextmenu/folder.png")}),on:{tap:()=>{t(),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("explorer/contextmenu/edit.png")}),on:{tap:()=>{o(),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("explorer/contextmenu/remove.png")}),on:{tap:()=>{i(),n.remove()}}})]});e.stop()},g=(e,t)=>{u(e,()=>{BigWorld.SelectFolderPopup(e=>{p("folder",t.id,e)})},()=>{BigWorld.ValidPrompt({title:"폴더 이름 변경",inputName:"name",placeholder:"폴더 이름",value:t.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,o,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 폴더 이름을 입력해주세요."}):BigWorld.FolderModel.update({id:t.id,name:e},{notValid:o,success:i})})},()=>{
SkyDesktop.Confirm({msg:"정말 폴더를 삭제하시겠습니까? 폴더를 삭제하면 폴더 내 모든 요소들이 삭제됩니다."},()=>{let e=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.remove(t.id,()=>{e.done()})})})},f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:35},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/folder.png")}),title:"새 폴더",on:{tap:()=>{BigWorld.ValidPrompt({title:"폴더 생성",inputName:"name",placeholder:"폴더 이름",errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 폴더 이름을 입력해주세요."}):BigWorld.FolderModel.create({folderId:o,name:e},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/map.png")}),title:"새 맵",on:{tap:()=>{BigWorld.ValidPrompt({title:"맵 생성",inputName:"name.ko",placeholder:"맵 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 맵 이름을 입력해주세요."}):BigWorld.MapModel.create({folderId:o,name:{ko:e}},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/tile.png")}),title:"새 타일",on:{tap:()=>{BigWorld.ValidPrompt({title:"타일 생성",inputName:"name",placeholder:"타일 이름",errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 타일 이름을 입력해주세요."}):BigWorld.TileModel.create({folderId:o,name:e},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:"새 오브젝트",on:{tap:()=>{BigWorld.ValidPrompt({title:"오브젝트 생성",inputName:"name.ko",placeholder:"오브젝트 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 오브젝트 이름을 입력해주세요."}):BigWorld.ObjectModel.create({folderId:o,name:{ko:e}},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/item.png")}),title:"새 아이템",on:{tap:()=>{BigWorld.ValidPrompt({title:"아이템 생성",isToSelectObject:!0,inputName:"objectPart",placeholder:"오브젝트 파트",inputName2:"name.ko",placeholder2:"아이템 이름",errorMsgs:{objectPart:{size:e=>{return"최대 "+e.max+"글자입니다."}},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i,n,r)=>{void 0===e?SkyDesktop.Alert({msg:"아이템의 대상이 되는 오브젝트를 선택해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===i.trim()?SkyDesktop.Alert({msg:"생성할 아이템 이름을 입력해주세요."}):BigWorld.ItemModel.create({folderId:o,objectId:e,objectPart:t,name:{ko:i}},{notValid:n,success:r})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:23,c:SkyDesktop.FileTree({items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/root.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")})),s(i,TO_DELETE)},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")}))},tap:()=>{void 0!==n&&n.deselect(),i.select(),n=i,BigWorld.GO("")}}})}})}),SkyDesktop.Tab({size:77,c:[r=DIV(),CLEAR_BOTH()]})]})})})]}).appendTo(BODY);i.open(),e.on("paramsChange",e=>{if(o=e.folderId,void 0===o)o=TO_DELETE,void 0!==n&&n.deselect(),i.select(),n=i;else{let e=t=>{let i=t.getItem(o);void 0!==i?(void 0!==n&&n.deselect(),i.select(),n=i):EACH(t.getItems(),e)};e(i)}EACH(a,e=>{e()}),a=[],r.empty(),NEXT([e=>{o===TO_DELETE?e():BigWorld.FolderModel.get(o,t=>{r.append(BigWorld.ExplorerElement({type:"parentfolder",name:"상위 폴더",on:{tap:()=>{BigWorld.GO(void 0==t.folderId?"":"folder/"+t.folderId)},touchend:()=>{void 0!==l&&p(l.type,l.id,void 0==t.folderId?TO_DELETE:t.folderId)}}})),e()})},e=>{return()=>{a.push(BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"folder",name:e.name,on:{tap:()=>{BigWorld.GO("folder/"+e.id)},touchstart:t=>{l={type:"folder",id:e.id,name:e.name,startLeft:t.getLeft(),startTop:t.getTop()}},touchend:()=>{void 0!==l&&l.id!==e.id&&p(l.type,l.id,e.id)},contextmenu:t=>{g(t,e)}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(e.name)}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.MapModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"map",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("map/"+e.id)},touchstart:t=>{l={type:"map",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("map",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"맵 이름 변경",inputName:"name.ko",placeholder:"맵 이름",value:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 맵 이름을 입력해주세요."}):BigWorld.MapModel.update({id:e.id,name:{ko:t}},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 맵을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.MapModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"tile",name:e.name,on:{tap:()=>{BigWorld.GO_NEW_WIN("tile/"+e.id)},touchstart:t=>{l={type:"tile",id:e.id,name:e.name,startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("tile",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"타일 정보 변경",inputName:"name",placeholder:"타일 이름",value:e.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 타일 이름을 입력해주세요."}):BigWorld.TileModel.update({id:e.id,name:t},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 타일을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(e.name)}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"object",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("object/"+e.id)},touchstart:t=>{l={type:"object",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("object",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"오브젝트 이름 변경",inputName:"name.ko",placeholder:"오브젝트 이름",value:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 오브젝트 이름을 입력해주세요."}):BigWorld.ObjectModel.update({id:e.id,name:{ko:t}},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 오브젝트를 삭제하시겠습니까? 오브젝트를 삭제하면 오브젝트와 연결된 모든 아이템들이 삭제됩니다."},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.ItemModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"item",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("item/"+e.id)},touchstart:t=>{l={type:"item",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("item",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"아이템 정보 변경",inputName:"objectPart",placeholder:"오브젝트 파트",value:e.objectPart,inputName2:"name.ko",placeholder2:"아이템 이름",value2:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i,n)=>{""===t.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===o.trim()?SkyDesktop.Alert({msg:"변경할 아이템 이름을 입력해주세요."}):BigWorld.ItemModel.update({id:e.id,objectPart:t,name:{ko:o}},{notValid:i,success:n})})},()=>{SkyDesktop.Confirm({msg:"정말 아이템을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}}])});let m=EVENT("touchmove",e=>{void 0===d?void 0!==l&&(Math.abs(l.startLeft-e.getLeft())>5||Math.abs(l.startTop-e.getTop())>5)&&(d=DIV({style:{position:"fixed",left:e.getLeft()+10,top:e.getTop()+10},c:l.name}).appendTo(BODY)):d.addStyle({left:e.getLeft()+10,top:e.getTop()+10})}),k=EVENT("touchend",()=>{void 0!==d&&(d.remove(),d=void 0),void 0!==l&&(l=void 0)});e.on("close",()=>{f.remove(),EACH(a,e=>{e()}),m.remove(),k.remove()})}}),BigWorld.ItemEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 아이템 에디터");let o,i,n,r,d,l,c,a,s,p,u,g=BigWorld.STORE("itemEditorStore"),f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/object.png")}),title:"대상 오브젝트",on:{tap:()=>{BigWorld.GO_NEW_WIN("object/"+n.objectId)}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"아이템 정보 변경",inputName:"objectPart",placeholder:"오브젝트 파트",value:n.objectPart,inputName2:"name.ko",placeholder2:"아이템 이름",value2:n.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"변경할 아이템 이름을 입력해주세요."}):(n.objectPart=e,n.name.ko=t,m(),i(),k())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};n.kinds.push(t),m(),T(n.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/remove.png")}),title:"아이템 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"아이템을 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("itemeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:c=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("itemeditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:p=DIV({style:{padding:10}})})]})})})]}).appendTo(BODY),m=()=>{if(void 0!==n){let e=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update(n,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"아이템을 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("아이템을 저장했습니다.")}}),void 0!==u&&u.refresh()}},k=()=>{if(p.empty(),void 0!==r&&void 0!==d){p.append(H3({c:MSG(n.name)+" / 선택된 종류: "+MSG(n.kinds[r].name)+" / 선택된 상태: "+MSG(i.states[d].name)})),p.append(u=BigWorld.SectionEditor({mode:"item",style:{flt:"left",marginTop:10},changeDirection:e=>{e.changeDirection(e)},save:m,refresh:(e,t)=>{let o;e.append(o=BigWorld.Object({objectData:i,kind:0,state:d,direction:t})),o.attachItem({id:n.id,item:BigWorld.Item({itemData:n,kind:r})})}})),p.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:g.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());g.save({name:"scale",value:o}),u.setScale(o),u.refresh()}}})),p.append(CLEAR_BOTH()),void 0!=g.get("scale")&&u.setScale(g.get("scale"));let e;p.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:n.states,state:d,kind:r,save:m})),e.changeDirection(u.getDirection())}},T=(e,t)=>{let o;return l.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==a&&a.deselect(),o.select(),a=o,r=e,k()},contextmenu:e=>{let i=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("itemeditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},m(),o.setTitle(MSG(t.name)),n())}),i.remove()}}}),n.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("itemeditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:n.kinds,value:t});n.kinds.splice(e,1),EACH(n.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),m(),l.removeItem(e),r===e&&(r=0,k())}),i.remove()}}})]});e.stop()}}})}),o};l.open(),c.open(),e.on("paramsChange",e=>{o=e.itemId,a=void 0,s=void 0,l.removeAllItems(),c.removeAllItems(),p.empty(),BigWorld.ItemModel.get(o,e=>{n=e,EACH(e.kinds,(e,t)=>{T(t,e)}),l.getItem(0).tap(),BigWorld.ObjectModel.get(e.objectId,e=>{i=e,EACH(e.states,(e,t)=>{let o;c.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name)+" ("+t+")",on:{tap:()=>{void 0!==s&&s.deselect(),o.select(),s=o,d=t,k()}}})})}),EACH(e.states,(e,t)=>{return c.getItem(t).tap(),!1})})})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{f.remove()})}}),BigWorld.MapEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 맵 에디터");let o,i,n,r,d,l,c,a,s,p,u,g,f=BigWorld.STORE("mapEditorStore"),m={},k="down",T=void 0===f.get("brushSize")?1:f.get("brushSize"),I=f.get("reverseType"),B=DIV({c:[a=UUI.PANEL({style:{position:"fixed",left:0,top:0,height:"100%",overflowY:"auto",backgroundColor:"rgba(0, 0, 0, 0.3)"},contentStyle:{width:200,padding:10,paddingBottom:200},c:[s=H1(),DIV({style:{marginTop:10},c:["스케일: ",p=INPUT({style:{width:30,textAlign:"right"},on:{change:(e,t)=>{let i=REAL(t.getValue());f.save({name:o+".scale",value:i})}}})]}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},icon:IMG({src:BigWorld.R("mapeditor/tile.png")}),spacing:5,title:"타일 선택",on:{tap:()=>{BigWorld.SelectTilePopup(y)}}}),u=DIV({style:{marginTop:10}}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},icon:IMG({src:BigWorld.R("mapeditor/object.png")}),spacing:5,title:"오브젝트 선택",on:{tap:()=>{BigWorld.SelectObjectPopup(v)}}}),g=DIV({style:{marginTop:10}})]})]}).appendTo(BODY),h=()=>{u.empty(),g.empty(),n=void 0,r=void 0,m={},d=void 0,l=void 0,k="down",void 0!==c&&c.removeCursorNode()},y=(e,t)=>{h(),n=e;let i,r,l,a=()=>{void 0!==c&&c.setCursorNode({node:SkyEngine.Rect({x:-999999,y:-999999,centerX:T%2===0?-BigWorld.Tile.getTileWidth()/2:0,centerY:T%2===0?-BigWorld.Tile.getTileHeight()/2:0,width:BigWorld.Tile.getTileWidth()*T,height:BigWorld.Tile.getTileHeight()*T,border:"5px solid #FF0000"}),moveType:"tile"})};u.append(DIV({c:[H2({c:t}),r=SkyEngine.SubScreen({style:{marginTop:10,backgroundColor:"#666",color:"#fff"},width:200,height:200,scale:200/BigWorld.Tile.getTileWidth()/3}),DIV({style:{marginTop:10},c:["브러쉬 크기: ",INPUT({style:{width:30,textAlign:"right"},value:T,on:{keyup:(e,t)=>{T=INTEGER(t.getValue()),T<1&&(T=1),f.save({name:"brushSize",value:T}),a()}}})]}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},title:"이 타일을 기본 타일로",on:{tap:()=>{void 0!==i&&SkyDesktop.Confirm({msg:"정말 기본 타일을 지정하시겠습니까? 기존에 놓아둔 모든 타일이 교체되며, 돌이킬 수 없습니다."},()=>{BigWorld.ValidPrompt({title:"기본 타일 설정",inputName:"colRange",placeholder:"Column 범위",inputName2:"rowRange",placeholder2:"Row 범위"},(e,t,r,l)=>{let c=[];for(let a=-Math.floor((t-1)/2);a<=Math.floor(t/2);a+=1)for(let s=-Math.floor((e-1)/2);s<=Math.floor(e/2);s+=1)c.push({col:s,row:a});let p=UUI.PANEL({style:{zIndex:999,position:"fixed",right:10,bottom:10,backgroundColor:"#FFFFCC",color:"#333",borderRadius:5},contentStyle:{padding:"5px 10px"}}).appendTo(BODY);NEXT(c,[(e,t)=>{let r={};EACH(BigWorld.TILE_STATES,e=>{let t=i.states[e];void 0!==t&&(r[e]=[],EACH(t.parts,(t,o)=>{r[e][o]=void 0===d?RANDOM(t.frames.length):d}))}),BigWorld.MapTileModel.put({mapId:o,tileId:n,kindMap:r,col:e.col,row:e.row},()=>{p.empty(),p.append("Column: "+e.col+", Row: "+e.row+" 타일을 저장했습니다."),t()})},()=>{return()=>{p.remove(),SkyDesktop.Noti("기본 타일 지정이 완료되었습니다.")}}]),l()})})}}})]})),l.open(),BigWorld.TileModel.get(e,e=>{i=e;let t,o,n=RAR(()=>{r.empty();let t={};EACH(BigWorld.TILE_STATES,o=>{let i=e.states[o];void 0!==i&&(t[o]=[],EACH(i.parts,(e,i)=>{t[o][i]=void 0===d?RANDOM(e.frames.length):d}))}),BigWorld.Tile({col:0,row:0,tileData:e,kindMap:t}).appendTo(r).draw(),a()});l.addItem({key:-1,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==t&&t.deselect(),o.select(),t=o,d=void 0,n()}}})}),o.tap(),EACH(e.kinds,(e,o)=>{let i;l.addItem({key:o,item:i=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name),on:{tap:()=>{void 0!==t&&t.deselect(),i.select(),t=i,d=o,n()}}})})})})},v=(e,t)=>{h(),r=e;let o,i,n,a,s;g.append(DIV({c:[H2({c:t}),o=SkyEngine.SubScreen({style:{marginTop:10,backgroundColor:"#666",color:"#fff"},width:200,height:200,y:50,scale:200/BigWorld.Tile.getTileWidth()}),UUI.FULL_CHECKBOX({style:{marginTop:10},label:"섹션 단위로 배치",value:f.get("isCursorNodeMoveTypeSection"),on:{change:(e,t)=>{t.getValue()===!0?c.setCursorNodeMoveType("section"):c.setCursorNodeMoveType("pixel"),f.save({name:"isCursorNodeMoveTypeSection",value:t.getValue()})}}}),UUI.FULL_SELECT({style:{marginTop:10},options:[OPTION({value:"normal",c:"기본"}),OPTION({value:"reverse",c:"반전"}),OPTION({value:"random",c:"랜덤"})],value:I,on:{change:(e,t)=>{f.save({name:"reverseType",value:t.getValue()}),I=t.getValue(),void 0!==s&&s()}}}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:n=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/state.png")}))}}})}})}),SkyDesktop.Tab({style:{marginTop:10},c:DIV({c:[H5({style:{padding:5},c:"아이템"}),a=SkyDesktop.FileTree()]})})]})),i.open(),n.open(),BigWorld.ObjectModel.get(e,t=>{s=RAR(()=>{o.empty();let e;if(o.append(e=BigWorld.Object({objectData:t,kind:void 0===d?0:d,state:l,direction:k,isReverse:"reverse"===I})),EACH(m,(t,o)=>{e.attachItem({id:o,item:BigWorld.Item({itemData:t.itemData,kind:void 0===t.kind?0:t.kind})})}),void 0!==c){let e=BigWorld.Object({x:-999999,y:-999999,objectData:t,kind:void 0===d?0:d,state:l,direction:k,isReverse:"reverse"===I});EACH(m,(t,o)=>{e.attachItem({id:o,item:BigWorld.Item({itemData:t.itemData,kind:void 0===t.kind?0:t.kind})})}),e.append(BigWorld.SectionMapPreview({sectionMap:t.sectionMap,sectionLevels:t.sectionLevels})),c.setCursorNode({node:e,moveType:f.get("isCursorNodeMoveTypeSection")===!0?"section":"pixel"})}});let r,p;i.addItem({key:-1,item:p=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==r&&r.deselect(),p.select(),r=p,d=void 0,s()}}})}),p.tap(),EACH(t.kinds,(e,t)=>{let o;i.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name),on:{tap:()=>{void 0!==r&&r.deselect(),o.select(),r=o,d=t,s()}}})})});let u;EACH(t.states,(e,t)=>{let o;n.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name)+" ("+t+")",on:{tap:()=>{void 0!==u&&u.deselect(),o.select(),u=o,l=t,s()}}})}),void 0===u&&o.tap()}),BigWorld.ItemModel.find({objectId:e},e=>{let t=[];EACH(e,e=>{CHECK_IS_IN({array:t,value:e.objectPart})!==!0&&t.push(e.objectPart)});let o={};EACH(t,t=>{let i;a.addItem({key:t,item:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/part.png")}),title:t,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/part.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/part.png")}))}}})}),i.open(),EACH(e,e=>{if(e.objectPart===t){let n,r=0;i.addItem({key:t,item:n=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/item.png")}),title:MSG(e.name),on:{tap:()=>{void 0!==m[e.id]?(delete m[e.id],n.deselect(),n.close()):(EACH(m,(e,o)=>{e.itemData.objectPart===t&&delete m[o]}),m[e.id]={itemData:e,kind:r},n.select(),n.open()),s()},open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/item.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/item.png")}))}}})}),o[e.id]=n;let d,l;n.addItem({key:-1,item:l=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==d&&d.deselect(),l.select(),d=l,r=void 0,void 0!==m[e.id]&&delete m[e.id].kind,s()}}})}),l.tap(),EACH(e.kinds,(t,o)=>{let i;n.addItem({key:o,item:i=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==d&&d.deselect(),i.select(),d=i,r=o,void 0!==m[e.id]&&(m[e.id].kind=r),s()}}})})})}})})})})};e.on("paramsChange",e=>{o=e.mapId,void 0!==c&&(c.remove(),c=void 0),BigWorld.MapModel.get(o,e=>{i=e,c=BigWorld.Map({mapData:e,scale:f.get(o+".scale"),x:f.get(o+".x"),y:f.get(o+".y"),isMovable:!0,isZoomable:!0,isToShowGrid:!0,changeScale:e=>{p.setValue(e.toFixed(2))},movePosition:(e,t)=>{f.save({name:o+".x",value:e}),f.save({name:o+".y",value:t})},pickPosition:(e,t,i,c,a,s)=>{void 0!==n?BigWorld.TileModel.get(n,e=>{let t={};EACH(BigWorld.TILE_STATES,o=>{let i=e.states[o];void 0!==i&&(t[o]=[],EACH(i.parts,(e,i)=>{t[o][i]=void 0===d?RANDOM(e.frames.length):d}))});for(let i=a-Math.floor((T-1)/2);i<=a+Math.floor(T/2);i+=1)for(let r=s-Math.floor((T-1)/2);r<=s+Math.floor(T/2);r+=1)BigWorld.MapTileModel.put({mapId:o,tileId:n,kindMap:t,col:i,row:r})}):void 0!==r&&(f.get("isCursorNodeMoveTypeSection")===!0&&(e=i*CONFIG.BigWorld.sectionWidth,t=c*CONFIG.BigWorld.sectionHeight),BigWorld.ObjectModel.get(r,i=>{let n;"reverse"===I?n=!0:"random"===I&&(n=0===RANDOM(2)||void 0);let c=[];NEXT(m,[(e,t,o)=>{BigWorld.ItemModel.get(o,i=>{c.push({id:o,kind:void 0===e.kind?RANDOM(i.kinds.length):e.kind}),t()})},()=>{return()=>{BigWorld.MapObjectModel.create({mapId:o,objectId:r,kind:void 0===d?RANDOM(i.kinds.length):d,state:l,items:c,direction:k,x:INTEGER(e),y:INTEGER(t),isReverse:n})}}])}))},contextmenu:(e,t,o,i,n,r,d)=>{let l=c.findMapTileId({col:r,row:d}),a=c.findMapObjectId({x:t,y:o});if(void 0!==a){let t=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"오브젝트 제거",icon:IMG({src:BigWorld.R("mapeditor/remove.png")}),on:{tap:()=>{BigWorld.MapObjectModel.remove(a),t.remove()}}})]})}else if(void 0!==l){let t=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"타일 제거",icon:IMG({src:BigWorld.R("mapeditor/remove.png")}),on:{tap:()=>{BigWorld.MapTileModel.remove(l),t.remove()}}})]})}e.stop()}}).appendTo(SkyEngine.Screen),s.empty(),s.append(MSG(e.name)),p.setValue(c.getScaleX())})});let S=EVENT("keydown",e=>{"Escape"===e.getKey()&&h()});e.on("close",()=>{void 0!==c&&c.remove(),S.remove(),B.remove()})}}),BigWorld.ObjectEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 오브젝트 에디터");let o,i,n,r,d,l,c,a,s,p,u=BigWorld.STORE("objectEditorStore"),g=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"오브젝트 이름 변경",inputName:"name.ko",placeholder:"오브젝트 이름",value:i.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 오브젝트 이름을 입력해주세요."}):(i.name.ko=e,f(),o(),m())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};i.kinds.push(t),f(),k(i.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/state.png")}),title:"상태 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"상태 추가",inputName:"id",placeholder:"상태 ID (추후 변경 불가)",inputName2:"name.ko",placeholder2:"상태 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"추가할 상태 ID를 입력해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"추가할 상태 이름을 입력해주세요."}):SkyDesktop.Confirm({msg:"상태는 추가 후 삭제가 불가능합니다. 또한 상태 ID는 추후 변경이 불가능합니다. 계속하시겠습니까?"},()=>{let o={name:{ko:t},parts:[]};i.states[e]=o,f(),T(e,o),n()})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/remove.png")}),title:"오브젝트 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"오브젝트를 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:d=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("objecteditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:s=DIV({style:{padding:10}})})]})})})]}).appendTo(BODY),f=()=>{if(void 0!==i){let e=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update(i,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"오브젝트를 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("오브젝트를 저장했습니다.")}}),void 0!==p&&p.refresh()}},m=()=>{if(s.empty(),void 0!==n&&void 0!==r){s.append(H3({c:MSG(i.name)+" / 선택된 종류: "+MSG(i.kinds[n].name)+" / 선택된 상태: "+MSG(i.states[r].name)})),s.append(p=BigWorld.SectionEditor({mode:"object",style:{flt:"left",marginTop:10},sectionLevels:i.sectionLevels,sectionMap:i.sectionMap,touchAreaInfo:i.touchArea,changeDirection:e=>{e.changeDirection(e)},save:f,refresh:(e,t)=>{e.append(BigWorld.Object({objectData:i,kind:n,state:r,direction:t}))}})),s.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:u.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());u.save({name:"scale",value:o}),p.setScale(o),p.refresh()}}})),s.append(CLEAR_BOTH()),void 0!=u.get("scale")&&p.setScale(u.get("scale"));let e;s.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:i.states,state:r,kind:n,save:f})),e.changeDirection(p.getDirection())}},k=(e,t)=>{let o;return d.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==c&&c.deselect(),o.select(),c=o,n=e,m()},contextmenu:e=>{let r=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},f(),o.setTitle(MSG(t.name)),n())}),r.remove()}}}),i.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:i.kinds,value:t});i.kinds.splice(e,1),EACH(i.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),f(),d.removeItem(e),n===e&&(n=0,m())}),r.remove()}}})]});e.stop()}}})}),o},T=(e,t)=>{let o;return l.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name)+" ("+e+")",on:{tap:()=>{void 0!==a&&a.deselect(),o.select(),a=o,r=e,m()},contextmenu:i=>{let n=SkyDesktop.ContextMenu({e:i,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"상태 수정",inputName:"name.ko",placeholder:"상태 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(i,n,r)=>{""===i.trim()?SkyDesktop.Alert({msg:"상태 이름을 입력해주세요."}):(t.name={ko:i},f(),o.setTitle(MSG(t.name)+" ("+e+")"),r())}),n.remove()}}})]});i.stop()}}})}),o};d.open(),l.open(),e.on("paramsChange",e=>{o=e.objectId,c=void 0,a=void 0,d.removeAllItems(),l.removeAllItems(),s.empty(),BigWorld.ObjectModel.get(o,e=>{i=e,EACH(e.kinds,(e,t)=>{k(t,e)}),d.getItem(0).tap(),EACH(e.states,(e,t)=>{T(t,e)}),EACH(e.states,(e,t)=>{return l.getItem(t).tap(),!1})})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{g.remove()})}}),BigWorld.TileEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 타일 에디터");let o,i,n,r,d,l,c,a,s,p,u,g=BigWorld.STORE("tileEditorStore"),f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"타일 정보 변경",inputName:"name",placeholder:"타일 이름",value:i.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 타일 이름을 입력해주세요."}):(i.name=e,m(),o(),k())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};i.kinds.push(t),m(),T(i.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/remove.png")}),title:"타일 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"타일을 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:d=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")
}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:s=DIV({style:{padding:10,width:888}})})]})})})]}).appendTo(BODY);d.open(),l.open();let m=()=>{if(void 0!==i){let e=SkyDesktop.LoadingBar("lime");EACH(i.states,e=>{void 0===e.sectionMap&&(e.sectionMap=BigWorld.Tile.getInitSectionMap())}),BigWorld.TileModel.update(i,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"타일을 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("타일을 저장했습니다.")}}),void 0!==p&&(p.refresh(),u.refresh())}},k=()=>{if(s.empty(),void 0!==n&&void 0!==r){s.append(H3({c:i.name+" / 선택된 종류: "+MSG(i.kinds[n].name)+" / 선택된 상태: "+a.getTitle()})),s.append(p=BigWorld.SectionEditor({mode:"tile",style:{flt:"left",marginTop:10},sectionLevels:{left:(CONFIG.BigWorld.tileSectionLevel-1)/2,up:(CONFIG.BigWorld.tileSectionLevel-1)/2,right:(CONFIG.BigWorld.tileSectionLevel-1)/2,down:(CONFIG.BigWorld.tileSectionLevel-1)/2},sectionMap:void 0===i.states[r]?BigWorld.Tile.getInitSectionMap():i.states[r].sectionMap,save:m,refresh:(e,t)=>{let o=i.states[r];void 0!==o&&EACH(o.parts,t=>{let o=t.frames[n];void 0!==o&&e.append(SkyEngine.Sprite({src:BigWorld.RF(o),fps:t.fps,frameCount:t.frameCount,zIndex:t.zIndex,x:t.x,y:t.y}))})}})),s.append(u=BigWorld.TilePreview({style:{flt:"left",marginLeft:10,marginTop:10},refresh:(e,t)=>{let o={};EACH(BigWorld.TILE_STATES,e=>{let t=i.states[e];void 0!==t&&(o[e]=[],EACH(t.parts,(t,i)=>{o[e][i]=n}))}),BigWorld.Tile({col:0,row:0,tileData:i,kindMap:o}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:0,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-2,tileData:i,kindMap:o,topTileId:i.id,rightTopTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-3,tileData:i,kindMap:o,rightTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-2,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id,leftBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-1,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:0,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:1,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:2,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id,rightBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-3,tileData:i,kindMap:o,leftTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-2,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id,leftTopTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:0,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:2,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id,leftBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:3,tileData:i,kindMap:o,topTileId:i.id,leftTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:2,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTopTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:1,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:0,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-1,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-2,row:3,tileData:i,kindMap:o,leftTileId:i.id,leftTopTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:3,tileData:i,kindMap:o,topTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:2,tileData:i,kindMap:o,topTileId:i.id,rightBottomTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw()}})),s.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:g.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());g.save({name:"scale",value:o}),p.setScale(o),p.refresh(),u.setScale(o),u.refresh()}}})),s.append(CLEAR_BOTH()),void 0!=g.get("scale")&&(p.setScale(g.get("scale")),u.setScale(g.get("scale")));let e;s.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:i.states,state:r,kind:n,save:m}));let t=i.states[r];void 0!==t&&EACH(t.parts,e.addPartEditor)}},T=(e,t)=>{let o;return d.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==c&&c.deselect(),o.select(),c=o,n=e,k()},contextmenu:e=>{let r=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},m(),o.setTitle(MSG(t.name)),n())}),r.remove()}}}),i.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("tileeditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:i.kinds,value:t});i.kinds.splice(e,1),EACH(i.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),m(),d.removeItem(e),n===e&&(n=0,k())}),r.remove()}}})]});e.stop()}}})}),o};EACH(BigWorld.TILE_STATES,e=>{let t;l.addItem({key:e,item:t=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/state/"+e+".png")}),title:e.replace(/([A-Z]+)*([A-Z][a-z])/g,"$1 $2").toLowerCase(),on:{tap:()=>{void 0!==a&&a.deselect(),t.select(),a=t,r=e,k()}}})})}),e.on("paramsChange",e=>{o=e.tileId,c=void 0,d.removeAllItems(),s.empty(),BigWorld.TileModel.get(o,e=>{i=e,EACH(e.kinds,(e,t)=>{T(t,e)}),d.getItem(0).tap(),l.getItem("center").tap()})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{f.remove()})}});