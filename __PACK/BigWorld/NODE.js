BigWorld.FolderModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},elementCount:{notEmpty:!0,integer:0}};return{name:"Folder",initData:{elementCount:0},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ItemModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},e={folderId:{id:!0},objectId:{notEmpty:!0,id:!0},objectPart:{notEmpty:!0,size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:t},left:{data:!0,detail:t},up:{data:!0,detail:t},right:{data:!0,detail:t}}}}}}}};return{name:"Item",initData:{kinds:[{name:{en:"Kind 1"}}],states:{}},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.MapModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}};return{name:"Map",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={notEmpty:!0,integer:!0,min:0},e={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},a={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},sectionLevels:{notEmpty:!0,data:!0,detail:{left:t,up:t,right:t,down:t}},sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},touchArea:{notEmpty:!0,data:!0,detail:{x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},width:{notEmpty:!0,integer:!0},height:{notEmpty:!0,integer:!0}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:e},left:{data:!0,detail:e},up:{data:!0,detail:e},right:{data:!0,detail:e}}}}}}}};return{name:"Object",initData:{sectionLevels:{left:0,up:0,right:0,down:0},sectionMap:[[{z:0}]],touchArea:{x:0,y:0,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight},kinds:[{name:{en:"Kind 1"}}],states:{idle:{name:{en:"Idle"},parts:[]}}},methodConfig:{create:{valid:VALID(a)},update:{valid:VALID(a)}}}}}),BigWorld.TileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}}}}}}}},e=[];return REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let t=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{t.push({z:0})}),e.push(t)}),{name:"Tile",initData:{kinds:[{name:{en:"Kind 1"}}],states:{center:{sectionMap:e,parts:[]}}},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.TILE_STATES=["center","left","leftTop","top","rightTop","right","rightBottom","bottom","leftBottom","fillLeftBottom","fillLeftTop","fillRightTop","fillRightBottom"],BigWorld.MapObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={mapId:{notEmpty:!0,id:!0},objectId:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0},state:{notEmpty:!0,size:{max:255}},items:{notEmpty:!0,array:!0,element:{data:!0,detail:{id:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0}}}},direction:{notEmpty:!0,one:["down","right","up","left"]},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},isReverse:{bool:!0}};return{name:"MapObject",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.MapTileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={};EACH(BigWorld.TILE_STATES,e=>{t[e]={notEmpty:!0,array:!0,each:{notEmpty:!0,integer:!0}}});let e={mapId:{notEmpty:!0,id:!0},tileId:{notEmpty:!0,id:!0},kindMap:{notEmpty:!0,data:!0,details:t},col:{notEmpty:!0,integer:!0},row:{notEmpty:!0,integer:!0}};return{name:"MapTile",methodConfig:{create:{valid:VALID(e),role:"System"},update:{valid:VALID(e)}}}}});OVERRIDE(BigWorld.FolderModel,e=>{BigWorld.FolderModel=OBJECT({preset:()=>{return e},init:(e,o)=>{e.on("create",{after:e=>{void 0!==e.folderId&&o.updateNoHistory({id:e.folderId,$inc:{elementCount:1}})}}),e.on("update",{before:(e,d,i)=>{if(void 0!==e.folderId&&e.folderId!==TO_DELETE){if(e.id===e.folderId)i({validErrors:{folderId:{type:"notAllowed"}}});else{let t=t=>{o.get(t,o=>{void 0===o.folderId?d():o.folderId===e.id?i({validErrors:{folderId:{type:"notAllowed"}}}):check(o.folderId)})};t(e.folderId)}return!1}},after:(e,d)=>{e.folderId!==d.folderId&&(void 0!==d.folderId&&o.updateNoHistory({id:d.folderId,$inc:{elementCount:-1}}),void 0!==e.folderId&&o.updateNoHistory({id:e.folderId,$inc:{elementCount:1}}))}}),e.on("remove",{after:e=>{void 0!==e.folderId&&o.updateNoHistory({id:e.folderId,$inc:{elementCount:-1}},{notExists:()=>{}}),o.find({filter:{folderId:e.id}},EACH(e=>{o.remove(e.id)})),BigWorld.MapModel.find({filter:{folderId:e.id}},EACH(e=>{BigWorld.MapModel.remove(e.id)})),BigWorld.ObjectModel.find({filter:{folderId:e.id}},EACH(e=>{BigWorld.ObjectModel.remove(e.id)})),BigWorld.ItemModel.find({filter:{folderId:e.id}},EACH(e=>{BigWorld.ItemModel.remove(e.id)}))}})}})}),OVERRIDE(BigWorld.ItemModel,e=>{BigWorld.ItemModel=OBJECT({preset:()=>{return e},init:(e,o)=>{o.getDB().createIndex({objectId:1}),e.on("create",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}})}}),e.on("update",{after:(e,o)=>{e.folderId!==o.folderId&&(void 0!==o.folderId&&BigWorld.FolderModel.updateNoHistory({id:o.folderId,$inc:{elementCount:-1}}),void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}}))}}),e.on("remove",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:-1}},{notExists:()=>{}}),BigWorld.MapObjectModel.find({filter:{items:{$elemMatch:{id:e.id}}},isFindAll:!0},EACH(o=>{EACH(o.items,d=>{d.id===e.id&&REMOVE({array:o.items,value:d})}),BigWorld.MapObjectModel.update(o)}))}})}})}),OVERRIDE(BigWorld.MapModel,e=>{BigWorld.MapModel=OBJECT({preset:()=>{return e},init:(e,o)=>{e.on("create",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}})}}),e.on("update",{after:(e,o)=>{e.folderId!==o.folderId&&(void 0!==o.folderId&&BigWorld.FolderModel.updateNoHistory({id:o.folderId,$inc:{elementCount:-1}}),void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}}))}}),e.on("remove",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:-1}},{notExists:()=>{}}),BigWorld.MapTileModel.find({filter:{mapId:e.id},isFindAll:!0},EACH(e=>{BigWorld.MapTileModel.remove(e.id)})),BigWorld.MapObjectModel.find({filter:{mapId:e.id},isFindAll:!0},EACH(e=>{BigWorld.MapObjectModel.remove(e.id)}))}})}})}),OVERRIDE(BigWorld.ObjectModel,e=>{BigWorld.ObjectModel=OBJECT({preset:()=>{return e},init:(e,o)=>{e.on("create",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}})}}),e.on("update",{after:(e,o)=>{e.folderId!==o.folderId&&(void 0!==o.folderId&&BigWorld.FolderModel.updateNoHistory({id:o.folderId,$inc:{elementCount:-1}}),void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}}))}}),e.on("remove",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:-1}},{notExists:()=>{}}),BigWorld.ItemModel.find({filter:{objectId:e.id}},EACH(e=>{BigWorld.ItemModel.remove(e.id)})),BigWorld.MapObjectModel.find({filter:{objectId:e.id},isFindAll:!0},EACH(e=>{BigWorld.MapObjectModel.remove(e.id)}))}})}})}),OVERRIDE(BigWorld.TileModel,e=>{BigWorld.TileModel=OBJECT({preset:()=>{return e},init:(e,o)=>{e.on("create",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}})}}),e.on("update",{after:(e,o)=>{e.folderId!==o.folderId&&(void 0!==o.folderId&&BigWorld.FolderModel.updateNoHistory({id:o.folderId,$inc:{elementCount:-1}}),void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:1}}))}}),e.on("remove",{after:e=>{void 0!==e.folderId&&BigWorld.FolderModel.updateNoHistory({id:e.folderId,$inc:{elementCount:-1}},{notExists:()=>{}}),BigWorld.MapTileModel.find({filter:{tileId:e.id},isFindAll:!0},EACH(e=>{BigWorld.MapTileModel.remove(e.id)}))}})}})}),OVERRIDE(BigWorld.MapObjectModel,e=>{BigWorld.MapObjectModel=OBJECT({preset:()=>{return e},init:(e,o)=>{o.getDB().createIndex({mapId:1,x:1,y:1});let d=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,i=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel;e.on("create",{after:e=>{BigWorld.BROADCAST({roomName:"Zone/"+Math.round(e.x/d)+","+Math.round(e.y/i),methodName:"putObject",data:e})}})}})}),OVERRIDE(BigWorld.MapTileModel,e=>{BigWorld.MapTileModel=OBJECT({preset:()=>{return e},init:(e,o)=>{o.getDB().createIndex({mapId:1,col:1,row:1}),e.on("create",{after:e=>{BigWorld.BROADCAST({roomName:"Zone/"+e.col+","+e.row,methodName:"putTile",data:e}),o.find({filter:{id:{$ne:e.id},mapId:e.mapId,col:e.col,row:e.row,createTime:{$lte:e.createTime}}},e=>{e.length>0&&EACH(e,e=>{o.remove(e.id)})})}}),BigWorld.ROOM(o.getName(),(e,d)=>{d("put",(e,d)=>{void 0!==e&&o.get({filter:{mapId:e.mapId,col:e.col,row:e.row}},{notExists:()=>{o.create(e,d)},success:i=>{e.id=i.id,o.update(e,d)}})})})}})});