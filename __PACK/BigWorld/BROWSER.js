BigWorld.FolderModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},factorCount:{notEmpty:!0,integer:0}};return{name:"Folder",initData:{factorCount:0},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.ItemModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={objectId:{notEmpty:!0,id:!0},folderId:{id:!0},category:{size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},kinds:{array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{data:!0,property:{data:!0,detail:{parts:{array:!0,element:{data:!0,detail:{name:{data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{integer:!0},frameCount:{integer:!0},fps:{integer:!0},x:{real:!0},y:{real:!0},frames:{array:!0,element:{data:!0,detail:{left:{id:!0},up:{id:!0},right:{id:!0},down:{id:!0}}}}}}}}}}};return{name:"Item",methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.ObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={folderId:{id:!0},category:{size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},sectionLeftLevel:{notEmpty:!0,integer:!0,min:0},sectionUpLevel:{notEmpty:!0,integer:!0,min:0},sectionRightLevel:{notEmpty:!0,integer:!0,min:0},sectionDownLevel:{notEmpty:!0,integer:!0,min:0},sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},kinds:{array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{data:!0,property:{data:!0,detail:{name:{data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},parts:{array:!0,element:{data:!0,detail:{name:{data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{integer:!0},frameCount:{integer:!0},fps:{integer:!0},x:{real:!0},y:{real:!0},frames:{array:!0,element:{data:!0,detail:{left:{id:!0},up:{id:!0},right:{id:!0},down:{id:!0}}}}}}}}}}};return{name:"Object",initData:{sectionUpLevel:0,sectionRightLevel:0,sectionDownLevel:0,sectionLeftLevel:0,sectionMap:[[{z:0}]]},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.StageModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}};return{name:"Stage",methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.StageObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={stageId:{notEmpty:!0,id:!0},objectId:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0},state:{notEmpty:!0,size:{max:255}},itemInfos:{array:!0,element:{data:!0,detail:{id:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0}}}},direction:{notEmpty:!0,one:["down","right","up","left"]},tileRow:{notEmpty:!0,integer:!0},tileCol:{notEmpty:!0,integer:!0},sectionRow:{notEmpty:!0,integer:!0},sectionCol:{notEmpty:!0,integer:!0},isReverse:{bool:!0}};return{name:"StageObject",methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.StageTileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={stageId:{notEmpty:!0,id:!0},tileId:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0},tileRow:{notEmpty:!0,integer:!0},tileCol:{notEmpty:!0,integer:!0}};return{name:"StageTile",methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.TileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let e={folderId:{id:!0},category:{size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},kinds:{array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{data:!0,property:{data:!0,detail:{parts:{array:!0,element:{data:!0,detail:{name:{data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{integer:!0},frameCount:{integer:!0},fps:{integer:!0},x:{real:!0},y:{real:!0},frames:{array:!0,element:{data:!0,detail:{left:{id:!0},up:{id:!0},right:{id:!0},down:{id:!0}}}}}}}}}}},t=[];return REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let e=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{e.push({z:0})}),t.push(e)}),{name:"Tile",initData:{states:{full:{},empty:{},left:{},top:{},right:{},bottom:{},leftTop:{},topRight:{},rightBottom:{},bottomLeft:{},noLeft:{},noTop:{},noRight:{},noBottom:{}},sectionMap:t},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}});BigWorld.MAIN=METHOD({run:e=>{BigWorld.MATCH_VIEW({uri:["explorer","explorer/{folderId}"],target:BigWorld.Explorer}),BigWorld.MATCH_VIEW({uri:"stage/{stageId}",target:BigWorld.StageEditor}),BigWorld.MATCH_VIEW({uri:"tile/{tileId}",target:BigWorld.TileEditor}),BigWorld.MATCH_VIEW({uri:"object/{objectId}",target:BigWorld.ObjectEditor}),BigWorld.MATCH_VIEW({uri:"item/{itemId}",target:BigWorld.ItemEditor})}}),BigWorld.Object=CLASS({preset:()=>{return SkyEngine.Node},params:()=>{return{isY2ZIndex:!0}},init:(e,t,o)=>{let i=o.id,n=o.objectData,d=o.kind,r=o.state,s=o.direction,c=o.itemDataSet,l=o.itemKinds,a=o.isReverse;void 0===c&&(c=[]),void 0===l&&(l=[]),void 0===a&&(a=!1),a===!0&&t.flipX();let p=RAR(()=>{if(t.empty(),void 0!==n.states){let e=n.states[r];void 0!==e&&EACH(e.parts,e=>{if(void 0!==e.frames){let o=e.frames[d];if(void 0!==o&&o!==TO_DELETE){let i=o[s];void 0!==i&&SkyEngine.Sprite({src:BigWorld.RF(i),fps:e.fps,frameCount:e.frameCount,zIndex:e.zIndex,x:e.x,y:e.y,on:{load:(o,n)=>{t.addTouchArea(SkyEngine.Silhouette({src:BigWorld.RF(i),width:n.getSpriteWidth(),x:e.x,y:e.y}))}}}).appendTo(t)}}})}EACH(c,(e,o)=>{if(void 0!==e.states){let i=e.states[r];void 0!==i&&EACH(i.parts,e=>{if(void 0!==e.frames){let i=e.frames[l[o]];if(void 0!==i&&i!==TO_DELETE){let o=i[s];void 0!==o&&SkyEngine.Sprite({src:BigWorld.RF(o),fps:e.fps,frameCount:e.frameCount,zIndex:e.zIndex,x:e.x,y:e.y}).appendTo(t)}}})}})}),g=(t.getId=(()=>{return i}),t.changeKind=(e=>{d=e,p()}),t.getKind=(()=>{return d}),t.changeState=(e=>{r=e,p()}),t.getState=(()=>{return r}),t.changeDirection=(e=>{s=e,p()}),t.getDirection=(()=>{return s}),t.addItem=(e=>{let t=e.itemData,o=e.kind;g(t.id),c.push(t),l.push(o),p()}),t.checkItemExists=(e=>{let t=e.itemId,o=e.kind,i=!1;return EACH(c,(e,n)=>{if(e.id===t&&l[n]===o)return i=!0,!1}),i}),t.removeItem=(e=>{EACH(c,(t,o)=>{if(t.id===e)return c.splice(o,1),l.splice(o,1),!1}),p()}));t.getItemInfos=(()=>{let e=[];return EACH(c,(t,o)=>{e.push({id:t.id,kind:l[o]})}),e}),t.reverse=(()=>{a=a!==!0,t.flipX()}),t.checkIsReverse=(()=>{return a})}}),BigWorld.Stage=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,o,i)=>{let n,d,r=o.stageData,s=o.isToShowGrid,c={},l=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,a=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,p=EVENT("resize",RAR(()=>{n=WIN_WIDTH()/2/t.getScaleX(),d=WIN_HEIGHT()/2/t.getScaleY()}));t.on("remove",()=>{p.remove()}),s===!0&&(t.append(SkyEngine.Line({zIndex:-999999,startX:-CONFIG.BigWorld.sectionWidth,startY:0,endX:CONFIG.BigWorld.sectionWidth,endY:0,border:"1px solid #fff"})),t.append(SkyEngine.Line({zIndex:-999999,startX:0,startY:-CONFIG.BigWorld.sectionHeight,endX:0,endY:CONFIG.BigWorld.sectionHeight,border:"1px solid #fff"})));let g={},u=RAR(()=>{let e=INTEGER((-t.getY()/t.getScaleY()-d)/a)-1,o=INTEGER((-t.getY()/t.getScaleY()+d)/a)+1,i=INTEGER((-t.getX()/t.getScaleX()-n)/l)-1,r=INTEGER((-t.getX()/t.getScaleX()+n)/l)+1,c={};for(let p=e;p<=o;p+=1)for(let u=i;u<=r;u+=1)c[p+","+u]={row:p,col:u};EACH(g,(e,t)=>{void 0!==c[t]?delete c[t]:(e.remove(),delete g[t])}),EACH(c,(e,o)=>{let i=g[o]=SkyEngine.Node({zIndex:-999999,x:e.col*l,y:e.row*a}).appendTo(t);s===!0&&i.append(SkyEngine.Rect({width:l,height:a,border:"1px solid #666"}))})}),f=(t.setPosition=(e=>{t.setX(e.x),t.setY(e.y),u()}),e=>{void 0!==c[e]&&(c[e].remove(),delete c[e])}),m=e=>{BigWorld.ObjectModel.get(e.objectId,o=>{let n=[],d=[];PARALLEL(e.itemInfos,[(e,t)=>{d.push(e.kind),BigWorld.ItemModel.get(e.id,e=>{n.push(e),t()})},()=>{let r=BigWorld.Object({id:e.id,x:e.tileCol*l+e.sectionCol*CONFIG.BigWorld.sectionWidth,y:e.tileRow*a+e.sectionRow*CONFIG.BigWorld.sectionHeight,objectData:o,kind:e.kind,state:e.state,direction:e.direction,itemDataSet:n,itemKinds:d,isReverse:e.isReverse,on:{tap:()=>{void 0!==i&&i(r)}}}).appendTo(t);f(e.id),c[e.id]=r}])})};BigWorld.StageObjectModel.onNewAndFindWatching({properties:{stageId:r.id}},(e,t,o)=>{m(e),t(e=>{m(e)}),o(()=>{f(e.id)})})}}),BigWorld.Tile=CLASS({preset:()=>{return SkyEngine.Node},params:()=>{return{isY2ZIndex:!0}},init:(e,t,o)=>{let i=o.id,n=o.tileData,d=o.kind,r=o.state,s=o.direction,c=o.itemDataSet,l=o.itemKinds,a=o.isReverse;void 0===c&&(c=[]),void 0===l&&(l=[]),void 0===a&&(a=!1),a===!0&&t.flipX();let p=RAR(()=>{if(t.empty(),void 0!==n.states){let e=n.states[r];void 0!==e&&EACH(e.parts,e=>{if(void 0!==e.frames){let o=e.frames[d];if(void 0!==o&&o!==TO_DELETE){let i=o[s];void 0!==i&&SkyEngine.Sprite({src:BigWorld.RF(i),fps:e.fps,frameCount:e.frameCount,zIndex:e.zIndex,x:e.x,y:e.y,on:{load:(o,n)=>{t.addTouchArea(SkyEngine.Silhouette({src:BigWorld.RF(i),width:n.getSpriteWidth(),x:e.x,y:e.y}))}}}).appendTo(t)}}})}EACH(c,(e,o)=>{if(void 0!==e.states){let i=e.states[r];void 0!==i&&EACH(i.parts,e=>{if(void 0!==e.frames){let i=e.frames[l[o]];if(void 0!==i&&i!==TO_DELETE){let o=i[s];void 0!==o&&SkyEngine.Sprite({src:BigWorld.RF(o),fps:e.fps,frameCount:e.frameCount,zIndex:e.zIndex,x:e.x,y:e.y}).appendTo(t)}}})}})}),g=(t.getId=(()=>{return i}),t.changeKind=(e=>{d=e,p()}),t.getKind=(()=>{return d}),t.changeState=(e=>{r=e,p()}),t.getState=(()=>{return r}),t.changeDirection=(e=>{s=e,p()}),t.getDirection=(()=>{return s}),t.addItem=(e=>{let t=e.itemData,o=e.kind;g(t.id),c.push(t),l.push(o),p()}),t.checkItemExists=(e=>{let t=e.itemId,o=e.kind,i=!1;return EACH(c,(e,n)=>{if(e.id===t&&l[n]===o)return i=!0,!1}),i}),t.removeItem=(e=>{EACH(c,(t,o)=>{if(t.id===e)return c.splice(o,1),l.splice(o,1),!1}),p()}));t.getItemInfos=(()=>{let e=[];return EACH(c,(t,o)=>{e.push({id:t.id,kind:l[o]})}),e}),t.reverse=(()=>{a=a!==!0,t.flipX()}),t.checkIsReverse=(()=>{return a})}}),BigWorld.CreateSelectObjectPopup=METHOD({run:e=>{let t,o,i,n=BigWorld.STORE("folderOpenedStore");SkyDesktop.Confirm({okButtonTitle:"불러오기",style:{onDisplayResize:(e,t)=>{return e>600?{width:500}:{width:"90%"}}},msg:[H2({style:{fontWeight:"bold"},c:"스테이지에 놓을 객체를 선택해주세요."}),SkyDesktop.FileTree({style:{border:"1px solid #999",marginTop:8,overflowY:"scroll",padding:8,borderRadius:4,textAlign:"left",onDisplayResize:(e,t)=>{return t>500?{height:300}:{height:150}}},c:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/drive.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},tap:(e,i)=>{void 0!==t&&t.deselect(),i.select(),t=i,o=void 0}}})})]},(t,i)=>{return void 0!==o&&void e(o,t,i)});let d=(e,r)=>{let s=void 0===r?i:e,c=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:void 0===r?TO_DELETE:r},sort:{createTime:1}},(e,i,r)=>{let c;s.addItem({key:e.id,item:c=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:n.get(e.id),icon:IMG({src:BigWorld.R("explorer/folder.png")}),title:e.name,on:{open:(t,o)=>{n.save({name:e.id,value:!0}),d(o,e.id)},close:(t,o)=>{n.remove(e.id),o.removeAllItems()},tap:()=>{void 0!==t&&t.deselect(),c.select(),t=c,o=void 0}}})}),void 0!==t&&t.deselect(),c.select(),t=c,i(e=>{c.setTitle(MSG(e.name))}),r(()=>{s.removeItem(e.id)})});s.on("remove",()=>{c()});let l=BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:void 0===r?TO_DELETE:r},sort:{createTime:1}},(e,i,n)=>{let d;s.addItem({key:e.id,item:d=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/object.png")}),title:MSG(e.name),on:{tap:()=>{void 0!==t&&t.deselect(),d.select(),t=d,o=e}}})}),i(e=>{d.setTitle(MSG(e.name))}),n(()=>{d.remove()})});s.on("remove",()=>{l()})};i.open(),d()}}),BigWorld.CreateSelectTilePopup=METHOD({run:e=>{let t,o,i,n=BigWorld.STORE("folderOpenedStore");SkyDesktop.Confirm({okButtonTitle:"불러오기",style:{onDisplayResize:(e,t)=>{return e>600?{width:500}:{width:"90%"}}},msg:[H2({style:{fontWeight:"bold"},c:"스테이지에 놓을 타일을 선택해주세요."}),SkyDesktop.FileTree({style:{border:"1px solid #999",marginTop:8,overflowY:"scroll",padding:8,borderRadius:4,textAlign:"left",onDisplayResize:(e,t)=>{return t>500?{height:300}:{height:150}}},c:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/drive.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},tap:(e,i)=>{void 0!==t&&t.deselect(),i.select(),t=i,o=void 0}}})})]},(t,i)=>{return void 0!==o&&void e(o,t,i)});let d=(e,r)=>{let s=void 0===r?i:e,c=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:void 0===r?TO_DELETE:r},sort:{createTime:1}},(e,i,r)=>{let c;s.addItem({key:e.id,item:c=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:n.get(e.id),icon:IMG({src:BigWorld.R("explorer/folder.png")}),title:e.name,on:{open:(t,o)=>{n.save({name:e.id,value:!0}),d(o,e.id)},close:(t,o)=>{n.remove(e.id),o.removeAllItems()},tap:()=>{void 0!==t&&t.deselect(),c.select(),t=c,o=void 0}}})}),void 0!==t&&t.deselect(),c.select(),t=c,i(e=>{c.setTitle(MSG(e.name))}),r(()=>{s.removeItem(e.id)})});s.on("remove",()=>{c()});let l=BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:void 0===r?TO_DELETE:r},sort:{createTime:1}},(e,i,n)=>{let d;s.addItem({key:e.id,item:d=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/tile.png")}),title:MSG(e.name),on:{tap:()=>{void 0!==t&&t.deselect(),d.select(),t=d,o=e}}})}),i(e=>{d.setTitle(MSG(e.name))}),n(()=>{d.remove()})});s.on("remove",()=>{l()})};i.open(),d()}}),BigWorld.Explorer=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld Explorer");let o,i,n,d,r,s,c,l,a,p,g,u,f,m=BigWorld.STORE("folderOpenedStore"),k=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/folder.png")}),title:"새 폴더",on:{tap:()=>{let e,t;SkyDesktop.Confirm({okButtonTitle:"생성",msg:e=UUI.VALID_FORM({errorMsgs:{name:{notEmpty:"저장할 폴더 이름을 입력해주세요.",size:e=>{return"최대 "+e.max+"글자입니다."}}},errorMsgStyle:{color:"red"},c:[t=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name",placeholder:"폴더 이름"})]})},()=>{let t=e.getData();t.folderId=o;let i=!1;if(BigWorld.FolderModel.create(t,{notValid:t=>{e.showErrors(t),i=!0},success:e=>{console.log(e)}}),i===!0)return!1}),t.focus()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/stage.png")}),title:"새 스테이지",on:{tap:()=>{let e,t;SkyDesktop.Confirm({okButtonTitle:"생성",msg:e=UUI.VALID_FORM({errorMsgs:{name:{notEmpty:"저장할 스테이지명을 입력해주세요."},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},errorMsgStyle:{color:"red"},c:[t=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"스테이지명 (한국어)"})]})},()=>{let t=e.getData();t.folderId=o;let i=!1;if(BigWorld.StageModel.create(t,{notValid:t=>{e.showErrors(t),i=!0},success:e=>{console.log(e)}}),i===!0)return!1}),t.focus()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/tile.png")}),title:"새 타일",on:{tap:()=>{let e,t;SkyDesktop.Confirm({okButtonTitle:"생성",msg:e=UUI.VALID_FORM({errorMsgs:{name:{notEmpty:"저장할 타일명을 입력해주세요."},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},errorMsgStyle:{color:"red"},c:[t=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"타일명 (한국어)"})]})},()=>{let t=e.getData();t.folderId=o;let i=!1;if(BigWorld.TileModel.create(t,{notValid:t=>{e.showErrors(t),i=!0},success:e=>{console.log(e)}}),i===!0)return!1}),t.focus()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:"새 오브젝트",on:{tap:()=>{let e,t;SkyDesktop.Confirm({okButtonTitle:"생성",msg:e=UUI.VALID_FORM({errorMsgs:{name:{notEmpty:"저장할 오브젝트명을 입력해주세요."},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},errorMsgStyle:{color:"red"},c:[t=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"오브젝트명 (한국어)"})]})},()=>{let t=e.getData();t.folderId=o;let i=!1;if(BigWorld.ObjectModel.create(t,{notValid:t=>{e.showErrors(t),i=!0},success:e=>{console.log(e)}}),i===!0)return!1}),t.focus()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/item.png")}),title:"새 아이템",on:{tap:()=>{let e,t,i;SkyDesktop.Confirm({okButtonTitle:"생성",msg:t=UUI.VALID_FORM({errorMsgs:{name:{notEmpty:"저장할 오브젝트명을 입력해주세요."},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},errorMsgStyle:{color:"red"},c:[UUI.BUTTON_H({icon:IMG({src:BigWorld.R("stageeditor/object.png")}),spacing:10,title:"대상 객체 선택",on:{tap:(t,o)=>{BigWorld.CreateSelectObjectPopup(t=>{e=t.id,o.setTitle(MSG(t.name))})}}}),i=INPUT({style:{marginTop:10,width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"아이템명 (한국어)"})]})},()=>{let i=t.getData();i.objectId=e,i.folderId=o;let n=!1;if(BigWorld.ItemModel.create(i,{notValid:e=>{t.showErrors(e),void 0!==e.objectId&&SkyDesktop.Alert({msg:"대상 객체를 선택해주세요."}),n=!0},success:e=>{console.log(e)}}),n===!0)return!1}),i.focus()}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:23,c:SkyDesktop.FileTree({items:{root:c=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/drive.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/drive.png")}))},tap:(e,t)=>{void 0!==l&&l.deselect(),t.select(),l=t,BigWorld.GO("explorer")},touchend:()=>{if(void 0!==f)if("folder"===p.type){let e=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.update({id:p.id,folderId:TO_DELETE},{notValid:t=>{e.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{e.done(),I(),void 0===o&&BigWorld.REFRESH("explorer")}})}else if("stage"===p.type){let e=SkyDesktop.LoadingBar("lime");BigWorld.StageModel.update({id:p.id,folderId:TO_DELETE},{notValid:t=>{e.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{e.done()}})}else if("object"===p.type){let e=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:p.id,folderId:TO_DELETE},{notValid:t=>{e.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{e.done()}})}else if("item"===p.type){let e=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:p.id,folderId:TO_DELETE},{notValid:t=>{e.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{e.done()}})}}}})}})}),a=SkyDesktop.Tab({size:77})]})})})]}).appendTo(BODY),I=(e,t)=>{let i=void 0===t?c:e,n=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:void 0===t?TO_DELETE:t},sort:{createTime:1}},(e,n,d,r)=>{let s;i.addItem({key:e.id,item:s=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:m.get(e.id),icon:IMG({src:BigWorld.R("explorer/folder.png")}),title:e.name,on:{open:(t,o)=>{m.save({name:e.id,value:!0}),I(o,e.id)},close:(t,o)=>{m.remove(e.id),o.removeAllItems()},tap:()=>{void 0!==l&&l.deselect(),s.select(),l=s,BigWorld.GO("explorer/"+e.id)},touchstart:t=>{p={type:"folder",id:e.id,title:e.name},g=t.getLeft(),u=t.getTop()},touchend:()=>{if(void 0!==f)if("folder"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done(),I(s,e.id),o===e.id&&BigWorld.REFRESH("explorer/"+e.id)}})}else if("stage"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.StageModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}else if("object"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}else if("item"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name",placeholder:"폴더 이름"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.FolderModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})}),e.id===o&&(void 0!==l&&l.deselect(),s.select(),l=s),n(e=>{e.folderId!==t?(r(),s.remove()):s.setTitle(e.name)}),d(()=>{i.removeItem(e.id)})});i.on("remove",()=>{n()})};c.open(),I(),e.on("paramsChange",e=>{if(o=e.folderId,void 0===o)void 0!==l&&l.deselect(),c.select(),l=c;else{let e=t=>{let i=t.getItem(o);void 0!==i?(void 0!==l&&l.deselect(),i.select(),l=i):EACH(t.getItems(),e)};e(c)}void 0!==i&&(i(),i=void 0),void 0!==n&&(n(),n=void 0),void 0!==d&&(d(),d=void 0),void 0!==r&&(r(),r=void 0),void 0!==s&&(s(),s=void 0),a.empty(),NEXT([e=>{i=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:void 0===o?TO_DELETE:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;a.append(d=UUI.BUTTON({style:{flt:"left",padding:10,height:120},icon:IMG({src:BigWorld.R("explorer/factor/folder.png"),on:{touchstart:e=>{e.stopDefault()}}}),title:e.name,on:{tap:()=>{BigWorld.GO("explorer/"+e.id)},touchstart:t=>{p={type:"folder",id:e.id,title:e.name},g=t.getLeft(),u=t.getTop()},touchend:()=>{if(void 0!==f)if("folder"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}else if("stage"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.StageModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}else if("object"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}else if("item"===p.type){let t=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:p.id,folderId:e.id},{notValid:e=>{t.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."})},success:()=>{t.done()}})}},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name",placeholder:"폴더 이름"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.FolderModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})),t(e=>{e.folderId!==o?(n(),d.remove()):d.setTitle(e.name)}),i(()=>{d.remove()})},success:e})},e=>{return()=>{n=BigWorld.StageModel.onNewAndFindWatching({properties:{folderId:void 0===o?TO_DELETE:o},sort:{createTime:1}},{handler:(e,t,o)=>{let i;a.append(i=UUI.BUTTON({style:{flt:"left",padding:10,height:120},icon:IMG({src:BigWorld.R("explorer/factor/stage.png"),on:{touchstart:e=>{e.stopDefault()}}}),title:void 0===MSG(e.name)?"Unknown":MSG(e.name),href:BigWorld.HREF("stage/"+e.id),target:"_blank",on:{touchstart:t=>{p={type:"stage",id:e.id,title:void 0===MSG(e.name)?"Unknown":MSG(e.name)},g=t.getLeft(),u=t.getTop()},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"스테이지명 (한국어)"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.StageModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.StageModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})),t(e=>{i.setTitle(void 0===MSG(e.name)?"Unknown":MSG(e.name))}),o(()=>{i.remove()})},success:e})}},e=>{return()=>{d=BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:void 0===o?TO_DELETE:o},sort:{createTime:1}},{handler:(e,t,o)=>{let i;a.append(i=UUI.BUTTON({style:{flt:"left",padding:10,height:120},icon:IMG({src:BigWorld.R("explorer/factor/tile.png"),on:{touchstart:e=>{e.stopDefault()}}}),title:void 0===MSG(e.name)?"Unknown":MSG(e.name),href:BigWorld.HREF("tile/"+e.id),target:"_blank",on:{touchstart:t=>{p={type:"tile",id:e.id,title:void 0===MSG(e.name)?"Unknown":MSG(e.name)},g=t.getLeft(),u=t.getTop()},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"타일명 (한국어)"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.TileModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})),t(e=>{i.setTitle(void 0===MSG(e.name)?"Unknown":MSG(e.name))}),o(()=>{i.remove()})},success:e})}},e=>{return()=>{r=BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:void 0===o?TO_DELETE:o},sort:{createTime:1}},{handler:(e,t,o)=>{let i;a.append(i=UUI.BUTTON({style:{flt:"left",padding:10,height:120},icon:IMG({src:BigWorld.R("explorer/factor/object.png"),on:{touchstart:e=>{e.stopDefault()}}}),title:void 0===MSG(e.name)?"Unknown":MSG(e.name),href:BigWorld.HREF("object/"+e.id),target:"_blank",on:{touchstart:t=>{p={type:"object",id:e.id,title:void 0===MSG(e.name)?"Unknown":MSG(e.name)},g=t.getLeft(),u=t.getTop()},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"오브젝트명 (한국어)"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.ObjectModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})),t(e=>{i.setTitle(void 0===MSG(e.name)?"Unknown":MSG(e.name))}),o(()=>{i.remove()})},success:e})}},()=>{return()=>{s=BigWorld.ItemModel.onNewAndFindWatching({properties:{folderId:void 0===o?TO_DELETE:o},sort:{createTime:1}},(e,t,o)=>{let i;a.append(i=UUI.BUTTON({style:{flt:"left",padding:10,height:120},icon:IMG({src:BigWorld.R("explorer/factor/item.png"),on:{touchstart:e=>{e.stopDefault()}}}),title:void 0===MSG(e.name)?"Unknown":MSG(e.name),href:BigWorld.HREF("item/"+e.id),target:"_blank",on:{touchstart:t=>{p={type:"item",id:e.id,title:void 0===MSG(e.name)?"Unknown":MSG(e.name)},g=t.getLeft(),u=t.getTop()},contextmenu:t=>{let o=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"이름 변경",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"아이템명 (한국어)"})]})},()=>{let o=SkyDesktop.LoadingBar("lime"),i=!0;return BigWorld.ItemModel.update({id:e.id,name:t.getData().name},{notValid:e=>{o.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{o.done()}}),i}),t.setData(e),o.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(e.id,()=>{t.done()})}),o.remove()}}})]});t.stop()}}})),t(e=>{i.setTitle(void 0===MSG(e.name)?"Unknown":MSG(e.name))}),o(()=>{i.remove()})})}}])});let y=EVENT("touchmove",e=>{void 0===f?void 0!==p&&(Math.abs(g-e.getLeft())>5||Math.abs(u-e.getTop())>5)&&(f=DIV({style:{position:"fixed",left:e.getLeft()+10,top:e.getTop()+10,color:"#000"},c:p.title}).appendTo(BODY)):f.addStyle({left:e.getLeft()+10,top:e.getTop()+10})}),B=EVENT("touchend",()=>{void 0!==p&&(p=void 0),void 0!==f&&(f.remove(),f=void 0)});e.on("close",()=>{k.remove(),void 0!==i&&(i(),i=void 0),void 0!==n&&(n(),n=void 0),void 0!==d&&(d(),d=void 0),void 0!==r&&(r(),r=void 0),void 0!==s&&(s(),s=void 0),y.remove(),y=void 0,B.remove(),B=void 0})}}),BigWorld.ItemEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld Item Editor");let o,i,n,d=BigWorld.STORE("itemEditorStore"),r=EVENT("keydown",e=>{"Control"===e.getKey()&&(o=!0)}),s=EVENT("keyup",e=>{"Control"===e.getKey()&&(o=!1)});e.on("paramsChange",e=>{BigWorld.ItemModel.get(e.itemId,e=>{BigWorld.ObjectModel.get(e.objectId,t=>{let r,s,c,l=d.get(e.id);void 0!==l&&(r=l.direction,s=l.selectedKindIndex,c=l.selectedState),void 0===r&&(r="down");let a,p,g,u,f,m,k=()=>{u.empty(),EACH(t.sectionMap,(e,i)=>{EACH(e,(e,n)=>{let d,s;"down"===r&&(d=CONFIG.BigWorld.sectionWidth*(n-t.sectionLeftLevel),s=CONFIG.BigWorld.sectionHeight*(i-t.sectionUpLevel)),"left"===r&&(d=-CONFIG.BigWorld.sectionHeight*(i-t.sectionUpLevel),s=CONFIG.BigWorld.sectionWidth*(n-t.sectionLeftLevel)),"up"===r&&(d=-CONFIG.BigWorld.sectionWidth*(n-t.sectionLeftLevel),s=-CONFIG.BigWorld.sectionHeight*(i-t.sectionUpLevel)),"right"===r&&(d=CONFIG.BigWorld.sectionHeight*(i-t.sectionUpLevel),s=-CONFIG.BigWorld.sectionWidth*(n-t.sectionLeftLevel)),u.append(SkyEngine.Rect({x:d,y:s,width:CONFIG.BigWorld.sectionWidth-.5,height:CONFIG.BigWorld.sectionHeight-.5,color:e.isTrigger===!0?"rgba(0, 174, 221, 128)":e.isBlock===!0?"rgba(255, 0, 0, 128)":"rgba(0, 255, 0, 128)",touchArea:SkyEngine.Rect({width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}),on:{touchstart:e=>{e.stop()},tap:()=>{o===!0?(e.isTrigger=e.isTrigger!==!0,delete e.isBlock):(e.isTrigger!==!0&&(e.isBlock=e.isBlock!==!0),delete e.isTrigger),BigWorld.ObjectModel.update({id:t.id,sectionMap:t.sectionMap}),k()}}}))})}),u.append(SkyEngine.Line({startX:-CONFIG.BigWorld.sectionWidth,startY:0,endX:CONFIG.BigWorld.sectionWidth,endY:0,border:"1px solid #000"})),u.append(SkyEngine.Line({startX:0,startY:-CONFIG.BigWorld.sectionHeight,endX:0,endY:CONFIG.BigWorld.sectionHeight,border:"1px solid #000"}))},I=()=>{g.empty(),g.append(BigWorld.Object({objectData:t,kind:0,state:c,direction:r,itemDataSet:[e],itemKinds:[s]}))},y=()=>{k(),I(),m.empty();let t;m.append(t=UUI.VALID_FORM({errorMsgs:{category:{size:e=>{return"카테고리 ID는 "+e.max+"글자 이하로 입력해주시기 바랍니다."}},"name.ko":{size:e=>{return"이름은 "+e.max+"글자 이하로 입력해주시기 바랍니다."}}},errorMsgStyle:{marginTop:5,color:"red"},style:{backgroundColor:"#ccc",padding:10,width:300},c:[UUI.FULL_INPUT({name:"category",placeholder:"카테고리 ID"}),UUI.FULL_INPUT({style:{marginTop:10},name:"name.ko",placeholder:"이름 (한국어)"}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(t,o)=>{let i=o.getData();i.id=e.id;let n=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update(i,{notValid:e=>{n.done(),o.showErrors(e)},success:t=>{n.done(),SkyDesktop.Noti("저장하였습니다."),e=t}})}}})),t.setData(e)},B=()=>{k(),I(),void 0===e.states&&(e.states={});let t=e.states[c];void 0===t&&(t=e.states[c]={}),m.empty(),m.append(UUI.BUTTON_H({style:{flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/part.png")}),spacing:10,title:"파트 추가",on:{tap:()=>{void 0===t.parts&&(t.parts=[]);let o=t.parts.length;t.parts.push({}),i({},o),BigWorld.ItemModel.update({id:e.id,states:e.states}),I()}}})),m.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/down.png")}),spacing:10,title:"모든 파트 DOWN",on:{tap:()=>{EACH(t.parts,e=>{void 0!==e.y&&(e.y+=1)});let o=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},()=>{o.done(),SkyDesktop.Noti("파트 이동 완료"),B()})}}})),m.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/left.png")}),spacing:10,title:"모든 파트 LEFT",on:{tap:()=>{EACH(t.parts,e=>{void 0!==e.x&&(e.x-=1)});let o=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},()=>{o.done(),SkyDesktop.Noti("파트 이동 완료"),B()})}}})),m.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/up.png")}),spacing:10,title:"모든 파트 UP",on:{tap:()=>{EACH(t.parts,e=>{void 0!==e.y&&(e.y-=1)});let o=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},()=>{o.done(),SkyDesktop.Noti("파트 이동 완료"),B()})}}})),m.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/right.png")}),spacing:10,title:"모든 파트 RIGHT",on:{tap:()=>{EACH(t.parts,e=>{void 0!==e.x&&(e.x+=1)});let o=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},()=>{o.done(),SkyDesktop.Noti("파트 이동 완료"),B()})}}})),m.append(CLEAR_BOTH());let o;m.append(o=DIV());let i=(i,n)=>{let d;if(void 0!==i.frames){let e=i.frames[s];void 0!==e&&e!==TO_DELETE&&(d=e[r])}let c,l,a=!1;o.append(TABLE({style:{marginTop:10},c:TR({c:[TD({style:{width:250},c:c=FORM({style:{position:"relative",backgroundColor:"#ccc",padding:10,width:230},c:[UUI.ICON_BUTTON({style:{position:"absolute",right:-10,top:-10},icon:IMG({src:BigWorld.R("objecteditor/x.png")}),on:{tap:()=>{t.parts.splice(n,1);let o=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},()=>{o.done(),SkyDesktop.Noti("파트 제거 완료"),B()})}}}),UUI.FULL_INPUT({style:{flt:"left",width:100},name:"name.ko",placeholder:"이름 (한국어)",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{flt:"right",width:100},name:"zIndex",placeholder:"z-index",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"frameCount",placeholder:"프레임 수",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"fps",placeholder:"FPS",
on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"x",placeholder:"X",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"y",placeholder:"Y",on:{change:()=>{a===!0&&c.submit()}}}),CLEAR_BOTH(),DIV({style:{marginTop:10},c:[UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/down.png")}),on:{tap:()=>{let o=t.parts[n];void 0!==o.y&&(o.y+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),B()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/left.png")}),on:{tap:()=>{let o=t.parts[n];void 0!==o.x&&(o.x-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),B()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/up.png")}),on:{tap:()=>{let o=t.parts[n];void 0!==o.y&&(o.y-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),B()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/right.png")}),on:{tap:()=>{let o=t.parts[n];void 0!==o.x&&(o.x+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),B()})}}})]}),UUI.FULL_UPLOAD_FORM({style:{marginTop:10},box:BigWorld},{overSizeFile:()=>{alert("업로드 용량을 초과하였습니다. "+CONFIG.maxUploadFileMB+"MB 이하의 파일을 올려주세요.")},success:e=>{"image/png"===e.type?(d=e.id,c.submit()):alert("PNG 파일만 등록 가능합니다.")}}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(o,i)=>{let c=i.getData(),l=t.parts[n];l.name=c.name,l.zIndex=c.zIndex,l.frameCount=c.frameCount,l.fps=c.fps,l.x=c.x,l.y=c.y,void 0===l.frames&&(l.frames=[]),void 0!==l.frames[s]&&l.frames[s]!==TO_DELETE||(l.frames[s]={});let a=!1;l.frames[s][r]!==d&&(a=!0),l.frames[s][r]=d;let p=SkyDesktop.LoadingBar("lime");t.parts.sort((e,t)=>{return e.zIndex-t.zIndex}),BigWorld.ItemModel.update({id:e.id,states:e.states},(e,t)=>{p.done(),SkyDesktop.Noti("파트 저장 완료"),e.zIndex!==t.zIndex||a===!0?B():I()})}}})}),l=TD({style:{paddingLeft:10},c:void 0===d?void 0:IMG({style:{border:"1px solid #ccc"},src:BigWorld.RF(d)})})]})})),c.setData(i),a=!0};EACH(t.parts,i)},T=()=>{void 0!==s&&void 0!==c?B():y()};n=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),title:"기본 설정 화면",on:{tap:()=>{y()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"추가",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let o=e.kinds;void 0===o&&(o=[],e.kinds=o);let i=t.getData();o.push(i);let n=SkyDesktop.LoadingBar("lime"),d=!0;return BigWorld.ItemModel.update({id:e.id,kinds:o},{notValid:e=>{n.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),d=!1},success:()=>{n.done(),D(i)}}),d})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),title:"아이템 제거",on:{tap:()=>{SkyDesktop.Confirm({okButtonTitle:"제거",msg:"정말 제거하시겠습니까?"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(e.id,()=>{i=!0,close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:a=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:15,c:p=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:70,c:[f=DIV({style:{padding:10}}),m=DIV({style:{padding:10,paddingTop:0}})]})]})})})]}).appendTo(BODY),f.append(DIV({c:[screen=SkyEngine.SubScreen({style:{marginRight:10,flt:"left",backgroundColor:"#333",color:"#fff"},width:400,height:400,y:100,c:[u=SkyEngine.Node(),g=SkyEngine.Node()]}),DIV({style:{flt:"left"},c:[A({style:{flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/down.png")}),"회전"],on:{tap:()=>{r="down",d.save({name:t.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T(),I()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/left.png")}),"회전"],on:{tap:()=>{r="left",d.save({name:t.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T(),I()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/up.png")}),"회전"],on:{tap:()=>{r="up",d.save({name:t.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T(),I()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/right.png")}),"회전"],on:{tap:()=>{r="right",d.save({name:t.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T(),I()}}}),CLEAR_BOTH()]}),CLEAR_BOTH()]}));let S,v,D=t=>{let o;a.append(o=SkyDesktop.File({title:void 0===MSG(t.name)?FIND({array:e.kinds,value:t})+1+"번째 종류":MSG(t.name),on:{tap:(o,i)=>{void 0!==S&&S.deselect(),i===S?(s=void 0,S=void 0,d.remove(e.id),T()):(s=FIND({array:e.kinds,value:t}),S=i,i.select(),d.save({name:e.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T())},contextmenu:i=>{let n=SkyDesktop.ContextMenu({e:i,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let i;SkyDesktop.Confirm({okButtonTitle:"저장",msg:i=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let n=e.kinds;t.name=i.getData().name;let d=SkyDesktop.LoadingBar("lime"),r=!0;return BigWorld.ItemModel.update({id:e.id,kinds:n},{notValid:e=>{d.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),r=!1},success:()=>{d.done(),o.setTitle(void 0===MSG(t.name)?FIND({array:e.kinds,value:t})+1+"번째 종류":MSG(t.name))}}),r}),i.setData(t),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{void 0!==S&&(S.deselect(),s=void 0,S=void 0,d.remove(e.id),T());let i=e.kinds,n=FIND({array:i,value:t});i.splice(n,1);let r=e.states;EACH(r,e=>{EACH(e.parts,e=>{void 0!==e.frames&&e.frames.splice(n,1)})}),o.remove();let c=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update({id:e.id,kinds:i,states:r},()=>{c.done()})}),n.remove()}}})]});i.stop()}}})),FIND({array:e.kinds,value:t})===s&&o.tap()};EACH(e.kinds,D);let W=(t,o)=>{let i;p.addItem({key:o,item:i=SkyDesktop.File({title:o+(void 0===MSG(t.name)?"":" ("+MSG(t.name)+")"),on:{tap:(t,i)=>{void 0!==v&&v.deselect(),i===v?(c=void 0,v=void 0,d.remove(e.id),T()):(c=o,v=i,i.select(),d.save({name:e.id,value:{direction:r,selectedKindIndex:s,selectedState:c}}),T())}}})}),o===c&&i.tap()};EACH(t.states,W),T()})})}),window.addEventListener("beforeunload",e=>{if(i!==!0)return e.returnValue=null,null}),e.on("close",()=>{void 0!==n&&n.remove(),r.remove(),s.remove()})}}),BigWorld.ObjectEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld Object Editor");let o,i,n,d=BigWorld.STORE("objectEditorStore"),r=EVENT("keydown",e=>{"Control"===e.getKey()&&(o=!0)}),s=EVENT("keyup",e=>{"Control"===e.getKey()&&(o=!1)});e.on("paramsChange",e=>{BigWorld.ObjectModel.get(e.objectId,e=>{let t,r,s,c=d.get(e.id);void 0!==c&&(t=c.direction,r=c.selectedKindIndex,s=c.selectedState),void 0===t&&(t="down");let l,a,p,g,u,f=()=>{g.empty();let i,n,c=()=>{n.empty(),EACH(e.sectionMap,(i,d)=>{EACH(i,(i,r)=>{let s,l;"down"===t&&(s=CONFIG.BigWorld.sectionWidth*(r-e.sectionLeftLevel),l=CONFIG.BigWorld.sectionHeight*(d-e.sectionUpLevel)),"left"===t&&(s=-CONFIG.BigWorld.sectionHeight*(d-e.sectionUpLevel),l=CONFIG.BigWorld.sectionWidth*(r-e.sectionLeftLevel)),"up"===t&&(s=-CONFIG.BigWorld.sectionWidth*(r-e.sectionLeftLevel),l=-CONFIG.BigWorld.sectionHeight*(d-e.sectionUpLevel)),"right"===t&&(s=CONFIG.BigWorld.sectionHeight*(d-e.sectionUpLevel),l=-CONFIG.BigWorld.sectionWidth*(r-e.sectionLeftLevel)),n.append(SkyEngine.Rect({x:s,y:l,width:CONFIG.BigWorld.sectionWidth-.5,height:CONFIG.BigWorld.sectionHeight-.5,color:i.isTrigger===!0?"rgba(0, 174, 221, 128)":i.isBlock===!0?"rgba(255, 0, 0, 128)":"rgba(0, 255, 0, 128)",touchArea:SkyEngine.Rect({width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}),on:{touchstart:e=>{e.stop()},tap:()=>{o===!0?(i.isTrigger=i.isTrigger!==!0,delete i.isBlock):(i.isTrigger!==!0&&(i.isBlock=i.isBlock!==!0),delete i.isTrigger),BigWorld.ObjectModel.update({id:e.id,sectionMap:e.sectionMap}),c()}}}))})}),n.append(SkyEngine.Line({startX:-CONFIG.BigWorld.sectionWidth,startY:0,endX:CONFIG.BigWorld.sectionWidth,endY:0,border:"1px solid #000"})),n.append(SkyEngine.Line({startX:0,startY:-CONFIG.BigWorld.sectionHeight,endX:0,endY:CONFIG.BigWorld.sectionHeight,border:"1px solid #000"}))};g.append(DIV({c:[i=SkyEngine.SubScreen({style:{marginRight:10,flt:"left",backgroundColor:"#333",color:"#fff"},width:400,height:400,y:100,c:[n=SkyEngine.Node(),p=SkyEngine.Node()]}),DIV({style:{flt:"left"},c:[DIV({c:[A({c:IMG({src:BigWorld.R("objecteditor/arrow/lb.png")}),on:{tap:()=>{e.sectionLeftLevel+=1,EACH(e.sectionMap,e=>{e.unshift({z:0})}),BigWorld.ObjectModel.update({id:e.id,sectionLeftLevel:e.sectionLeftLevel,sectionMap:e.sectionMap}),c()}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/ub.png")}),on:{tap:()=>{e.sectionUpLevel+=1;let t=[];REPEAT(e.sectionLeftLevel+e.sectionRightLevel+1,()=>{t.push({z:0})}),e.sectionMap.unshift(t),BigWorld.ObjectModel.update({id:e.id,sectionUpLevel:e.sectionUpLevel,sectionMap:e.sectionMap}),c()}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/rb.png")}),on:{tap:()=>{e.sectionRightLevel+=1,EACH(e.sectionMap,e=>{e.push({z:0})}),BigWorld.ObjectModel.update({id:e.id,sectionRightLevel:e.sectionRightLevel,sectionMap:e.sectionMap}),c()}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/db.png")}),on:{tap:()=>{e.sectionDownLevel+=1;let t=[];REPEAT(e.sectionLeftLevel+e.sectionRightLevel+1,()=>{t.push({z:0})}),e.sectionMap.push(t),BigWorld.ObjectModel.update({id:e.id,sectionDownLevel:e.sectionDownLevel,sectionMap:e.sectionMap}),c()}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/rr.png")}),on:{tap:()=>{e.sectionLeftLevel>=1&&(e.sectionLeftLevel-=1,EACH(e.sectionMap,e=>{e.shift()}),BigWorld.ObjectModel.update({id:e.id,sectionLeftLevel:e.sectionLeftLevel,sectionMap:e.sectionMap}),c())}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/dr.png")}),on:{tap:()=>{e.sectionUpLevel>=1&&(e.sectionUpLevel-=1,e.sectionMap.shift(),BigWorld.ObjectModel.update({id:e.id,sectionUpLevel:e.sectionUpLevel,sectionMap:e.sectionMap}),c())}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/lr.png")}),on:{tap:()=>{e.sectionRightLevel>=1&&(e.sectionRightLevel-=1,EACH(e.sectionMap,e=>{e.pop()}),BigWorld.ObjectModel.update({id:e.id,sectionRightLevel:e.sectionRightLevel,sectionMap:e.sectionMap}),c())}}}),A({c:IMG({src:BigWorld.R("objecteditor/arrow/ur.png")}),on:{tap:()=>{e.sectionDownLevel>=1&&(e.sectionDownLevel-=1,e.sectionMap.pop(),BigWorld.ObjectModel.update({id:e.id,sectionDownLevel:e.sectionDownLevel,sectionMap:e.sectionMap}),c())}}})]}),DIV({c:[A({style:{flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/down.png")}),"회전"],on:{tap:()=>{t="down",d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y(),m()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/left.png")}),"회전"],on:{tap:()=>{t="left",d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y(),m()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/up.png")}),"회전"],on:{tap:()=>{t="up",d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y(),m()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("objecteditor/right.png")}),"회전"],on:{tap:()=>{t="right",d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y(),m()}}}),CLEAR_BOTH()]}),DIV({c:[UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/section/block.png")}),spacing:10,title:"모든 섹션을 블록 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 블록 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{e.isBlock=!0,delete e.isTrigger})}),BigWorld.ObjectModel.update({id:e.id,sectionMap:e.sectionMap}),c()})}}}),UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/section/section.png")}),spacing:10,title:"모든 섹션을 일반 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 일반 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{delete e.isBlock,delete e.isTrigger})}),BigWorld.ObjectModel.update({id:e.id,sectionMap:e.sectionMap}),c()})}}}),UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/section/trigger.png")}),spacing:10,title:"모든 섹션을 트리거 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 트리거 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{delete e.isBlock,e.isTrigger=!0})}),BigWorld.ObjectModel.update({id:e.id,sectionMap:e.sectionMap}),c()})}}})]}),UL({style:{marginTop:10,marginLeft:20,listStyle:"disc"},c:[LI({c:"섹션을 클릭하면 블록 섹션으로 변경됩니다."}),LI({c:"컨트롤 키를 누른 상태로 섹션을 클릭하면 트리거 섹션으로 변경됩니다."})]})]}),CLEAR_BOTH()]})),c()},m=()=>{p.empty(),p.append(BigWorld.Object({objectData:e,kind:r,state:s,direction:t}))},k=()=>{f(),m(),u.empty();let t;u.append(t=UUI.VALID_FORM({errorMsgs:{category:{size:e=>{return"카테고리 ID는 "+e.max+"글자 이하로 입력해주시기 바랍니다."}},"name.ko":{size:e=>{return"이름은 "+e.max+"글자 이하로 입력해주시기 바랍니다."}}},errorMsgStyle:{marginTop:5,color:"red"},style:{backgroundColor:"#ccc",padding:10,width:300},c:[UUI.FULL_INPUT({name:"category",placeholder:"카테고리 ID"}),UUI.FULL_INPUT({style:{marginTop:10},name:"name.ko",placeholder:"이름 (한국어)"}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(t,o)=>{let i=o.getData();i.id=e.id;let n=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update(i,{notValid:e=>{n.done(),o.showErrors(e)},success:t=>{n.done(),SkyDesktop.Noti("저장하였습니다."),e=t}})}}})),t.setData(e)},I=()=>{f(),m();let o=e.states[s];u.empty(),u.append(UUI.BUTTON_H({style:{flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/part.png")}),spacing:10,title:"파트 추가",on:{tap:()=>{void 0===o.parts&&(o.parts=[]);let t=o.parts.length;o.parts.push({}),n({},t),BigWorld.ObjectModel.update({id:e.id,states:e.states}),m()}}})),u.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/down.png")}),spacing:10,title:"모든 파트 DOWN",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.y&&(e.y+=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),I()})}}})),u.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/left.png")}),spacing:10,title:"모든 파트 LEFT",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.x&&(e.x-=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),I()})}}})),u.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/up.png")}),spacing:10,title:"모든 파트 UP",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.y&&(e.y-=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),I()})}}})),u.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("objecteditor/right.png")}),spacing:10,title:"모든 파트 RIGHT",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.x&&(e.x+=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),I()})}}})),u.append(CLEAR_BOTH());let i;u.append(i=DIV());let n=(n,d)=>{let s;if(void 0!==n.frames){let e=n.frames[r];void 0!==e&&e!==TO_DELETE&&(s=e[t])}let c,l,a=!1;i.append(TABLE({style:{marginTop:10},c:TR({c:[TD({style:{width:250},c:c=FORM({style:{position:"relative",backgroundColor:"#ccc",padding:10,width:230},c:[UUI.ICON_BUTTON({style:{position:"absolute",right:-10,top:-10},icon:IMG({src:BigWorld.R("objecteditor/x.png")}),on:{tap:()=>{o.parts.splice(d,1);let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 제거 완료"),I()})}}}),UUI.FULL_INPUT({style:{flt:"left",width:100},name:"name.ko",placeholder:"이름 (한국어)",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{flt:"right",width:100},name:"zIndex",placeholder:"z-index",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"frameCount",placeholder:"프레임 수",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"fps",placeholder:"FPS",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"x",placeholder:"X",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"y",placeholder:"Y",on:{change:()=>{a===!0&&c.submit()}}}),CLEAR_BOTH(),DIV({style:{marginTop:10},c:[UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/down.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.y&&(t.y+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),I()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/left.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.x&&(t.x-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),I()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/up.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.y&&(t.y-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),I()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("objecteditor/right.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.x&&(t.x+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),I()})}}})]}),UUI.FULL_UPLOAD_FORM({style:{marginTop:10},box:BigWorld},{overSizeFile:()=>{alert("업로드 용량을 초과하였습니다. "+CONFIG.maxUploadFileMB+"MB 이하의 파일을 올려주세요.")},success:e=>{"image/png"===e.type?(s=e.id,c.submit()):alert("PNG 파일만 등록 가능합니다.")}}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(i,n)=>{let c=n.getData(),l=o.parts[d];l.name=c.name,l.zIndex=c.zIndex,l.frameCount=c.frameCount,l.fps=c.fps,l.x=c.x,l.y=c.y,void 0===l.frames&&(l.frames=[]),void 0!==l.frames[r]&&l.frames[r]!==TO_DELETE||(l.frames[r]={});let a=!1;l.frames[r][t]!==s&&(a=!0),l.frames[r][t]=s;let p=SkyDesktop.LoadingBar("lime");o.parts.sort((e,t)=>{return e.zIndex-t.zIndex}),BigWorld.ObjectModel.update({id:e.id,states:e.states},(e,t)=>{p.done(),SkyDesktop.Noti("파트 저장 완료"),e.zIndex!==t.zIndex||a===!0?I():m()})}}})}),l=TD({style:{paddingLeft:10},c:void 0===s?void 0:IMG({style:{border:"1px solid #ccc"},src:BigWorld.RF(s)})})]})})),c.setData(n),a=!0};EACH(o.parts,n)},y=()=>{void 0!==r&&void 0!==s?I():k()};n=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),title:"기본 설정 화면",on:{tap:()=>{k()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"추가",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let o=e.kinds;void 0===o&&(o=[],e.kinds=o);let i=t.getData();o.push(i);let n=SkyDesktop.LoadingBar("lime"),d=!0;return BigWorld.ObjectModel.update({id:e.id,kinds:o},{notValid:e=>{n.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),d=!1},success:()=>{n.done(),S(i)}}),d})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/state.png")}),title:"상태 추가",on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"추가",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"id",placeholder:"상태 ID"}),INPUT({style:{marginTop:10,width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"상태 이름 (한국어)"})]})},()=>{let o=t.getData();if(VALID.notEmpty(o.id)===!0){let t=e.states;void 0===t&&(t={});let i=!0;if(void 0===t[o.id]){t[o.id]={},VALID.notEmpty(o.name)===!0&&(t[o.id].name=o.name);let n=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:t},{notValid:()=>{n.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{n.done(),v(o,o.id)}})}else SkyDesktop.Alert({msg:"이미 입력하신 상태 ID에 해당하는 상태가 존재합니다. 다른 ID를 입력하거나, 상태를 지우고 다시 생성해주시기 바랍니다."}),i=!1;return i}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),title:"객체 제거",on:{tap:()=>{SkyDesktop.Confirm({okButtonTitle:"제거",msg:"정말 제거하시겠습니까?"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(e.id,()=>{i=!0,close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:l=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:15,c:a=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:70,c:[g=DIV({style:{padding:10}}),u=DIV({style:{padding:10,paddingTop:0}})]})]})})})]}).appendTo(BODY);let B,T,S=o=>{let i;l.append(i=SkyDesktop.File({title:void 0===MSG(o.name)?FIND({array:e.kinds,value:o})+1+"번째 종류":MSG(o.name),on:{tap:(i,n)=>{void 0!==B&&B.deselect(),n===B?(r=void 0,B=void 0,d.remove(e.id),y()):(r=FIND({array:e.kinds,value:o}),B=n,n.select(),d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y())},contextmenu:t=>{let n=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let n=e.kinds;o.name=t.getData().name;let d=SkyDesktop.LoadingBar("lime"),r=!0;return BigWorld.ObjectModel.update({id:e.id,kinds:n},{notValid:e=>{d.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),r=!1},success:()=>{d.done(),i.setTitle(void 0===MSG(o.name)?FIND({array:e.kinds,value:o})+1+"번째 종류":MSG(o.name))}}),r}),t.setData(o),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{void 0!==B&&(B.deselect(),r=void 0,B=void 0,d.remove(e.id),y());let t=e.kinds,n=FIND({array:t,value:o});t.splice(n,1);let s=e.states;EACH(s,e=>{EACH(e.parts,e=>{void 0!==e.frames&&e.frames.splice(n,1)})}),i.remove();let c=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,kinds:t,states:s},()=>{c.done()})}),n.remove()}}})]});t.stop()}}})),FIND({array:e.kinds,value:o})===r&&i.tap()};EACH(e.kinds,S);let v=(o,i)=>{let n;a.addItem({key:i,item:n=SkyDesktop.File({title:i+(void 0===MSG(o.name)?"":" ("+MSG(o.name)+")"),on:{tap:(o,n)=>{void 0!==T&&T.deselect(),n===T?(s=void 0,T=void 0,d.remove(e.id),y()):(s=i,T=n,n.select(),d.save({name:e.id,value:{direction:t,selectedKindIndex:r,selectedState:s}}),y())},contextmenu:t=>{let n=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{let t,r=i;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"id",placeholder:"상태 ID"}),INPUT({style:{marginTop:10,width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"상태 이름 (한국어)"})]})},()=>{void 0!==T&&(T.deselect(),s=void 0,T=void 0,d.remove(e.id),y());let o=t.getData();if(VALID.notEmpty(o.id)===!0){let t=e.states,i=!0;if(o.id===r||void 0===t[o.id]){delete t[r],a.removeItem(r),t[o.id]={},VALID.notEmpty(o.name)===!0&&(t[o.id].name=o.name);let n=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:t},{notValid:()=>{n.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),i=!1},success:()=>{n.done(),v(o,o.id)}})}else SkyDesktop.Alert({msg:"이미 입력하신 상태 ID에 해당하는 상태가 존재합니다. 다른 ID를 입력하거나, 상태를 지우고 다시 생성해주시기 바랍니다."}),i=!1;return i}}),o.id=i,t.setData(o),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"상태 삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{void 0!==T&&(T.deselect(),s=void 0,T=void 0,d.remove(e.id),y());let t=e.states;delete t[i],a.removeItem(i);let o=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update({id:e.id,states:t},()=>{o.done()})}),n.remove()}}})]});t.stop()}}})}),i===s&&n.tap()};EACH(e.states,v),y()})}),window.addEventListener("beforeunload",e=>{if(i!==!0)return e.returnValue=null,null}),e.on("close",()=>{void 0!==n&&n.remove(),r.remove(),s.remove()})}}),BigWorld.StageEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld Stage Editor");let o,i,n,d,r,s,c,l,a,p=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,g=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,u=SkyEngine.Rect({width:WIN_WIDTH(),height:WIN_HEIGHT(),color:"#333"}).appendTo(SkyEngine.Screen),f=EVENT("resize",()=>{u.setWidth(WIN_WIDTH()),u.setHeight(WIN_HEIGHT())});e.on("paramsChange",e=>{BigWorld.StageModel.get(e.stageId,e=>{o=BigWorld.Stage({stageData:e,isToShowGrid:!0},e=>{void 0!==i&&i.remove(),i=SkyEngine.Node({x:e.getX(),y:e.getY(),dom:DIV({style:{backgroundColor:"#fff",color:"#000",borderRadius:5},on:{touchstart:e=>{e.stop()}},c:[UUI.BUTTON_H({style:{padding:5},icon:IMG({src:BigWorld.R("stageeditor/delete.png")}),spacing:10,title:"삭제하기",on:{tap:t=>{BigWorld.StageObjectModel.remove(e.getId()),i.remove(),i=void 0,t.stop()}}})]})}).appendTo(o)}).appendTo(SkyEngine.Screen);let t,u,f,m=()=>{void 0!==c&&(c.remove(),c=void 0),void 0!==l&&(l.remove(),l=void 0),void 0!==n&&(n.remove(),n=void 0),void 0!==d&&(d.remove(),d=void 0),t.empty(),u.empty(),f.empty()};r=DIV({style:{position:"fixed",left:0,top:0,padding:10},c:[DIV({c:"맵 이름: "+MSG(e.name)}),DIV({c:["확대:",A({style:{marginLeft:5},c:"x1",on:{tap:()=>{o.setScale(1)}}}),A({style:{marginLeft:5},c:"x2",on:{tap:()=>{o.setScale(2)}}}),A({style:{marginLeft:5},c:"x4",on:{tap:()=>{o.setScale(4)}}}),A({style:{marginLeft:5},c:"x8",on:{tap:()=>{o.setScale(8)}}})]}),UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/object.png")}),spacing:10,title:"객체 선택",on:{tap:()=>{m(),BigWorld.CreateSelectObjectPopup((i,d,r)=>{let s;EACH(i.states,(e,t)=>{s=t}),n=BigWorld.Object({x:(d-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()-o.getX(),y:(r-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()-o.getY(),objectData:i,kind:0,state:s,direction:"down"}).appendTo(o),c=EVENT("touchmove",e=>{n.setX((e.getLeft()-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()-o.getX()),n.setY((e.getTop()-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()-o.getY())}),l=EVENT("tap",t=>{let o=INTEGER(n.getY()<0?n.getY()/g-.5:n.getY()/g+.5),d=INTEGER(n.getX()<0?n.getX()/p-.5:n.getX()/p+.5),r=INTEGER(n.getY()<0?n.getY()/CONFIG.BigWorld.sectionHeight-.5:n.getY()/CONFIG.BigWorld.sectionHeight+.5),s=INTEGER(n.getX()<0?n.getX()/CONFIG.BigWorld.sectionWidth-.5:n.getX()/CONFIG.BigWorld.sectionWidth+.5);r-=o*CONFIG.BigWorld.tileSectionLevel,s-=d*CONFIG.BigWorld.tileSectionLevel,BigWorld.StageObjectModel.create({stageId:e.id,objectId:i.id,kind:n.getKind(),state:n.getState(),itemInfos:n.getItemInfos(),direction:n.getDirection(),tileRow:o,tileCol:d,sectionRow:r,sectionCol:s,isReverse:n.checkIsReverse()===!0||void 0})}),t.empty(),u.empty(),f.empty(),EACH(i.kinds,(e,t)=>{f.append(UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/reverse.png")}),spacing:10,title:"좌우 반전",on:{tap:e=>{n.reverse(),e.stop()}}}))}),EACH(i.kinds,(e,t)=>{f.append(UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/kind.png")}),spacing:10,title:MSG(e.name),on:{tap:e=>{n.changeKind(t),e.stop()}}}))}),EACH(i.states,(e,t)=>{f.append(UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/state.png")}),spacing:10,title:MSG(e.name),on:{tap:e=>{n.changeState(t),e.stop()}}}))}),BigWorld.ItemModel.find({filter:{objectId:i.id}},EACH(e=>{f.append(SkyDesktop.Folder({style:{marginTop:10},spacing:10,title:MSG(e.name),on:{tap:e=>{e.stop()},open:(t,o)=>{EACH(e.kinds,(t,i)=>{o.addItem({key:i,item:UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/kind.png")}),spacing:10,title:MSG(t.name),on:{tap:t=>{n.checkItemExists({itemId:e.id,kind:i})===!0?n.removeItem(e.id):n.addItem({itemData:e,kind:i}),t.stop()}}})})})},close:(e,t)=>{t.removeAllItems()}}}))}))})}}}),UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/tile.png")}),spacing:10,title:"타일 선택",on:{tap:()=>{m(),BigWorld.CreateSelectTilePopup((i,n,r)=>{let s;EACH(i.states,(e,t)=>{s=t}),d=BigWorld.Tile({x:(n-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()-o.getX(),y:(r-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()-o.getY(),tileData:i,kind:0,state:s}).appendTo(o),c=EVENT("touchmove",e=>{d.setX((e.getLeft()-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()-o.getX()),d.setY((e.getTop()-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()-o.getY())}),l=EVENT("tap",t=>{let o=INTEGER(d.getY()<0?d.getY()/g-.5:d.getY()/g+.5),n=INTEGER(d.getX()<0?d.getX()/p-.5:d.getX()/p+.5),r=INTEGER(d.getY()<0?d.getY()/CONFIG.BigWorld.sectionHeight-.5:d.getY()/CONFIG.BigWorld.sectionHeight+.5),s=INTEGER(d.getX()<0?d.getX()/CONFIG.BigWorld.sectionWidth-.5:d.getX()/CONFIG.BigWorld.sectionWidth+.5);r-=o*CONFIG.BigWorld.tileSectionLevel,s-=n*CONFIG.BigWorld.tileSectionLevel,BigWorld.StageTileModel.create({stageId:e.id,tileId:i.id,kind:d.getKind(),tileRow:o,tileCol:n})}),t.empty(),u.empty(),f.empty(),EACH(i.kinds,(e,t)=>{f.append(UUI.BUTTON_H({style:{marginTop:10},icon:IMG({src:BigWorld.R("stageeditor/kind.png")}),spacing:10,title:MSG(e.name),on:{tap:e=>{d.changeKind(t),e.stop()}}}))})})}}}),t=DIV(),u=DIV(),f=DIV()]}).appendTo(BODY),s=EVENT("touchstart",e=>{let t=e.getLeft(),n=e.getTop(),d=o.getX(),r=o.getY(),s=EVENT("touchmove",e=>{o.setPosition({x:d+e.getLeft()-t,y:r+e.getTop()-n})});EVENT_ONCE("touchend",()=>{s.remove()}),void 0!==i&&(i.remove(),i=void 0)}),a=EVENT("keydown",e=>{"Escape"===e.getKey()&&(void 0!==i&&(i.remove(),i=void 0),m())})})}),e.on("close",()=>{u.remove(),f.remove(),void 0!==o&&o.remove(),void 0!==i&&i.remove(),void 0!==r&&r.remove(),void 0!==s&&s.remove(),void 0!==c&&c.remove(),void 0!==a&&a.remove()})}}),BigWorld.TileEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld Tile Editor");let o,i,n,d=(CONFIG.BigWorld.tileSectionLevel-1)/2,r=BigWorld.STORE("tileEditorStore"),s=EVENT("keydown",e=>{"Control"===e.getKey()&&(o=!0)}),c=EVENT("keyup",e=>{"Control"===e.getKey()&&(o=!1)});e.on("paramsChange",e=>{BigWorld.TileModel.get(e.tileId,e=>{let t,s,c,l=r.get(e.id);void 0!==l&&(t=l.direction,s=l.selectedKindIndex,c=l.selectedState),void 0===t&&(t="down");let a,p,g,u,f,m=()=>{u.empty();let i,n,l=()=>{n.empty(),EACH(e.sectionMap,(i,r)=>{EACH(i,(i,s)=>{let c,a;"down"===t&&(c=CONFIG.BigWorld.sectionWidth*(s-d),a=CONFIG.BigWorld.sectionHeight*(r-d)),"left"===t&&(c=-CONFIG.BigWorld.sectionHeight*(r-d),a=CONFIG.BigWorld.sectionWidth*(s-d)),"up"===t&&(c=-CONFIG.BigWorld.sectionWidth*(s-d),a=-CONFIG.BigWorld.sectionHeight*(r-d)),"right"===t&&(c=CONFIG.BigWorld.sectionHeight*(r-d),a=-CONFIG.BigWorld.sectionWidth*(s-d)),n.append(SkyEngine.Rect({x:c,
y:a,width:CONFIG.BigWorld.sectionWidth-.5,height:CONFIG.BigWorld.sectionHeight-.5,color:i.isTrigger===!0?"rgba(0, 174, 221, 128)":i.isBlock===!0?"rgba(255, 0, 0, 128)":"rgba(0, 255, 0, 128)",touchArea:SkyEngine.Rect({width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}),on:{touchstart:e=>{e.stop()},tap:()=>{o===!0?(i.isTrigger=i.isTrigger!==!0,delete i.isBlock):(i.isTrigger!==!0&&(i.isBlock=i.isBlock!==!0),delete i.isTrigger),BigWorld.TileModel.update({id:e.id,sectionMap:e.sectionMap}),l()}}}))})}),n.append(SkyEngine.Line({startX:-CONFIG.BigWorld.sectionWidth,startY:0,endX:CONFIG.BigWorld.sectionWidth,endY:0,border:"1px solid #000"})),n.append(SkyEngine.Line({startX:0,startY:-CONFIG.BigWorld.sectionHeight,endX:0,endY:CONFIG.BigWorld.sectionHeight,border:"1px solid #000"}))};u.append(DIV({c:[i=SkyEngine.SubScreen({style:{marginRight:10,flt:"left",backgroundColor:"#333",color:"#fff"},width:400,height:400,y:100,c:[n=SkyEngine.Node(),g=SkyEngine.Node()]}),DIV({style:{flt:"left"},c:[DIV({c:[A({style:{flt:"left"},c:[IMG({src:BigWorld.R("tileeditor/down.png")}),"회전"],on:{tap:()=>{t="down",r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B(),k()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("tileeditor/left.png")}),"회전"],on:{tap:()=>{t="left",r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B(),k()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("tileeditor/up.png")}),"회전"],on:{tap:()=>{t="up",r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B(),k()}}}),A({style:{marginLeft:10,flt:"left"},c:[IMG({src:BigWorld.R("tileeditor/right.png")}),"회전"],on:{tap:()=>{t="right",r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B(),k()}}}),CLEAR_BOTH()]}),DIV({c:[UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/section/block.png")}),spacing:10,title:"모든 섹션을 블록 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 블록 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{e.isBlock=!0,delete e.isTrigger})}),BigWorld.TileModel.update({id:e.id,sectionMap:e.sectionMap}),l()})}}}),UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/section/section.png")}),spacing:10,title:"모든 섹션을 일반 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 일반 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{delete e.isBlock,delete e.isTrigger})}),BigWorld.TileModel.update({id:e.id,sectionMap:e.sectionMap}),l()})}}}),UUI.BUTTON_H({style:{marginTop:10,padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/section/trigger.png")}),spacing:10,title:"모든 섹션을 트리거 섹션으로 변경",on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 모든 섹션을 트리거 섹션으로 변경하시겠습니까?"},()=>{EACH(e.sectionMap,(e,t)=>{EACH(e,(e,t)=>{delete e.isBlock,e.isTrigger=!0})}),BigWorld.TileModel.update({id:e.id,sectionMap:e.sectionMap}),l()})}}})]}),UL({style:{marginTop:10,marginLeft:20,listStyle:"disc"},c:[LI({c:"섹션을 클릭하면 블록 섹션으로 변경됩니다."}),LI({c:"컨트롤 키를 누른 상태로 섹션을 클릭하면 트리거 섹션으로 변경됩니다."})]})]}),CLEAR_BOTH()]})),l()},k=()=>{g.empty(),g.append(BigWorld.Tile({tileData:e,kind:s,state:c,direction:t}))},I=()=>{m(),k(),f.empty();let t;f.append(t=UUI.VALID_FORM({errorMsgs:{category:{size:e=>{return"카테고리 ID는 "+e.max+"글자 이하로 입력해주시기 바랍니다."}},"name.ko":{size:e=>{return"이름은 "+e.max+"글자 이하로 입력해주시기 바랍니다."}}},errorMsgStyle:{marginTop:5,color:"red"},style:{backgroundColor:"#ccc",padding:10,width:300},c:[UUI.FULL_INPUT({name:"category",placeholder:"카테고리 ID"}),UUI.FULL_INPUT({style:{marginTop:10},name:"name.ko",placeholder:"이름 (한국어)"}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(t,o)=>{let i=o.getData();i.id=e.id;let n=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update(i,{notValid:e=>{n.done(),o.showErrors(e)},success:t=>{n.done(),SkyDesktop.Noti("저장하였습니다."),e=t}})}}})),t.setData(e)},y=()=>{m(),k();let o=e.states[c];f.empty(),f.append(UUI.BUTTON_H({style:{flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/part.png")}),spacing:10,title:"파트 추가",on:{tap:()=>{void 0===o.parts&&(o.parts=[]);let t=o.parts.length;o.parts.push({}),n({},t),BigWorld.TileModel.update({id:e.id,states:e.states}),k()}}})),f.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/down.png")}),spacing:10,title:"모든 파트 DOWN",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.y&&(e.y+=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),y()})}}})),f.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/left.png")}),spacing:10,title:"모든 파트 LEFT",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.x&&(e.x-=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),y()})}}})),f.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/up.png")}),spacing:10,title:"모든 파트 UP",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.y&&(e.y-=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),y()})}}})),f.append(UUI.BUTTON_H({style:{marginLeft:10,flt:"left",padding:5,border:"1px solid #ccc",borderRadius:3},icon:IMG({src:BigWorld.R("tileeditor/right.png")}),spacing:10,title:"모든 파트 RIGHT",on:{tap:()=>{EACH(o.parts,e=>{void 0!==e.x&&(e.x+=1)});let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 이동 완료"),y()})}}})),f.append(CLEAR_BOTH());let i;f.append(i=DIV());let n=(n,d)=>{let r;if(void 0!==n.frames){let e=n.frames[s];void 0!==e&&e!==TO_DELETE&&(r=e[t])}let c,l,a=!1;i.append(TABLE({style:{marginTop:10},c:TR({c:[TD({style:{width:250},c:c=FORM({style:{position:"relative",backgroundColor:"#ccc",padding:10,width:230},c:[UUI.ICON_BUTTON({style:{position:"absolute",right:-10,top:-10},icon:IMG({src:BigWorld.R("tileeditor/x.png")}),on:{tap:()=>{o.parts.splice(d,1);let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},()=>{t.done(),SkyDesktop.Noti("파트 제거 완료"),y()})}}}),UUI.FULL_INPUT({style:{flt:"left",width:100},name:"name.ko",placeholder:"이름 (한국어)",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{flt:"right",width:100},name:"zIndex",placeholder:"z-index",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"frameCount",placeholder:"프레임 수",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"fps",placeholder:"FPS",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"x",placeholder:"X",on:{change:()=>{a===!0&&c.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"y",placeholder:"Y",on:{change:()=>{a===!0&&c.submit()}}}),CLEAR_BOTH(),DIV({style:{marginTop:10},c:[UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("tileeditor/down.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.y&&(t.y+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),y()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("tileeditor/left.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.x&&(t.x-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),y()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("tileeditor/up.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.y&&(t.y-=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),y()})}}}),UUI.ICON_BUTTON({icon:IMG({src:BigWorld.R("tileeditor/right.png")}),on:{tap:()=>{let t=o.parts[d];void 0!==t.x&&(t.x+=1);let i=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,states:e.states},(e,t)=>{i.done(),SkyDesktop.Noti("파트 저장 완료"),y()})}}})]}),UUI.FULL_UPLOAD_FORM({style:{marginTop:10},box:BigWorld},{overSizeFile:()=>{alert("업로드 용량을 초과하였습니다. "+CONFIG.maxUploadFileMB+"MB 이하의 파일을 올려주세요.")},success:e=>{"image/png"===e.type?(r=e.id,c.submit()):alert("PNG 파일만 등록 가능합니다.")}}),UUI.FULL_SUBMIT({style:{marginTop:10},value:"저장하기"})],on:{submit:(i,n)=>{let c=n.getData(),l=o.parts[d];l.name=c.name,l.zIndex=c.zIndex,l.frameCount=c.frameCount,l.fps=c.fps,l.x=c.x,l.y=c.y,void 0===l.frames&&(l.frames=[]),void 0!==l.frames[s]&&l.frames[s]!==TO_DELETE||(l.frames[s]={});let a=!1;l.frames[s][t]!==r&&(a=!0),l.frames[s][t]=r;let p=SkyDesktop.LoadingBar("lime");o.parts.sort((e,t)=>{return e.zIndex-t.zIndex}),BigWorld.TileModel.update({id:e.id,states:e.states},(e,t)=>{p.done(),SkyDesktop.Noti("파트 저장 완료"),e.zIndex!==t.zIndex||a===!0?y():k()})}}})}),l=TD({style:{paddingLeft:10},c:void 0===r?void 0:IMG({style:{border:"1px solid #ccc"},src:BigWorld.RF(r)})})]})})),c.setData(n),a=!0};EACH(o.parts,n)},B=()=>{void 0!==s&&void 0!==c?y():I()};n=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),title:"기본 설정 화면",on:{tap:()=>{I()}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"추가",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let o=e.kinds;void 0===o&&(o=[],e.kinds=o);let i=t.getData();o.push(i);let n=SkyDesktop.LoadingBar("lime"),d=!0;return BigWorld.TileModel.update({id:e.id,kinds:o},{notValid:e=>{n.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),d=!1},success:()=>{n.done(),v(i)}}),d})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/delete.png")}),title:"타일 제거",on:{tap:()=>{SkyDesktop.Confirm({okButtonTitle:"제거",msg:"정말 제거하시겠습니까?"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(e.id,()=>{i=!0,close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:a=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:15,c:p=SkyDesktop.FileTree()}),SkyDesktop.Tab({size:70,c:[u=DIV({style:{padding:10}}),f=DIV({style:{padding:10,paddingTop:0}})]})]})})})]}).appendTo(BODY);let T,S,v=o=>{let i;a.append(i=SkyDesktop.File({title:void 0===MSG(o.name)?FIND({array:e.kinds,value:o})+1+"번째 종류":MSG(o.name),on:{tap:(i,n)=>{void 0!==T&&T.deselect(),n===T?(s=void 0,T=void 0,r.remove(e.id),B()):(s=FIND({array:e.kinds,value:o}),T=n,n.select(),r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B())},contextmenu:t=>{let n=SkyDesktop.ContextMenu({e:t,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),on:{tap:()=>{let t;SkyDesktop.Confirm({okButtonTitle:"저장",msg:t=FORM({c:[INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:"name.ko",placeholder:"종류 이름 (한국어)"})]})},()=>{let n=e.kinds;o.name=t.getData().name;let d=SkyDesktop.LoadingBar("lime"),r=!0;return BigWorld.TileModel.update({id:e.id,kinds:n},{notValid:e=>{d.done(),SkyDesktop.Alert({msg:"검증에 실패하였습니다. 값에 오류가 없는지 확인해주시기 바랍니다."}),r=!1},success:()=>{d.done(),i.setTitle(void 0===MSG(o.name)?FIND({array:e.kinds,value:o})+1+"번째 종류":MSG(o.name))}}),r}),t.setData(o),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("tileeditor/menu/delete.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 삭제하시겠습니까?"},()=>{void 0!==T&&(T.deselect(),s=void 0,T=void 0,r.remove(e.id),B());let t=e.kinds,n=FIND({array:t,value:o});t.splice(n,1);let d=e.states;EACH(d,e=>{EACH(e.parts,e=>{void 0!==e.frames&&e.frames.splice(n,1)})}),i.remove();let c=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.update({id:e.id,kinds:t,states:d},()=>{c.done()})}),n.remove()}}})]});t.stop()}}})),FIND({array:e.kinds,value:o})===s&&i.tap()};EACH(e.kinds,v);let D=(o,i)=>{let n;p.addItem({key:i,item:n=SkyDesktop.File({icon:IMG({src:BigWorld.R("tileeditor/state/"+i.toLowerCase()+".png")}),title:i,on:{tap:(o,n)=>{void 0!==S&&S.deselect(),n===S?(c=void 0,S=void 0,r.remove(e.id),B()):(c=i,S=n,n.select(),r.save({name:e.id,value:{direction:t,selectedKindIndex:s,selectedState:c}}),B())}}})}),i===c&&n.tap()};EACH(e.states,D),B()})}),window.addEventListener("beforeunload",e=>{if(i!==!0)return e.returnValue=null,null}),e.on("close",()=>{void 0!==n&&n.remove(),s.remove(),c.remove()})}});