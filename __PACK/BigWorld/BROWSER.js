BigWorld.FolderModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},elementCount:{notEmpty:!0,integer:0}};return{name:"Folder",initData:{elementCount:0},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ItemModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},e={folderId:{id:!0},objectId:{notEmpty:!0,id:!0},objectPart:{notEmpty:!0,size:{max:255}},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:t},left:{data:!0,detail:t},up:{data:!0,detail:t},right:{data:!0,detail:t}}}}}}}};return{name:"Item",initData:{kinds:[{name:{en:"Kind 1"}}],states:{}},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),BigWorld.MapModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}};return{name:"Map",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.ObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={notEmpty:!0,integer:!0,min:0},e={zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}},a={folderId:{id:!0},name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},sectionLevels:{notEmpty:!0,data:!0,detail:{left:t,up:t,right:t,down:t}},sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},touchArea:{notEmpty:!0,data:!0,detail:{x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},width:{notEmpty:!0,integer:!0},height:{notEmpty:!0,integer:!0}}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},down:{data:!0,detail:e},left:{data:!0,detail:e},up:{data:!0,detail:e},right:{data:!0,detail:e}}}}}}}};return{name:"Object",initData:{sectionLevels:{left:0,up:0,right:0,down:0},sectionMap:[[{z:0}]],touchArea:{x:0,y:0,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight},kinds:[{name:{en:"Kind 1"}}],states:{idle:{name:{en:"Idle"},parts:[]}}},methodConfig:{create:{valid:VALID(a)},update:{valid:VALID(a)}}}}}),BigWorld.TileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={folderId:{id:!0},name:{notEmpty:!0,size:{max:255}},kinds:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}}}}},states:{notEmpty:!0,data:!0,property:{data:!0,detail:{sectionMap:{notEmpty:!0,array:!0,element:{array:!0,element:{data:!0,detail:{z:{notEmpty:!0,integer:!0},isBlock:{bool:!0},isTrigger:{bool:!0}}}}},parts:{notEmpty:!0,array:!0,element:{data:!0,detail:{name:{notEmpty:!0,data:!0,detail:{en:{size:{max:255}},ko:{size:{max:255}},ja:{size:{max:255}},"zh-TW":{size:{max:255}}}},zIndex:{notEmpty:!0,integer:!0},frameCount:{notEmpty:!0,integer:!0},fps:{integer:!0},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},frames:{notEmpty:!0,array:!0,element:{id:!0}}}}}}}}},e=[];return REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let t=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{t.push({z:0})}),e.push(t)}),{name:"Tile",initData:{kinds:[{name:{en:"Kind 1"}}],states:{center:{sectionMap:e,parts:[]}}},methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.TILE_STATES=["center","left","leftTop","top","rightTop","right","rightBottom","bottom","leftBottom","fillLeftBottom","fillLeftTop","fillRightTop","fillRightBottom"],BigWorld.MapObjectModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={mapId:{notEmpty:!0,id:!0},objectId:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0},state:{notEmpty:!0,size:{max:255}},items:{notEmpty:!0,array:!0,element:{data:!0,detail:{id:{notEmpty:!0,id:!0},kind:{notEmpty:!0,integer:!0}}}},direction:{notEmpty:!0,one:["down","right","up","left"]},x:{notEmpty:!0,integer:!0},y:{notEmpty:!0,integer:!0},isReverse:{bool:!0}};return{name:"MapObject",methodConfig:{create:{valid:VALID(t)},update:{valid:VALID(t)}}}}}),BigWorld.MapTileModel=OBJECT({preset:()=>{return BigWorld.MODEL},params:()=>{let t={};EACH(BigWorld.TILE_STATES,e=>{t[e]={notEmpty:!0,integer:!0}});let e={mapId:{notEmpty:!0,id:!0},tileId:{notEmpty:!0,id:!0},kindMap:{notEmpty:!0,data:!0,details:t},col:{notEmpty:!0,integer:!0},row:{notEmpty:!0,integer:!0}};return{name:"MapTile",methodConfig:{create:{valid:VALID(e),role:"System"},update:{valid:VALID(e)}}}}});BigWorld.MAIN=METHOD({run:e=>{BigWorld.MATCH_VIEW({uri:["","folder/{folderId}"],target:BigWorld.Explorer}),BigWorld.MATCH_VIEW({uri:"map/{mapId}",target:BigWorld.MapEditor}),BigWorld.MATCH_VIEW({uri:"tile/{tileId}",target:BigWorld.TileEditor}),BigWorld.MATCH_VIEW({uri:"object/{objectId}",target:BigWorld.ObjectEditor}),BigWorld.MATCH_VIEW({uri:"item/{itemId}",target:BigWorld.ItemEditor})}}),BigWorld.SectionCollider=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,o)=>{let i=o.sectionMap,n=o.sectionLevels,r=o.direction;CONFIG.BigWorld.tileSectionLevel/2,t.refresh=RAR(()=>{t.empty(),EACH(i,(e,o)=>{EACH(e,(e,i)=>{if(e.isBlock===!0){let e,d;"down"===r&&(e=(i-n.left)*CONFIG.BigWorld.sectionWidth,d=(o-n.up)*CONFIG.BigWorld.sectionHeight),"left"===r&&(e=-(o-n.up)*CONFIG.BigWorld.sectionHeight,d=(i-n.left)*CONFIG.BigWorld.sectionWidth),"up"===r&&(e=-(i-n.left)*CONFIG.BigWorld.sectionWidth,d=-(o-n.up)*CONFIG.BigWorld.sectionHeight),"right"===r&&(e=(o-n.up)*CONFIG.BigWorld.sectionHeight,d=-(i-n.left)*CONFIG.BigWorld.sectionWidth),t.append(SkyEngine.Rect({x:e,y:d,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}))}})})})}}),BigWorld.SectionMapPreview=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,o)=>{let i=o.sectionMap,n=o.sectionLevels,r=o.touchAreaInfo,d=o.borderScale,l=o.direction,c=o.isEditMode,a=o.selectSection;CONFIG.BigWorld.tileSectionLevel/2,t.refresh=RAR(()=>{t.empty(),EACH(i,(e,o)=>{EACH(e,(e,i)=>{let r,d;"down"===l&&(r=(i-n.left)*CONFIG.BigWorld.sectionWidth,d=(o-n.up)*CONFIG.BigWorld.sectionHeight),"left"===l&&(r=-(o-n.up)*CONFIG.BigWorld.sectionHeight,d=(i-n.left)*CONFIG.BigWorld.sectionWidth),"up"===l&&(r=-(i-n.left)*CONFIG.BigWorld.sectionWidth,d=-(o-n.up)*CONFIG.BigWorld.sectionHeight),"right"===l&&(r=(o-n.up)*CONFIG.BigWorld.sectionHeight,d=-(i-n.left)*CONFIG.BigWorld.sectionWidth),t.append(SkyEngine.Rect({x:r,y:d,width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight,color:e.isTrigger===!0?"rgb(0, 174, 221)":e.isBlock===!0?"rgb(255, 0, 0)":"rgb(0, 255, 0)",alpha:.2,touchArea:c===!0?SkyEngine.Rect({width:CONFIG.BigWorld.sectionWidth,height:CONFIG.BigWorld.sectionHeight}):void 0,on:c===!0?{touchstart:e=>{e.stop()},tap:()=>{a(i,o)}}:void 0}))})}),void 0!==r&&t.append(SkyEngine.Rect({x:r.x,y:r.y,width:r.width,height:r.height,border:d+"px solid #00FF00"}))})}}),BigWorld.Item=CLASS({init:(e,t,o)=>{let i=o.itemData,n=o.kind;t.draw=(e=>{let t=e.object,o=e.state,r=e.direction,d=[];if(void 0!==o&&void 0!==r){let e=i.states[o];void 0!==e&&EACH(e.parts,(e,o)=>{let i=e[r];if(void 0!==i){let e=i.frames[n];void 0!==e&&d.push(SkyEngine.Sprite({src:BigWorld.RF(e),fps:i.fps,frameCount:i.frameCount,zIndex:i.zIndex,x:i.x,y:i.y}).appendTo(t))}})}return d}),t.setData=(e=>{i=e})}}),BigWorld.Map=CLASS(()=>{const e=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,t=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,o=e/2,i=t/2,n=50/e,r=512/e;return{preset:()=>{return SkyEngine.Node},init:(d,l,c)=>{let a=c.mapData,s=c.isMovable,p=c.isZoomable,u=c.minScale,g=c.maxScale,f=c.isToShowGrid,m=c.changeScale,T=c.movePosition,k=c.pickPosition,I=c.contextmenu;void 0===u&&(u=n),void 0===g&&(g=r);let h,B,y,v,W={},S={},E={},M={},D={},C={},b={},N={},R={},x={},A={},G={},O={},L=[],w={},F={},H={},V={},P=[],j={},U={},_={},z={},X=[],Y=[];f===!0&&(B=SkyEngine.Node({zIndex:-999999}).appendTo(l));let $,K=SkyEngine.Node({zIndex:-999998}).appendTo(l),Z=(l.getTileWrapper=(()=>{return K}),l.getTileId=((e,t)=>{let o=S[e+","+t];if(void 0!==o)return C[o].tileId})),q=(e,t)=>{let o=S[e+","+t];if(void 0!==o)return M[o]},J=(e,t,o)=>{let i;i=q(t-1,o),void 0!==i&&i.setRightTileId(e),i=q(t-1,o-1),void 0!==i&&i.setRightBottomTileId(e),i=q(t,o-1),void 0!==i&&i.setBottomTileId(e),i=q(t+1,o-1),void 0!==i&&i.setLeftBottomTileId(e),i=q(t+1,o),void 0!==i&&i.setLeftTileId(e),i=q(t+1,o+1),void 0!==i&&i.setLeftTopTileId(e),i=q(t,o+1),void 0!==i&&i.setTopTileId(e),i=q(t-1,o+1),void 0!==i&&i.setRightTopTileId(e)},Q=(e,t)=>{let o=e.col,i=e.row,n=BigWorld.Tile({col:o,row:i,tileData:t,kindMap:e.kindMap,leftTileId:Z(o-1,i),leftTopTileId:Z(o-1,i-1),topTileId:Z(o,i-1),rightTopTileId:Z(o+1,i-1),rightTileId:Z(o+1,i),rightBottomTileId:Z(o+1,i+1),bottomTileId:Z(o,i+1),leftBottomTileId:Z(o-1,i+1)}).appendTo(K);n.draw(),M[e.id]=n,J(t.id,o,i)},ee=(e,t,o)=>{void 0!==M[e]&&(M[e].remove(),delete M[e]),J(void 0,t,o)},te=(e,t)=>{let o=BigWorld.Object({objectData:t,kind:e.kind,state:e.state,direction:e.direction,x:e.x,y:e.y,isReverse:e.isReverse}).appendTo(l);D[e.id]=o},oe=e=>{void 0!==D[e]&&(D[e].remove(),delete D[e])},ie=(e,t,o)=>{let i=D[e];void 0!==i&&i.attachItem({id:t.id,item:BigWorld.Item({itemData:t,kind:o})})},ne=(e,t)=>{let o=D[e];void 0!==o&&o.removeItem(itemData.id)},re=(e,t,o)=>{if(void 0===G[e]){G[e]=0,o===!0?L.push(e):BigWorld.TileModel.get(e,t=>{void 0!==G[e]&&(x[e]=t,EACH(O[e],e=>{e(t)}),delete O[e])});let t=BigWorld.ROOM("Tile/"+e);t.on("update",t=>{x[e]=t,EACH(M,o=>{o.getId()===e&&o.setData(t)})}),t.on("remove",()=>{de(e)}),A[e]=t}void 0!==x[e]?t(x[e]):(void 0===O[e]&&(O[e]=[]),O[e].push(t)),G[e]+=1},de=e=>{G[e]-=1,0===G[e]&&(A[e].exit(),delete x[e],delete A[e],delete G[e])},le=(e,t,o)=>{if(void 0===H[e]){H[e]=0,o===!0?P.push(e):BigWorld.ObjectModel.get(e,t=>{void 0!==H[e]&&(w[e]=t,EACH(V[e],e=>{e(t)}),delete V[e])});let t=BigWorld.ROOM("Object/"+e);t.on("update",t=>{w[e]=t,EACH(D,o=>{o.getId()===e&&o.setData(t)})}),t.on("remove",()=>{ce(e)}),F[e]=t}void 0!==w[e]?t(w[e]):(void 0===V[e]&&(V[e]=[]),V[e].push(t)),H[e]+=1},ce=e=>{H[e]-=1,0===H[e]&&(F[e].exit(),delete w[e],delete F[e],delete H[e])},ae=(e,t,o)=>{if(void 0===_[e]){_[e]=0,o===!0?X.push(e):BigWorld.ItemModel.get(e,t=>{void 0!==_[e]&&(j[e]=t,EACH(z[e],e=>{e(t)}),delete z[e])});let t=BigWorld.ROOM("Item/"+e);t.on("update",t=>{j[e]=t,EACH(D,e=>{if(e.getId()===t.objectId){let o=e.getItem(t.id);void 0!==o&&(o.setData(t),e.refresh())}})}),t.on("remove",()=>{se(e)}),U[e]=t}void 0!==j[e]?t(j[e]):(void 0===z[e]&&(z[e]=[]),z[e].push(t)),_[e]+=1},se=e=>{_[e]-=1,0===_[e]&&(U[e].exit(),delete j[e],delete U[e],delete _[e])},pe=e=>{let t=C[e],o=t.col+","+t.row;delete S[o],de(t.tileId),delete C[e],b[e].exit(),delete b[e],ee(e,t.col,t.row)},ue=o=>{let i=N[o],n=Math.round(i.x/e)+","+Math.round(i.y/t);REMOVE({array:E[n],value:o}),ce(i.objectId),i.items.forEach(e=>{se(e.id)}),delete N[o],R[o].exit(),delete R[o],oe(o)},ge=e=>{let t=e.col+","+e.row;if(void 0!==W[t]){S[t]=e.id,re(e.tileId,t=>{Q(e,t)},!0),L.length>0&&BigWorld.TileModel.find({filter:{id:{$in:L}}},EACH(e=>{void 0!==G[e.id]&&(x[e.id]=e,EACH(O[e.id],t=>{t(e)}),delete O[e.id])})),L=[];let o=BigWorld.ROOM("MapTile/"+e.id);o.on("update",t=>{t.tileId!==e.tileId&&(de(e.tileId),re(t.tileId,o=>{ee(e.id,e.col,e.row),Q(t,o)})),C[e.id]=t,e=t}),o.on("remove",()=>{pe(e.id)}),C[e.id]=e,b[e.id]=o}},fe=o=>{let i=Math.round(o.x/e)+","+Math.round(o.y/t);if(void 0!==W[i]){E[i].push(o.id),le(o.objectId,e=>{te(o,e)},!0),P.length>0&&BigWorld.ObjectModel.find({filter:{id:{$in:P}}},EACH(e=>{void 0!==H[e.id]&&(w[e.id]=e,EACH(V[e.id],t=>{t(e)}),delete V[e.id])})),P=[],o.items.forEach(e=>{ae(e.id,t=>{ie(o.id,t,e.kind)},!0)}),X.length>0&&BigWorld.ItemModel.find({filter:{id:{$in:X}}},EACH(e=>{void 0!==_[e.id]&&(j[e.id]=e,EACH(z[e.id],t=>{t(e)}),delete z[e.id])})),X=[];let e=BigWorld.ROOM("MapObject/"+o.id);e.on("update",e=>{e.objectId!==o.objectId&&(ce(o.objectId),le(e.objectId,t=>{oe(o.id),te(e,t)})),o.items.forEach(t=>{let i=!0;e.items.forEach(e=>{if(t.id===e.id)return i=!1,!1}),i===!0&&(se(t.id),ne(o.id,t.id))}),e.items.forEach(t=>{let i=!0;o.items.forEach(e=>{if(t.id===e.id)return i=!1,!1}),i===!0&&ae(t.id,o=>{ie(e.id,o,t.kind)})}),N[o.id]=e,o=e}),e.on("remove",()=>{ue(o.id)}),N[o.id]=o,R[o.id]=e}},me=e=>{W[e].exit();let t=S[e];void 0!==t&&pe(t),E[e].forEach(ue),delete W[e],delete S[e],delete E[e]},Te=RAR(()=>{let n=WIN_WIDTH()/2/l.getScaleX(),r=WIN_HEIGHT()/2/l.getScaleY(),d=-l.getX()/l.getScaleX()-n,c=-l.getY()/l.getScaleY()-r,s=BigWorld.Tile.getTileCol(d,c)-1,p=BigWorld.Tile.getTileRow(d,c)-1,u=-l.getX()/l.getScaleX()+n,g=-l.getY()/l.getScaleY()+r,m=BigWorld.Tile.getTileCol(u,g)+1,T=BigWorld.Tile.getTileRow(u,g)+1,k={};for(let I=s;I<=m;I+=1)for(let h=p;h<=T;h+=1)k[I+","+h]={col:I,row:h};EACH(W,(e,t)=>{void 0!==k[t]?delete k[t]:me(t)});let S=[],M=[];EACH(k,(e,t)=>{let n=BigWorld.ROOM("Zone/"+t);n.on("putTile",ge),n.on("putObject",fe),W[t]=n,E[t]=[];let r=e.col,d=e.row;S.push({mapId:a.id,col:r,row:d});let l=BigWorld.Tile.getTileX(r,d),c=BigWorld.Tile.getTileY(r,d);M.push({mapId:a.id,x:{$gt:l-o,$lte:l+o},y:{$gt:c-i,$lte:c+i}})}),S.length>0&&BigWorld.MapTileModel.find({filter:{$or:S}},EACH(ge)),M.length>0&&BigWorld.MapObjectModel.find({filter:{$or:M}},EACH(fe)),f===!0&&(void 0!==y&&y.remove(),y=DELAY(.3,()=>{y=void 0,B.empty(),Y=[];for(let o=s;o<=m;o+=1)for(let i=p;i<=T;i+=1){let n;Y.push(n=SkyEngine.Rect({x:o*e,y:i*t,width:e,height:t,border:1/l.getScaleX()+"px solid #000666",color:"#000333"}).appendTo(B)),v===!0&&n.addDom(DIV({c:"Col: "+o+", Row: "+i}))}[SkyEngine.Rect({width:3/l.getScaleX(),height:3/l.getScaleX(),color:"#000FFF"}),SkyEngine.Line({startX:-200,endX:200,border:1/l.getScaleX()+"px solid #000FFF"}),SkyEngine.Line({startY:-200,endY:200,border:1/l.getScaleX()+"px solid #000FFF"})].forEach(B.append)}))});l.findMapTileId=(e=>{let t=e.col,o=e.row;return S[t+","+o]}),l.findMapObjectId=(o=>{let i,n=o.x,r=o.y,d=Math.round(n/e),l=Math.round(r/t),c=-999999;for(let a=d-2;a<=d+2;a+=1)for(let s=l-2;s<=l+2;s+=1){let e=E[a+","+s];void 0!==e&&e.forEach(e=>{let t=D[e],o=w[N[e].objectId].touchArea;n>=t.getX()+o.x-o.width/2&&n<=t.getX()+o.x+o.width/2&&r>=t.getY()+o.y-o.height/2&&r<=t.getY()+o.y+o.height/2&&c<t.getZIndex()&&(c=t.getZIndex(),i=e)})}return i});OVERRIDE(l.setScale,e=>{$=l.setScale=(t=>{t<u&&(t=u),t>g&&(t=g),e(t),void 0!==m&&m(t)})});let ke;OVERRIDE(l.setPosition,e=>{ke=l.setPosition=(t=>{e(t),Te(),void 0!==T&&T(l.getX(),l.getY())})});let Ie,he,Be=(l.setCursorNode=(e=>{let t=e.node,o=e.moveType;void 0!==Ie&&Ie.remove(),Ie=t,he=o,t.appendTo(l)}),l.setCursorNodeMoveType=(e=>{he=e}),l.removeCursorNode=(()=>{void 0!==Ie&&(Ie.remove(),Ie=void 0)}),l.showGridNumber=(()=>{v=!0,EACH(Y,o=>{o.addDom(DIV({c:"Col: "+o.getX()/e+", Row: "+o.getY()/t}))})}),l.hideGridNumber=(()=>{v=!1,EACH(Y,e=>{e.removeAllDoms()})}),l.turnOnPlaceMode=(()=>{h=!0}),l.turnOffPlaceMode=(()=>{h=!1}),l.getNearObject=(o=>{let i,n=Math.round(o.getX()/e),r=Math.round(o.getY()/t),d=999999;for(let l=n-2;l<=n+2;l+=1)for(let c=r-2;c<=r+2;c+=1){let e=E[l+","+c];EACH(e,e=>{let t=D[e];if(void 0!==t){let e=Math.sqrt(Math.pow(o.getX()-t.getX(),2)+Math.pow(o.getY()-t.getY(),2));e<d&&(d=e,i=t)}})}return i}),l.getCollidedObject=(o=>{let i,n=Math.round(o.getX()/e),r=Math.round(o.getY()/t);for(let d=n-2;d<=n+2;d+=1)for(let l=r-2;l<=r+2;l+=1){let e=E[d+","+l];EACH(e,e=>{let t=D[e];if(void 0!==t&&t.checkCollision(o)===!0)return i=t,!1})}return i}),EVENT("resize",Te)),ye=DIV({style:{position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:-1},on:{touchmove:o=>{if(void 0!==Ie){let i=(o.getLeft()-WIN_WIDTH()/2-l.getX())/l.getScaleX(),n=(o.getTop()-WIN_HEIGHT()/2-l.getY())/l.getScaleY();"tile"===he?(i=Math.round(i/e)*e,n=Math.round(n/t)*t):"section"===he&&(i=Math.round(i/CONFIG.BigWorld.sectionWidth)*CONFIG.BigWorld.sectionWidth,n=Math.round(n/CONFIG.BigWorld.sectionHeight)*CONFIG.BigWorld.sectionHeight),Ie.setPosition({x:INTEGER(i),y:INTEGER(n)})}},touchstart:o=>{if(0===o.getButtonIndex()&&void 0!==k){if(h===!0){let i=o=>{let i=(o.getLeft()-WIN_WIDTH()/2-l.getX())/l.getScaleX(),n=(o.getTop()-WIN_HEIGHT()/2-l.getY())/l.getScaleY(),r=Math.round(i/CONFIG.BigWorld.sectionWidth),d=Math.round(n/CONFIG.BigWorld.sectionHeight),c=Math.round(i/e),a=Math.round(n/t);k(INTEGER(i),INTEGER(n),r,d,c,a)};i(o);let n=EVENT("touchmove",i);EVENT_ONCE("touchend",e=>{n.remove()})}else{let i=o.getLeft(),n=o.getTop();EVENT_ONCE("touchend",o=>{if(Math.sqrt(Math.pow(o.getLeft()-i,2)+Math.pow(o.getTop()-n,2))<5){let i=(o.getLeft()-WIN_WIDTH()/2-l.getX())/l.getScaleX(),n=(o.getTop()-WIN_HEIGHT()/2-l.getY())/l.getScaleY(),r=Math.round(i/CONFIG.BigWorld.sectionWidth),d=Math.round(n/CONFIG.BigWorld.sectionHeight),c=Math.round(i/e),a=Math.round(n/t);k(INTEGER(i),INTEGER(n),r,d,c,a)}})}o.stop()}},contextmenu:o=>{if(void 0!==I){let i=(o.getLeft()-WIN_WIDTH()/2-l.getX())/l.getScaleX(),n=(o.getTop()-WIN_HEIGHT()/2-l.getY())/l.getScaleY(),r=Math.round(i/CONFIG.BigWorld.sectionWidth),d=Math.round(n/CONFIG.BigWorld.sectionHeight),c=Math.round(i/e),a=Math.round(n/t);I(o,INTEGER(i),INTEGER(n),r,d,c,a)}}}}).appendTo(BODY);l.getController=(()=>{return ye});p===!0&&ye.on("wheel",e=>{let t=l.getX()/l.getScaleX(),o=l.getY()/l.getScaleY();$(l.getScaleX()+e.getWheelDelta()/1e3),ke({x:t*l.getScaleX(),y:o*l.getScaleY()})});s===!0&&EVENT_LOW({name:"mousedown",node:ye},e=>{if(h!==!0){let t=e.getLeft(),o=e.getTop(),i=l.getX(),n=l.getY(),r=EVENT_LOW("mousemove",e=>{ke({x:i+e.getLeft()-t,y:n+e.getTop()-o})}),d=EVENT_LOW("mouseup",()=>{r.remove(),d.remove()})}});let ve,We,Se;EVENT_LOW({name:"touchstart",node:ye},e=>{ve=void 0,We=void 0,Se=void 0}),EVENT_LOW({name:"touchmove",node:ye},e=>{if(p===!0&&e.getPositions().length>=2){let t=e.getPositions()[0],o=e.getPositions()[1],i=Math.sqrt(Math.pow(o.left-t.left,2)+Math.pow(o.top-t.top,2));if(void 0!==ve){let e=l.getX()/l.getScaleX(),t=l.getY()/l.getScaleY();$(l.getScaleX()+(i-ve)/100),ke({x:e*l.getScaleX(),y:t*l.getScaleY()})}ve=i}else if(s===!0&&h!==!0&&void 0===ve){let t=e.getLeft(),o=e.getTop();void 0!==We&&void 0!==Se&&Math.abs(t-We)<50&&Math.abs(o-Se)<50&&ke({x:l.getX()+t-We,y:l.getY()+o-Se}),We=t,Se=o}}),l.on("remove",()=>{ye.remove(),Be.remove()})}}}),BigWorld.Object=CLASS({preset:()=>{return SkyEngine.Node},params:()=>{return{isY2ZIndex:!0}},init:(e,t,o)=>{let i,n=o.objectData,r=o.kind,d=o.state,l=o.direction,c=o.isReverse,a=[],s={},p=t.refresh=RAR(()=>{EACH(a,e=>{e.remove()}),a=[];let e=n.states[d];void 0!==e&&EACH(e.parts,(e,o)=>{let i=e[l];if(void 0!==i){let e=i.frames[r];void 0!==e&&a.push(SkyEngine.Sprite({src:BigWorld.RF(e),fps:i.fps,frameCount:i.frameCount,zIndex:i.zIndex,x:i.x,y:i.y}).appendTo(t))}}),EACH(s,e=>{EXTEND({origin:a,extend:e.draw({object:t,state:d,direction:l})})})});t.addCollider(i=BigWorld.SectionCollider({sectionLevels:n.sectionLevels,sectionMap:n.sectionMap,direction:l})),c===!0&&t.flipX();t.getId=(()=>{return n.id}),t.setData=(e=>{n=e,p(),i.refresh()}),t.reverse=(()=>{c=c!==!0,t.flipX()}),t.attachItem=(e=>{let t=e.id,o=e.item;s[t]=o,p()}),t.getItem=(e=>{return s[e]}),t.removeItem=(e=>{delete s[e],p()})}}),BigWorld.Tile=CLASS(e=>{let t=CONFIG.BigWorld.sectionWidth*CONFIG.BigWorld.tileSectionLevel,o=CONFIG.BigWorld.sectionHeight*CONFIG.BigWorld.tileSectionLevel,i=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{let e=[];REPEAT(CONFIG.BigWorld.tileSectionLevel,()=>{e.push({z:0})}),i.push(e)});e.getInitSectionMap=(()=>{return i}),e.getTileWidth=((e,o)=>{return t}),e.getTileHeight=((e,t)=>{return o}),e.getTileCol=((e,o)=>{return Math.round(e/t)}),e.getTileRow=((e,o)=>{return Math.round(o/t)}),e.getTileX=((e,o)=>{return e*t}),e.getTileY=((e,t)=>{return t*o});return{preset:()=>{return SkyEngine.Node},init:(e,i,n)=>{let r=n.alpha,d=n.col,l=n.row,c=n.tileData,a=n.kindMap,s=n.leftTileId,p=n.leftTopTileId,u=n.topTileId,g=n.rightTopTileId,f=n.rightTileId,m=n.rightBottomTileId,T=n.bottomTileId,k=n.leftBottomTileId;i.setX(d*t),i.setY(l*o);let I=(e,t,o)=>{let n=[],d=c.states[e];return void 0!==d&&EACH(d.parts,(d,l)=>{let c=d.frames[a[e][l]];void 0!==c&&n.push(SkyEngine.Sprite({alpha:r,src:BigWorld.RF(c),fps:d.fps,frameCount:d.frameCount,zIndex:d.zIndex,x:i.getX()+d.x+t,y:i.getY()+d.y+o}).appendTo(i.getParent()))}),n},h=[],B=[],y=[],v=[],W=[],S=[],E=[],M=[],D=[],C=e=>{e.forEach(e=>{e.remove()})},b=()=>{C(B),B=s!==c.id?p===c.id&&k===c.id?I("center",-t,0):p===c.id?I("fillRightTop",-t,0):k===c.id?I("fillRightBottom",-t,0):I("left",-t,0):[]},N=()=>{C(y),y=s!==c.id&&p!==c.id&&u!==c.id?I("leftTop",-t,-o):[]},R=()=>{C(v),v=u!==c.id?p===c.id&&g===c.id?I("center",0,-o):p===c.id?I("fillLeftBottom",0,-o):g===c.id?[]:I("top",0,-o):[]},x=()=>{C(W),W=u!==c.id&&g!==c.id&&f!==c.id?I("rightTop",t,-o):[]},A=()=>{C(S),S=f!==c.id?g===c.id&&m===c.id?I("center",t,0):g===c.id?I("fillLeftTop",t,0):m===c.id?[]:I("right",t,0):[]},G=()=>{C(E),E=f!==c.id&&m!==c.id&&T!==c.id?I("rightBottom",t,o):[]},O=()=>{C(M),M=T!==c.id?k===c.id&&m===c.id?I("center",0,o):k===c.id?[]:m===c.id?[]:I("bottom",0,o):[]},L=()=>{C(D),D=T!==c.id&&k!==c.id&&s!==c.id?I("leftBottom",-t,o):[]},w=i.draw=(()=>{C(h),h=I("center",0,0),b(),N(),R(),x(),A(),G(),O(),L()});i.on("remove",()=>{C(h),C(B),C(y),C(v),C(W),C(S),C(E),C(M),C(D)});i.setLeftTileId=(e=>{s=e,b(),N(),L()}),i.setLeftTopTileId=(e=>{p=e,b(),N(),R()}),i.setTopTileId=(e=>{u=e,N(),R(),x()}),i.setRightTopTileId=(e=>{g=e,R(),x(),A()}),i.setRightTileId=(e=>{f=e,x(),A(),G()}),i.setRightBottomTileId=(e=>{m=e,A(),G(),O()}),i.setBottomTileId=(e=>{T=e,G(),O(),L()}),i.setLeftBottomTileId=(e=>{k=e,O(),L(),b()}),i.getId=(()=>{return c.id}),i.setData=(e=>{c=e,w()})}}}),OVERRIDE(BigWorld.MapTileModel,e=>{BigWorld.MapTileModel=OBJECT({preset:()=>{return e},init:(e,t)=>{t.put=((e,o)=>{t.getRoom().send({methodName:"put",data:e},o)})}})}),BigWorld.ExplorerElement=CLASS({preset:()=>{return DIV},params:()=>{return{style:{flt:"left",padding:10}}},init:(e,t,o)=>{let i,n=o.type,r=o.name;t.append(i=UUI.BUTTON({icon:IMG({src:BigWorld.R("explorer/element/"+n+".png"),on:{touchstart:e=>{e.stopDefault()}}}),title:r})),t.on("mouseover",()=>{t.addStyle({backgroundColor:void 0!==BROWSER_CONFIG.SkyDesktop&&"dark"===BROWSER_CONFIG.SkyDesktop.theme?"#003333":"#AFCEFF"})}),t.on("mouseout",()=>{t.addStyle({backgroundColor:"transparent"})});t.changeName=(e=>{r=e,i.setTitle(r)})}}),BigWorld.PartEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n,r,d,l,c,a,s=o.partInfo,p=o.kind,u=o.direction,g=o.save,f=o.removePart,m={zIndex:0,frameCount:1,x:0,y:0,frames:[]};t.append(TABLE({c:TR({c:[TD({style:{width:250},c:r=FORM({style:{position:"relative",backgroundColor:"#ccc",padding:10,width:230},c:[d=UUI.FULL_INPUT({style:{flt:"left",width:100},name:"name.ko",placeholder:"이름 (한국어)",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{flt:"right",width:100},name:"zIndex",placeholder:"z-index",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:100},name:"frameCount",placeholder:"프레임 수",on:{change:()=>{n===!0&&r.submit()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:100},name:"fps",placeholder:"FPS",on:{change:()=>{n===!0&&r.submit()}}}),DIV({style:{marginTop:10,flt:"left",width:110},c:[l=UUI.FULL_INPUT({style:{flt:"left",width:48},name:"x",placeholder:"X",on:{change:()=>{n===!0&&r.submit()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/left.png")}),on:{tap:()=>{k(),g()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/right.png")}),on:{tap:()=>{I(),g()}}})]}),DIV({style:{marginTop:10,flt:"right",width:110},c:[c=UUI.FULL_INPUT({style:{flt:"left",width:48},name:"y",placeholder:"Y",on:{change:()=>{n===!0&&r.submit()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/up.png")}),on:{tap:()=>{h(),g()}}}),UUI.ICON_BUTTON({style:{flt:"left",padding:5,lineHeight:0},icon:IMG({src:BigWorld.R("parteditor/down.png")}),on:{tap:()=>{B(),g()}}})]}),CLEAR_BOTH(),UUI.FULL_UPLOAD_FORM({style:{marginTop:10},box:BigWorld},{overSizeFile:()=>{SkyDesktop.Alert({msg:"업로드 용량을 초과했습니다. "+CONFIG.maxUploadFileMB+"MB 이하의 파일을 올려주세요."})},success:e=>{"image/png"===e.type?(T(e.id),r.submit()):SkyDesktop.Alert({msg:"PNG 파일만 등록할 수 있습니다."})}}),UUI.ICON_BUTTON({style:{position:"absolute",right:-10,top:-10},icon:IMG({src:BigWorld.R("parteditor/x.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 ["+MSG(s.name)+"] 파트를 제거하시겠습니까?"},()=>{f(),t.remove()})}}})],on:{submit:()=>{let e=r.getData();s.name=e.name,void 0===u?(s.zIndex=INTEGER(e.zIndex),s.frameCount=INTEGER(e.frameCount),s.fps=""===e.fps?TO_DELETE:INTEGER(e.fps),s.x=INTEGER(e.x),s.y=INTEGER(e.y),void 0!==i&&(s.frames[p]=i)):(void 0===s[u]&&(s[u]={frames:[]}),s[u].zIndex=INTEGER(e.zIndex),s[u].frameCount=INTEGER(e.frameCount),s[u].fps=""===e.fps?TO_DELETE:INTEGER(e.fps),s[u].x=INTEGER(e.x),s[u].y=INTEGER(e.y),void 0!==i&&(s[u].frames[p]=i)),g()}}})}),a=TD({style:{paddingLeft:15}})]})})),r.setData(void 0===u?s:void 0===s[u]?m:s[u]),void 0!==u&&d.setValue(s.name.ko);let T=e=>{i=e,a.empty(),a.append(IMG({style:{border:"1px solid #ccc",maxHeight:160},src:BigWorld.RF(i)}))};void 0===u?void 0!==s.frames[p]&&T(s.frames[p]):void 0!==s[u]&&void 0!==s[u].frames[p]&&T(s[u].frames[p]),n=!0;let k=t.moveLeft1Pixel=(()=>{n=!1,void 0===u?(s.x-=1,l.setValue(s.x)):(void 0===s[u]&&(s[u]=m),s[u].x-=1,l.setValue(s[u].x)),n=!0}),I=t.moveRight1Pixel=(()=>{n=!1,void 0===u?(s.x+=1,l.setValue(s.x)):(void 0===s[u]&&(s[u]=m),s[u].x+=1,l.setValue(s[u].x)),n=!0}),h=t.moveUp1Pixel=(()=>{n=!1,void 0===u?(s.y-=1,c.setValue(s.y)):(void 0===s[u]&&(s[u]=m),s[u].y-=1,c.setValue(s[u].y)),n=!0}),B=t.moveDown1Pixel=(()=>{n=!1,void 0===u?(s.y+=1,c.setValue(s.y)):(void 0===s[u]&&(s[u]=m),s[u].y+=1,c.setValue(s[u].y)),n=!0})}}),BigWorld.PartsEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n,r=o.stateInfos,d=o.state,l=o.kind,c=o.direction,a=o.save;t.append(DIV({c:[SkyDesktop.Button({style:{flt:"left"},icon:IMG({src:BigWorld.R("parteditor/part.png")}),title:"파트 추가",on:{tap:()=>{let e=r[d];void 0===e&&(e=r[d]={parts:[]});let t;t=void 0===c?{name:{ko:"파트 "+e.parts.length},zIndex:0,frameCount:1,x:0,y:0,frames:[]}:{name:{ko:"파트 "+e.parts.length}},e.parts.push(t),s(t),a()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/left.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveLeft1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/right.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveRight1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/up.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveUp1Pixel()}),a())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("parteditor/down.png")}),spacing:0,on:{tap:()=>{let e=r[d];void 0!==e&&(EACH(n.getChildren(),e=>{e.moveDown1Pixel()}),a())}}}),CLEAR_BOTH(),P({style:{marginTop:5},c:"방향 버튼을 누르면 모든 파트들의 위치를 1픽셀 이동시킵니다."}),n=DIV()]}));let s=t.addPartEditor=(e=>{n.append(BigWorld.PartEditor({style:{marginTop:10},partInfo:e,kind:l,direction:i,save:a,removePart:()=>{REMOVE({array:r[d].parts,value:e}),void 0===r[d].name&&0===r[d].parts.length&&delete r[d],a()}}))});t.changeDirection=(e=>{i=e,n.empty();let t=r[d];void 0!==t&&EACH(t.parts,s)})}}),BigWorld.SectionEditor=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i,n=o.mode,r=o.sectionMap,d=o.sectionLevels,l=o.touchAreaInfo,c=o.save,a=o.changeDirection,s=o.refresh,p=BigWorld.STORE("sectionEditorStore"),u="down",g="tile"===n?0:107;t.append(i=SkyEngine.SubScreen({style:{flt:"left",backgroundColor:"#666",color:"#fff"},width:414,height:414,y:g}));let f,m=EVENT("keydown",e=>{"Control"===e.getKey()&&(f=!0)}),T=EVENT("keyup",e=>{"Control"===e.getKey()&&(f=!1)});t.on("remove",()=>{m.remove(),T.remove()}),void 0===p.get("isToShowSection")&&p.save({name:"isToShowSection",value:!0});let k,I=t.refresh=RAR(()=>{i.empty(),EACH([SkyEngine.Rect({width:3/i.getScaleX(),height:3/i.getScaleX(),color:"#00FFFF"}),SkyEngine.Line({startX:-207/i.getScaleX(),endX:207/i.getScaleX(),border:1/i.getScaleX()+"px solid #00FFFF"}),SkyEngine.Line({startY:(-207-g)/i.getScaleX(),endY:(207-g)/i.getScaleX(),border:1/i.getScaleX()+"px solid #00FFFF"})],i.append),s(i,u),"item"!==n&&(i.append(k=BigWorld.SectionMapPreview({zIndex:999999,sectionMap:r,sectionLevels:d,touchAreaInfo:l,borderScale:1/i.getScaleX(),direction:u,isEditMode:!0,selectSection:(e,t)=>{let o=r[t][e];f===!0?(o.isTrigger===!0?delete o.isTrigger:o.isTrigger=!0,delete o.isBlock):(o.isTrigger!==!0&&(o.isBlock===!0?delete o.isBlock:o.isBlock=!0),delete o.isTrigger),k.refresh(),c()}})),p.get("isToShowSection")!==!0&&k.hide())});"item"!==n&&(t.addStyle({position:"relative"}),t.append(UUI.FULL_CHECKBOX({style:{position:"absolute",left:10,top:7,fontSize:12},label:"섹션 보기",value:p.get("isToShowSection"),on:{change:(e,t)=>{t.getValue()===!0?k.show():k.hide(),p.save({name:"isToShowSection",value:t.getValue()})}}}))),"tile"!==n&&t.append(DIV({style:{marginLeft:10,flt:"left"},c:["object"===n?DIV({style:{backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"섹션 크기 늘리기"}),SkyDesktop.Button({style:{flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/left.png")}),spacing:0,on:{tap:()=>{d.left+=1,EACH(r,e=>{e.unshift({z:0})}),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/up.png")}),spacing:0,on:{tap:()=>{d.up+=1;let e=[];REPEAT(d.left+d.right+1,()=>{e.push({z:0})}),r.unshift(e),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/right.png")}),spacing:0,on:{tap:()=>{d.right+=1,EACH(r,e=>{e.push({z:0})}),c()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/extend/down.png")}),spacing:0,on:{tap:()=>{d.down+=1;let e=[];REPEAT(d.left+d.right+1,()=>{e.push({z:0})}),r.push(e),c()}}}),CLEAR_BOTH()]}):void 0,"object"===n?DIV({style:{marginTop:10,backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"섹션 크기 줄이기"}),SkyDesktop.Button({style:{flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/right.png")}),spacing:0,on:{tap:()=>{d.left>=1&&(d.left-=1,EACH(r,e=>{e.shift()}),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/down.png")}),spacing:0,on:{tap:()=>{d.up>=1&&(d.up-=1,r.shift(),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/left.png")}),spacing:0,on:{tap:()=>{d.right>=1&&(d.right-=1,EACH(r,e=>{e.pop()}),c())}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:7},icon:IMG({src:BigWorld.R("sectioneditor/arrow/rectangle/shrink/up.png")}),spacing:0,on:{tap:()=>{d.down>=1&&(d.down-=1,r.pop(),c())}}}),CLEAR_BOTH()]}):void 0,DIV({style:{marginTop:"object"===n?10:0,backgroundColor:"#ccc",color:"#000",padding:10},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"회전시키기"}),SkyDesktop.Button({style:{flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/down.png")}),spacing:0,on:{tap:()=>{u="down",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/left.png")}),spacing:0,on:{tap:()=>{u="left",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/up.png")}),spacing:0,on:{tap:()=>{u="up",a(u),I()}}}),SkyDesktop.Button({style:{marginLeft:10,flt:"left"},icon:IMG({src:BigWorld.R("sectioneditor/rotate/right.png")}),spacing:0,on:{tap:()=>{u="right",a(u),I()}}}),CLEAR_BOTH()]}),"object"===n?DIV({style:{marginTop:10,backgroundColor:"#ccc",color:"#000",padding:10,width:214},c:[H1({style:{marginBottom:10,textAlign:"center",fontWeight:"bold"},c:"터치 영역 지정"}),UUI.FULL_INPUT({style:{flt:"left",width:92},name:"x",placeholder:"x",value:l.x,on:{change:(e,t)=>{l.x=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{flt:"right",width:92},name:"y",placeholder:"y",value:l.y,on:{change:(e,t)=>{l.y=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"left",width:92},name:"width",placeholder:"width",value:l.width,on:{change:(e,t)=>{l.width=INTEGER(t.getValue()),c()}}}),UUI.FULL_INPUT({style:{marginTop:10,flt:"right",width:92},name:"height",placeholder:"height",value:l.height,on:{change:(e,t)=>{l.height=INTEGER(t.getValue()),c()}}}),CLEAR_BOTH()]}):void 0]})),t.append(CLEAR_BOTH());t.setScale=(e=>{i.setScale(e),I()}),t.getDirection=(()=>{return u})}}),BigWorld.TilePreview=CLASS({preset:()=>{return DIV},init:(e,t,o)=>{let i=o.y;void 0===i&&(i=0);let n,r=(o.changeDirection,o.refresh),d="down";t.append(n=SkyEngine.SubScreen({style:{backgroundColor:"#666",color:"#fff"},width:414,height:414,y:i})),t.addStyle({position:"relative"}),t.append(DIV({style:{position:"absolute",left:10,top:7,fontSize:12},c:"타일 미리보기"}));let l=t.refresh=RAR(()=>{n.empty(),r(n,d)});t.setScale=(e=>{n.setScale(e),l()}),t.getDirection=(()=>{return d})}}),BigWorld.ValidPrompt=METHOD({run:(e,t)=>{let o,i,n,r,d=e.title,l=e.inputName,c=e.placeholder,a=e.value,s=e.inputName2,p=e.placeholder2,u=e.value2,g=e.errorMsgs,f=e.okButtonTitle,m=e.isToSelectObject,T=SkyDesktop.Confirm({okButtonTitle:f,msg:[H2({style:{fontWeight:"bold"},c:d}),m===!0?SkyDesktop.Button({style:{margin:"auto",marginTop:10},icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:"대상 오브젝트 선택",on:{tap:(e,t)=>{BigWorld.SelectObjectPopup((e,i)=>{o=e,t.setTitle(i)})}}}):void 0,i=UUI.VALID_FORM({style:{marginTop:10},errorMsgs:g,errorMsgStyle:{color:"red"},c:[n=INPUT({style:{width:222,padding:8,border:"1px solid #999",borderRadius:4},name:l,placeholder:c,value:a}),void 0!==s?r=INPUT({style:{marginTop:10,width:222,padding:8,border:"1px solid #999",borderRadius:4},name:s,placeholder:p,value:u}):void 0]})]},()=>{return m===!0?void 0!==r?t(o,n.getValue(),r.getValue(),i.showErrors,T.remove):t(o,n.getValue(),i.showErrors,T.remove):void 0!==r?t(n.getValue(),r.getValue(),i.showErrors,T.remove):t(n.getValue(),i.showErrors,T.remove),!1});n.select()}}),BigWorld.SelectFolderPopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"폴더 선택"}},init:(e,t,o)=>{e.init(o)}}),BigWorld.SelectObjectPopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"오브젝트 선택"}},init:(e,t,o)=>{e.init(o,(t,o)=>{return BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(o,i,n)=>{let r;t.addItem({key:o.id,item:r=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:MSG(o.name),on:{tap:()=>{e.selectElement(r,o.id,MSG(o.name))}}})})}})})}}),BigWorld.SelectPopup=CLASS({init:(e,t,o)=>{let i,n,r,d,l,c,a=o.title,s=BigWorld.STORE("folderOpenedStore"),p=(e,t)=>{let o,i,n=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:t},sort:{createTime:1}},{handler:(t,o,i)=>{let n;e.addItem({key:t.id,item:n=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:s.get(t.id),title:t.name,on:{open:()=>{s.save({name:t.id,value:!0}),p(n,t.id)},close:()=>{s.remove(t.id)},tap:()=>{u(n,void 0===c?t.id:void 0,void 0===c?t.name:void 0)}}})})},success:()=>{void 0!==c&&(o=c(e,t))}});e.on("close",i=(()=>{void 0!==n&&(n(),n=void 0),void 0!==o&&(o(),o=void 0),e.removeAllItems(),e.off("close",i)})),e.on("remove",()=>{void 0!==n&&(n(),n=void 0),void 0!==o&&(o(),o=void 0)})};SkyDesktop.Confirm({style:{onDisplayResize:(e,t)=>{return e>600?{width:500}:{width:"90%"}}},msg:[H2({style:{fontWeight:"bold"},c:a}),SkyDesktop.FileTree({style:{marginTop:8,overflowY:"scroll",padding:8,borderRadius:4,textAlign:"left",backgroundColor:"#000",color:"#fff",onDisplayResize:(e,t)=>{return t>500?{height:300}:{height:150}}},items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/root.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")})),p(i,TO_DELETE)},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")}))},tap:()=>{u(i,void 0===c?TO_DELETE:void 0,void 0===c?"root":void 0)}}})}})],okButtonTitle:"선택 완료"},()=>{return void 0!==r&&void l(r,d);
});let u=e.selectElement=((e,t,o)=>{void 0!==n&&n.deselect(),e.select(),n=e,r=t,d=o});e.init=((e,t)=>{l=e,c=t,i.open()})}}),BigWorld.SelectTilePopup=CLASS({preset:()=>{return BigWorld.SelectPopup},params:()=>{return{title:"타일 선택"}},init:(e,t,o)=>{e.init(o,(t,o)=>{return BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(o,i,n)=>{let r;t.addItem({key:o.id,item:r=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/menu/tile.png")}),title:o.name,on:{tap:()=>{e.selectElement(r,o.id,o.name)}}})})}})})}}),BigWorld.Explorer=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 탐색기");let o,i,n,r,d,l,c=BigWorld.STORE("folderOpenedStore"),a=[],s=(e,t)=>{let i,r=BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:t},sort:{createTime:1}},{handler:(i,r,d,a)=>{let u;e.addItem({key:i.id,item:u=SkyDesktop.Folder({style:{cursor:"pointer"},isOpened:c.get(i.id),title:i.name,on:{open:()=>{c.save({name:i.id,value:!0}),s(u,i.id)},close:()=>{c.remove(i.id)},tap:()=>{void 0!==n&&n.deselect(),u.select(),n=u,BigWorld.GO("folder/"+i.id)},touchstart:e=>{l={type:"folder",id:i.id,name:i.name,startLeft:e.getLeft(),startTop:e.getTop()}},touchend:()=>{void 0!==l&&l.id!==i.id&&p(l.type,l.id,i.id)},contextmenu:e=>{g(e,i)}}})}),void 0===n&&i.id===o&&(u.select(),n=u),r(o=>{o.folderId!==(t===TO_DELETE?void 0:t)?(a(),e.removeItem(i.id)):u.setTitle(o.name)}),d(()=>{e.removeItem(i.id)})}});e.on("close",i=(()=>{r(),r=void 0,e.removeAllItems(),e.off("close",i)})),e.on("remove",()=>{void 0!==r&&(r(),r=void 0)})},p=(e,t,o)=>{let i=SkyDesktop.LoadingBar("lime");"folder"===e?BigWorld.FolderModel.update({id:t,folderId:o},()=>{i.done()}):"map"===e?BigWorld.MapModel.update({id:t,folderId:o},()=>{i.done()}):"tile"===e?BigWorld.TileModel.update({id:t,folderId:o},()=>{i.done()}):"object"===e?BigWorld.ObjectModel.update({id:t,folderId:o},()=>{i.done()}):"item"===e&&BigWorld.ItemModel.update({id:t,folderId:o},()=>{i.done()})},u=(e,t,o,i)=>{let n=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"폴더 이동",icon:IMG({src:BigWorld.R("explorer/contextmenu/folder.png")}),on:{tap:()=>{t(),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("explorer/contextmenu/edit.png")}),on:{tap:()=>{o(),n.remove()}}}),SkyDesktop.ContextMenuItem({title:"삭제",icon:IMG({src:BigWorld.R("explorer/contextmenu/remove.png")}),on:{tap:()=>{i(),n.remove()}}})]});e.stop()},g=(e,t)=>{u(e,()=>{BigWorld.SelectFolderPopup(e=>{p("folder",t.id,e)})},()=>{BigWorld.ValidPrompt({title:"폴더 이름 변경",inputName:"name",placeholder:"폴더 이름",value:t.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,o,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 폴더 이름을 입력해주세요."}):BigWorld.FolderModel.update({id:t.id,name:e},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 폴더를 삭제하시겠습니까? 폴더를 삭제하면 폴더 내 모든 요소들이 삭제됩니다."},()=>{let e=SkyDesktop.LoadingBar("lime");BigWorld.FolderModel.remove(t.id,()=>{e.done()})})})},f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:35},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/folder.png")}),title:"새 폴더",on:{tap:()=>{BigWorld.ValidPrompt({title:"폴더 생성",inputName:"name",placeholder:"폴더 이름",errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 폴더 이름을 입력해주세요."}):BigWorld.FolderModel.create({folderId:o,name:e},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/map.png")}),title:"새 맵",on:{tap:()=>{BigWorld.ValidPrompt({title:"맵 생성",inputName:"name.ko",placeholder:"맵 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 맵 이름을 입력해주세요."}):BigWorld.MapModel.create({folderId:o,name:{ko:e}},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/tile.png")}),title:"새 타일",on:{tap:()=>{BigWorld.ValidPrompt({title:"타일 생성",inputName:"name",placeholder:"타일 이름",errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 타일 이름을 입력해주세요."}):BigWorld.TileModel.create({folderId:o,name:e},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/object.png")}),title:"새 오브젝트",on:{tap:()=>{BigWorld.ValidPrompt({title:"오브젝트 생성",inputName:"name.ko",placeholder:"오브젝트 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"생성할 오브젝트 이름을 입력해주세요."}):BigWorld.ObjectModel.create({folderId:o,name:{ko:e}},{notValid:t,success:i})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("explorer/menu/item.png")}),title:"새 아이템",on:{tap:()=>{BigWorld.ValidPrompt({title:"아이템 생성",isToSelectObject:!0,inputName:"objectPart",placeholder:"오브젝트 파트",inputName2:"name.ko",placeholder2:"아이템 이름",errorMsgs:{objectPart:{size:e=>{return"최대 "+e.max+"글자입니다."}},"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"생성"},(e,t,i,n,r)=>{void 0===e?SkyDesktop.Alert({msg:"아이템의 대상이 되는 오브젝트를 선택해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===i.trim()?SkyDesktop.Alert({msg:"생성할 아이템 이름을 입력해주세요."}):BigWorld.ItemModel.create({folderId:o,objectId:e,objectPart:t,name:{ko:i}},{notValid:n,success:r})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:23,c:SkyDesktop.FileTree({items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("explorer/root.png")}),title:"root",on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")})),s(i,TO_DELETE)},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("explorer/root.png")}))},tap:()=>{void 0!==n&&n.deselect(),i.select(),n=i,BigWorld.GO("")}}})}})}),SkyDesktop.Tab({size:77,c:[r=DIV(),CLEAR_BOTH()]})]})})})]}).appendTo(BODY);i.open(),e.on("paramsChange",e=>{if(o=e.folderId,void 0===o)o=TO_DELETE,void 0!==n&&n.deselect(),i.select(),n=i;else{let e=t=>{let i=t.getItem(o);void 0!==i?(void 0!==n&&n.deselect(),i.select(),n=i):EACH(t.getItems(),e)};e(i)}EACH(a,e=>{e()}),a=[],r.empty(),NEXT([e=>{o===TO_DELETE?e():BigWorld.FolderModel.get(o,t=>{r.append(BigWorld.ExplorerElement({type:"parentfolder",name:"상위 폴더",on:{tap:()=>{BigWorld.GO(void 0==t.folderId?"":"folder/"+t.folderId)},touchend:()=>{void 0!==l&&p(l.type,l.id,void 0==t.folderId?TO_DELETE:t.folderId)}}})),e()})},e=>{return()=>{a.push(BigWorld.FolderModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"folder",name:e.name,on:{tap:()=>{BigWorld.GO("folder/"+e.id)},touchstart:t=>{l={type:"folder",id:e.id,name:e.name,startLeft:t.getLeft(),startTop:t.getTop()}},touchend:()=>{void 0!==l&&l.id!==e.id&&p(l.type,l.id,e.id)},contextmenu:t=>{g(t,e)}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(e.name)}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.MapModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"map",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("map/"+e.id)},touchstart:t=>{l={type:"map",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("map",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"맵 이름 변경",inputName:"name.ko",placeholder:"맵 이름",value:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 맵 이름을 입력해주세요."}):BigWorld.MapModel.update({id:e.id,name:{ko:t}},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 맵을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.MapModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.TileModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"tile",name:e.name,on:{tap:()=>{BigWorld.GO_NEW_WIN("tile/"+e.id)},touchstart:t=>{l={type:"tile",id:e.id,name:e.name,startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("tile",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"타일 정보 변경",inputName:"name",placeholder:"타일 이름",value:e.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 타일 이름을 입력해주세요."}):BigWorld.TileModel.update({id:e.id,name:t},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 타일을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(e.name)}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.ObjectModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"object",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("object/"+e.id)},touchstart:t=>{l={type:"object",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("object",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"오브젝트 이름 변경",inputName:"name.ko",placeholder:"오브젝트 이름",value:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i)=>{""===t.trim()?SkyDesktop.Alert({msg:"변경할 오브젝트 이름을 입력해주세요."}):BigWorld.ObjectModel.update({id:e.id,name:{ko:t}},{notValid:o,success:i})})},()=>{SkyDesktop.Confirm({msg:"정말 오브젝트를 삭제하시겠습니까? 오브젝트를 삭제하면 오브젝트와 연결된 모든 아이템들이 삭제됩니다."},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}},e=>{return()=>{a.push(BigWorld.ItemModel.onNewAndFindWatching({properties:{folderId:o},sort:{createTime:1}},{handler:(e,t,i,n)=>{let d;r.append(d=BigWorld.ExplorerElement({type:"item",name:MSG(e.name),on:{tap:()=>{BigWorld.GO_NEW_WIN("item/"+e.id)},touchstart:t=>{l={type:"item",id:e.id,name:MSG(e.name),startLeft:t.getLeft(),startTop:t.getTop()}},contextmenu:t=>{u(t,()=>{BigWorld.SelectFolderPopup(t=>{p("item",e.id,t)})},()=>{BigWorld.ValidPrompt({title:"아이템 정보 변경",inputName:"objectPart",placeholder:"오브젝트 파트",value:e.objectPart,inputName2:"name.ko",placeholder2:"아이템 이름",value2:e.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(t,o,i,n)=>{""===t.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===o.trim()?SkyDesktop.Alert({msg:"변경할 아이템 이름을 입력해주세요."}):BigWorld.ItemModel.update({id:e.id,objectPart:t,name:{ko:o}},{notValid:i,success:n})})},()=>{SkyDesktop.Confirm({msg:"정말 아이템을 삭제하시겠습니까?"},()=>{let t=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(e.id,()=>{t.done()})})})}}})),t(e=>{e.folderId!==(o===TO_DELETE?void 0:o)?(n(),d.remove()):d.changeName(MSG(e.name))}),i(()=>{d.remove()})},success:e}))}}])});let m=EVENT("touchmove",e=>{void 0===d?void 0!==l&&(Math.abs(l.startLeft-e.getLeft())>5||Math.abs(l.startTop-e.getTop())>5)&&(d=DIV({style:{position:"fixed",left:e.getLeft()+10,top:e.getTop()+10},c:l.name}).appendTo(BODY)):d.addStyle({left:e.getLeft()+10,top:e.getTop()+10})}),T=EVENT("touchend",()=>{void 0!==d&&(d.remove(),d=void 0),void 0!==l&&(l=void 0)});e.on("close",()=>{f.remove(),EACH(a,e=>{e()}),m.remove(),T.remove()})}}),BigWorld.ItemEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 아이템 에디터");let o,i,n,r,d,l,c,a,s,p,u,g=BigWorld.STORE("itemEditorStore"),f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/object.png")}),title:"대상 오브젝트",on:{tap:()=>{BigWorld.GO_NEW_WIN("object/"+n.objectId)}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"아이템 정보 변경",inputName:"objectPart",placeholder:"오브젝트 파트",value:n.objectPart,inputName2:"name.ko",placeholder2:"아이템 이름",value2:n.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o,i)=>{""===e.trim()?SkyDesktop.Alert({msg:"오브젝트 파트를 입력해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"변경할 아이템 이름을 입력해주세요."}):(n.objectPart=e,n.name.ko=t,m(),i(),T())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};n.kinds.push(t),m(),k(n.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("itemeditor/menu/remove.png")}),title:"아이템 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"아이템을 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("itemeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:c=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("itemeditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("itemeditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:p=DIV({style:{padding:10}})})]})})})]}).appendTo(BODY),m=()=>{if(void 0!==n){let e=SkyDesktop.LoadingBar("lime");BigWorld.ItemModel.update(n,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"아이템을 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("아이템을 저장했습니다.")}}),void 0!==u&&u.refresh()}},T=()=>{if(p.empty(),void 0!==r&&void 0!==d){p.append(H3({c:MSG(n.name)+" / 선택된 종류: "+MSG(n.kinds[r].name)+" / 선택된 상태: "+MSG(i.states[d].name)})),p.append(u=BigWorld.SectionEditor({mode:"item",style:{flt:"left",marginTop:10},changeDirection:e=>{e.changeDirection(e)},save:m,refresh:(e,t)=>{let o;e.append(o=BigWorld.Object({objectData:i,kind:0,state:d,direction:t})),o.attachItem({id:n.id,item:BigWorld.Item({itemData:n,kind:r})})}})),p.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:g.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());g.save({name:"scale",value:o}),u.setScale(o),u.refresh()}}})),p.append(CLEAR_BOTH()),void 0!=g.get("scale")&&u.setScale(g.get("scale"));let e;p.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:n.states,state:d,kind:r,save:m})),e.changeDirection(u.getDirection())}},k=(e,t)=>{let o;return l.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==a&&a.deselect(),o.select(),a=o,r=e,T()},contextmenu:e=>{let i=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("itemeditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},m(),o.setTitle(MSG(t.name)),n())}),i.remove()}}}),n.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("itemeditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:n.kinds,value:t});n.kinds.splice(e,1),EACH(n.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),m(),l.removeItem(e),r===e&&(r=0,T())}),i.remove()}}})]});e.stop()}}})}),o};l.open(),c.open(),e.on("paramsChange",e=>{o=e.itemId,a=void 0,s=void 0,l.removeAllItems(),c.removeAllItems(),p.empty(),BigWorld.ItemModel.get(o,e=>{n=e,EACH(e.kinds,(e,t)=>{k(t,e)}),l.getItem(0).tap(),BigWorld.ObjectModel.get(e.objectId,e=>{i=e,EACH(e.states,(e,t)=>{let o;c.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name)+" ("+t+")",on:{tap:()=>{void 0!==s&&s.deselect(),o.select(),s=o,d=t,T()}}})})}),EACH(e.states,(e,t)=>{return c.getItem(t).tap(),!1})})})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{f.remove()})}}),BigWorld.MapEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 맵 에디터");let o,i,n,r,d,l,c,a,s,p,u,g,f,m,T,k,I,h,B=BigWorld.STORE("mapEditorStore"),y={},v="down",W=void 0===B.get("brushSize")?1:B.get("brushSize"),S=B.get("reverseType"),E=[],M=[],D=DIV({c:[p=UUI.PANEL({style:{position:"fixed",left:0,top:0,height:"100%",overflowY:"auto",backgroundColor:"rgba(0, 0, 0, 0.6)"},contentStyle:{width:200,padding:10,paddingBottom:200},c:[u=H1(),DIV({style:{marginTop:10},c:["스케일: ",g=INPUT({style:{width:30,textAlign:"right"},on:{change:(e,t)=>{let i=REAL(t.getValue());B.save({name:o+".scale",value:i})}}})]}),DIV({style:{marginTop:10},c:[DIV({style:{marginTop:4,flt:"left"},c:["Col: ",f=INPUT({style:{width:30,textAlign:"right"}})," Row: ",m=INPUT({style:{width:30,textAlign:"right"}})]}),SkyDesktop.Button({style:{marginLeft:10,flt:"left",padding:"5px 10px"},title:"이동",on:{tap:()=>{void 0!==s&&s.setPosition({x:-f.getValue()*BigWorld.Tile.getTileWidth()*s.getScaleX(),y:-m.getValue()*BigWorld.Tile.getTileHeight()*s.getScaleY()})}}}),CLEAR_BOTH()]}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},icon:IMG({src:BigWorld.R("mapeditor/tile.png")}),spacing:5,title:"타일 선택",on:{tap:()=>{BigWorld.SelectTilePopup(b)}}}),I=DIV({style:{marginTop:10}}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},icon:IMG({src:BigWorld.R("mapeditor/object.png")}),spacing:5,title:"오브젝트 선택",on:{tap:()=>{BigWorld.SelectObjectPopup(N)}}}),h=DIV({style:{marginTop:10}})]})]}).appendTo(BODY),C=()=>{I.empty(),h.empty(),n=void 0,r=void 0,d=void 0,l=void 0,y={},c=void 0,a=void 0,v="down",void 0!==s&&s.removeCursorNode()},b=(e,t)=>{C(),n=e;let i,d,l=()=>{if(void 0!==s){let e;s.setCursorNode({node:e=SkyEngine.Node({x:-999999,y:-999999}),moveType:"tile"});for(let t=0;t<W;t+=1)for(let o=W-t-1;o<W;o+=1)e.append(SkyEngine.Rect({x:(o-W+1)*BigWorld.Tile.getTileWidth(),y:(t-W+1)*BigWorld.Tile.getTileHeight(),width:BigWorld.Tile.getTileWidth(),height:BigWorld.Tile.getTileHeight(),border:1/s.getScaleX()+"px solid #FF0000"}));for(let t=0;t<W-1;t+=1)for(let o=0;o<=t;o+=1)e.append(SkyEngine.Rect({x:(o+1)*BigWorld.Tile.getTileWidth(),y:(t-W+2)*BigWorld.Tile.getTileHeight(),width:BigWorld.Tile.getTileWidth(),height:BigWorld.Tile.getTileHeight(),border:1/s.getScaleX()+"px solid #FF0000"}));for(let t=0;t<W-1;t+=1)for(let o=0;o<W-t-1;o+=1)e.append(SkyEngine.Rect({x:o*BigWorld.Tile.getTileWidth(),y:(t+1)*BigWorld.Tile.getTileHeight(),width:BigWorld.Tile.getTileWidth(),height:BigWorld.Tile.getTileHeight(),border:1/s.getScaleX()+"px solid #FF0000"}));for(let t=0;t<W-1;t+=1)for(let o=0;o<W-t-2;o+=1)e.append(SkyEngine.Rect({x:(-o-1)*BigWorld.Tile.getTileWidth(),y:(t+1)*BigWorld.Tile.getTileHeight(),width:BigWorld.Tile.getTileWidth(),height:BigWorld.Tile.getTileHeight(),border:1/s.getScaleX()+"px solid #FF0000"}))}};I.append(DIV({c:[H2({c:t}),i=SkyEngine.SubScreen({style:{marginTop:10,backgroundColor:"#666",color:"#fff"},width:200,height:200,scale:200/BigWorld.Tile.getTileWidth()/3}),DIV({style:{marginTop:10},c:["브러쉬 크기: ",INPUT({style:{width:30,textAlign:"right"},value:W,on:{keyup:(e,t)=>{W=INTEGER(t.getValue()),W<1&&(W=1),B.save({name:"brushSize",value:W}),l()}}})]}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:d=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Button({style:{marginTop:10,padding:"5px 10px"},title:"이 타일을 기본 타일로",on:{tap:()=>{void 0!==r&&SkyDesktop.Confirm({msg:"정말 기본 타일을 지정하시겠습니까? 기존에 놓아둔 모든 타일이 교체되며, 돌이킬 수 없습니다."},()=>{BigWorld.ValidPrompt({title:"기본 타일 설정",inputName:"colRange",placeholder:"Column 범위",inputName2:"rowRange",placeholder2:"Row 범위"},(e,t,i,d)=>{let l=[];for(let a=-Math.floor((t-1)/2);a<=Math.floor(t/2);a+=1)for(let s=-Math.floor((e-1)/2);s<=Math.floor(e/2);s+=1)l.push({col:s,row:a});let p=UUI.PANEL({style:{zIndex:999,position:"fixed",right:10,bottom:10,backgroundColor:"#FFFFCC",color:"#333",borderRadius:5},contentStyle:{padding:"5px 10px"}}).appendTo(BODY);NEXT(l,[(e,t)=>{let i={};EACH(BigWorld.TILE_STATES,e=>{let t=r.states[e];void 0!==t&&(i[e]=[],EACH(t.parts,(t,o)=>{i[e][o]=void 0===c?RANDOM(t.frames.length):c}))}),BigWorld.MapTileModel.put({mapId:o,tileId:n,kindMap:i,col:e.col,row:e.row},()=>{p.empty(),p.append("Column: "+e.col+", Row: "+e.row+" 타일을 저장했습니다."),t()})},()=>{return()=>{p.remove(),SkyDesktop.Noti("기본 타일 지정이 완료되었습니다.")}}]),d()})})}}})]})),d.open(),BigWorld.TileModel.get(e,e=>{r=e;let t,o,n=RAR(()=>{i.empty();let t={};EACH(BigWorld.TILE_STATES,o=>{let i=e.states[o];void 0!==i&&(t[o]=[],EACH(i.parts,(e,i)=>{t[o][i]=void 0===c?RANDOM(e.frames.length):c}))}),BigWorld.Tile({col:0,row:0,tileData:e,kindMap:t}).appendTo(i).draw(),l()});d.addItem({key:-1,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==t&&t.deselect(),o.select(),t=o,c=void 0,n()}}})}),o.tap(),EACH(e.kinds,(e,o)=>{let i;d.addItem({key:o,item:i=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name),on:{tap:()=>{void 0!==t&&t.deselect(),i.select(),t=i,c=o,n()}}})})})})},N=(e,t)=>{C(),d=e;let o,i,n,r,p;h.append(DIV({c:[H2({c:t}),o=SkyEngine.SubScreen({style:{marginTop:10,backgroundColor:"#666",color:"#fff"},width:200,height:200,y:50,scale:200/BigWorld.Tile.getTileWidth()}),UUI.FULL_CHECKBOX({style:{marginTop:10},label:"섹션 단위로 배치",value:B.get("isCursorNodeMoveTypeSection"),on:{change:(e,t)=>{t.getValue()===!0?s.setCursorNodeMoveType("section"):s.setCursorNodeMoveType("pixel"),B.save({name:"isCursorNodeMoveTypeSection",value:t.getValue()})}}}),DIV({style:{marginTop:10},c:["최소 거리: ",T=INPUT({style:{width:40,textAlign:"right"},value:B.get("minObjectDistance"),on:{keyup:(e,t)=>{let o=INTEGER(t.getValue());B.save({name:"minObjectDistance",value:o})}}})," px"]}),DIV({style:{marginTop:5},c:["최대 거리: ",k=INPUT({style:{width:40,textAlign:"right"},value:B.get("maxObjectDistance"),on:{keyup:(e,t)=>{let o=INTEGER(t.getValue());B.save({name:"maxObjectDistance",value:o})}}})," px"]}),UUI.FULL_SELECT({style:{marginTop:10},options:[OPTION({value:"normal",c:"기본"}),OPTION({value:"reverse",c:"반전"}),OPTION({value:"random",c:"랜덤"})],value:S,on:{change:(e,t)=>{B.save({name:"reverseType",value:t.getValue()}),S=t.getValue(),void 0!==p&&p()}}}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({style:{marginTop:10},c:SkyDesktop.FileTree({items:{root:n=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/state.png")}))}}})}})}),SkyDesktop.Tab({style:{marginTop:10},c:DIV({c:[H5({style:{padding:5},c:"아이템"}),r=SkyDesktop.FileTree()]})})]})),i.open(),n.open(),BigWorld.ObjectModel.get(e,t=>{l=t,p=RAR(()=>{o.empty();let e;if(o.append(e=BigWorld.Object({objectData:t,kind:void 0===c?0:c,state:a,direction:v,isReverse:"reverse"===S})),EACH(y,(t,o)=>{e.attachItem({id:o,item:BigWorld.Item({itemData:t.itemData,kind:void 0===t.kind?0:t.kind})})}),void 0!==s){let e=BigWorld.Object({x:-999999,y:-999999,objectData:t,kind:void 0===c?0:c,state:a,direction:v,isReverse:"reverse"===S});EACH(y,(t,o)=>{e.attachItem({id:o,item:BigWorld.Item({itemData:t.itemData,kind:void 0===t.kind?0:t.kind})})}),e.append(BigWorld.SectionMapPreview({sectionMap:t.sectionMap,sectionLevels:t.sectionLevels,direction:v})),s.setCursorNode({node:e,moveType:B.get("isCursorNodeMoveTypeSection")===!0?"section":"pixel"})}});let d,u;i.addItem({key:-1,item:u=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==d&&d.deselect(),u.select(),d=u,c=void 0,p()}}})}),u.tap(),EACH(t.kinds,(e,t)=>{let o;i.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name),on:{tap:()=>{void 0!==d&&d.deselect(),o.select(),d=o,c=t,p()}}})})});let g;EACH(t.states,(e,t)=>{let o;n.addItem({key:t,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(e.name)+" ("+t+")",on:{tap:()=>{void 0!==g&&g.deselect(),o.select(),g=o,a=t,p()}}})}),void 0===g&&o.tap()}),BigWorld.ItemModel.find({objectId:e},e=>{let t=[];EACH(e,e=>{CHECK_IS_IN({array:t,value:e.objectPart})!==!0&&t.push(e.objectPart)});let o={};EACH(t,t=>{let i;r.addItem({key:t,item:i=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/part.png")}),title:t,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/part.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/part.png")}))}}})}),i.open(),EACH(e,e=>{if(e.objectPart===t){let n,r=0;i.addItem({key:t,item:n=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("mapeditor/item.png")}),title:MSG(e.name),on:{tap:()=>{void 0!==y[e.id]?(delete y[e.id],n.deselect(),n.close()):(EACH(y,(e,o)=>{e.itemData.objectPart===t&&delete y[o]}),y[e.id]={itemData:e,kind:r},n.select(),n.open()),p()},open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/item.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("mapeditor/item.png")}))}}})}),o[e.id]=n;let d,l;n.addItem({key:-1,item:l=SkyDesktop.File({style:{cursor:"pointer"},title:"종류 랜덤 선택",on:{tap:()=>{void 0!==d&&d.deselect(),l.select(),d=l,r=void 0,void 0!==y[e.id]&&delete y[e.id].kind,p()}}})}),l.tap(),EACH(e.kinds,(t,o)=>{let i;n.addItem({key:o,item:i=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==d&&d.deselect(),i.select(),d=i,r=o,void 0!==y[e.id]&&(y[e.id].kind=r),p()}}})})})}})})})})};e.on("paramsChange",e=>{o=e.mapId,void 0!==s&&(s.remove(),s=void 0),BigWorld.MapModel.get(o,e=>{i=e,s=BigWorld.Map({mapData:e,scale:B.get(o+".scale"),x:B.get(o+".x"),y:B.get(o+".y"),isMovable:!0,isZoomable:!0,isToShowGrid:!0,changeScale:e=>{g.setValue(e.toFixed(2))},movePosition:(e,t)=>{B.save({name:o+".x",value:e}),B.save({name:o+".y",value:t})},pickPosition:(e,t,i,p,u,g)=>{if(void 0!==n){let e=[],t=[],i=[];for(let d=0;d<W;d+=1)for(let l=W-d-1;l<W;l+=1)t.push(l-W+1),i.push(d-W+1);for(let d=0;d<W-1;d+=1)for(let l=0;l<=d;l+=1)t.push(l+1),i.push(d-W+2);for(let d=0;d<W-1;d+=1)for(let l=0;l<W-d-1;l+=1)t.push(l),i.push(d+1);for(let d=0;d<W-1;d+=1)for(let l=0;l<W-d-2;l+=1)t.push(-l-1),i.push(d+1);for(let d=0;d<t.length;d+=1){let o=u+t[d],n=g+i[d],l={};EACH(BigWorld.TILE_STATES,e=>{let t=r.states[e];void 0!==t&&(l[e]=[],EACH(t.parts,(t,o)=>{l[e][o]=void 0===c?0:c}))});let a=BigWorld.Tile({alpha:.5,col:o,row:n,tileData:r,kindMap:l}).appendTo(s.getTileWrapper());a.draw(),E.push(a),e.push(a)}BigWorld.TileModel.get(n,r=>{let d={};EACH(BigWorld.TILE_STATES,e=>{let t=r.states[e];void 0!==t&&(d[e]=[],EACH(t.parts,(t,o)=>{d[e][o]=void 0===c?RANDOM(t.frames.length):c}))});for(let l=0;l<t.length;l+=1){let r=u+t[l],c=g+i[l];BigWorld.MapTileModel.put({mapId:o,tileId:n,kindMap:d,col:r,row:c},()=>{EACH(e,e=>{REMOVE({array:E,value:e}),e.remove()}),e=void 0})}})}else if(void 0!==d){let n;"reverse"===S?n=!0:"random"===S&&(n=0===RANDOM(2)||void 0);let r=B.get("minObjectDistance");(void 0===r||r<1)&&(r=1);let u=B.get("maxObjectDistance");(void 0===u||u<r)&&(u=r);let g,f=RANDOM({min:r,max:u}),m=BigWorld.Object({alpha:0,objectData:l,kind:void 0===c?0:c,state:a,direction:v,x:e,y:t,isReverse:n}).appendTo(s);EACH(M,e=>{if(Math.sqrt(Math.pow(m.getX()-e.getX(),2)+Math.pow(m.getY()-e.getY(),2))<f||e.checkCollision(m)===!0)return g=e,!1});let T=s.getNearObject(m);if(void 0===g&&(void 0===T||Math.sqrt(Math.pow(m.getX()-T.getX(),2)+Math.pow(m.getY()-T.getY(),2))>=f)&&void 0===s.getCollidedObject(m)){B.get("isCursorNodeMoveTypeSection")===!0&&(e=i*CONFIG.BigWorld.sectionWidth,t=p*CONFIG.BigWorld.sectionHeight);let r=BigWorld.Object({alpha:.5,objectData:l,kind:void 0===c?0:c,state:a,direction:v,x:e,y:t,isReverse:n}).appendTo(s);M.push(r),BigWorld.ObjectModel.get(d,i=>{let l=[];NEXT(y,[(e,t,o)=>{BigWorld.ItemModel.get(o,i=>{l.push({id:o,kind:void 0===e.kind?RANDOM(i.kinds.length):e.kind}),t()})},()=>{return()=>{BigWorld.MapObjectModel.create({mapId:o,objectId:d,kind:void 0===c?RANDOM(i.kinds.length):c,state:a,items:l,direction:v,x:e,y:t,isReverse:n},()=>{DELAY(.5,()=>{REMOVE({array:M,value:r}),r.remove()})})}}])})}m.remove()}},contextmenu:(e,t,o,i,n,r,d)=>{let l=s.findMapTileId({col:r,row:d}),c=s.findMapObjectId({x:t,y:o});if(void 0!==c){let t=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"오브젝트 제거",icon:IMG({src:BigWorld.R("mapeditor/remove.png")}),on:{tap:()=>{BigWorld.MapObjectModel.remove(c),t.remove()}}})]})}else if(void 0!==l){let t=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"타일 제거",icon:IMG({src:BigWorld.R("mapeditor/remove.png")}),on:{tap:()=>{BigWorld.MapTileModel.remove(l),t.remove()}}})]})}e.stop()}}).appendTo(SkyEngine.Screen),u.empty(),u.append(MSG(e.name)),g.setValue(s.getScaleX())})});let R=EVENT("keydown",e=>{"Escape"===e.getKey()&&C(),"Control"===e.getKey()&&void 0!==s&&s.turnOnPlaceMode(),"`"===e.getKey()&&void 0!==s&&s.showGridNumber()}),x=EVENT("keyup",e=>{"Control"===e.getKey()&&void 0!==s&&s.turnOffPlaceMode(),"`"===e.getKey()&&void 0!==s&&s.hideGridNumber()});e.on("close",()=>{void 0!==s&&s.remove(),R.remove(),x.remove(),D.remove()})}}),BigWorld.ObjectEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 오브젝트 에디터");let o,i,n,r,d,l,c,a,s,p,u=BigWorld.STORE("objectEditorStore"),g=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"오브젝트 이름 변경",inputName:"name.ko",placeholder:"오브젝트 이름",value:i.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 오브젝트 이름을 입력해주세요."}):(i.name.ko=e,f(),o(),m())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};i.kinds.push(t),f(),T(i.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/state.png")}),title:"상태 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"상태 추가",inputName:"id",placeholder:"상태 ID (추후 변경 불가)",inputName2:"name.ko",placeholder2:"상태 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o,n)=>{
""===e.trim()?SkyDesktop.Alert({msg:"추가할 상태 ID를 입력해주세요."}):""===t.trim()?SkyDesktop.Alert({msg:"추가할 상태 이름을 입력해주세요."}):SkyDesktop.Confirm({msg:"상태는 추가 후 삭제가 불가능합니다. 또한 상태 ID는 추후 변경이 불가능합니다. 계속하시겠습니까?"},()=>{let o={name:{ko:t},parts:[]};i.states[e]=o,f(),k(e,o),n()})})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("objecteditor/menu/remove.png")}),title:"오브젝트 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"오브젝트를 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:d=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("objecteditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("objecteditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("objecteditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:s=DIV({style:{padding:10}})})]})})})]}).appendTo(BODY),f=()=>{if(void 0!==i){let e=SkyDesktop.LoadingBar("lime");BigWorld.ObjectModel.update(i,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"오브젝트를 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("오브젝트를 저장했습니다.")}}),void 0!==p&&p.refresh()}},m=()=>{if(s.empty(),void 0!==n&&void 0!==r){s.append(H3({c:MSG(i.name)+" / 선택된 종류: "+MSG(i.kinds[n].name)+" / 선택된 상태: "+MSG(i.states[r].name)})),s.append(p=BigWorld.SectionEditor({mode:"object",style:{flt:"left",marginTop:10},sectionLevels:i.sectionLevels,sectionMap:i.sectionMap,touchAreaInfo:i.touchArea,changeDirection:e=>{e.changeDirection(e)},save:f,refresh:(e,t)=>{e.append(BigWorld.Object({objectData:i,kind:n,state:r,direction:t}))}})),s.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:u.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());u.save({name:"scale",value:o}),p.setScale(o),p.refresh()}}})),s.append(CLEAR_BOTH()),void 0!=u.get("scale")&&p.setScale(u.get("scale"));let e;s.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:i.states,state:r,kind:n,save:f})),e.changeDirection(p.getDirection())}},T=(e,t)=>{let o;return d.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==c&&c.deselect(),o.select(),c=o,n=e,m()},contextmenu:e=>{let r=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},f(),o.setTitle(MSG(t.name)),n())}),r.remove()}}}),i.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("objecteditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:i.kinds,value:t});i.kinds.splice(e,1),EACH(i.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),f(),d.removeItem(e),n===e&&(n=0,m())}),r.remove()}}})]});e.stop()}}})}),o},k=(e,t)=>{let o;return l.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name)+" ("+e+")",on:{tap:()=>{void 0!==a&&a.deselect(),o.select(),a=o,r=e,m()},contextmenu:i=>{let n=SkyDesktop.ContextMenu({e:i,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("objecteditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"상태 수정",inputName:"name.ko",placeholder:"상태 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(i,n,r)=>{""===i.trim()?SkyDesktop.Alert({msg:"상태 이름을 입력해주세요."}):(t.name={ko:i},f(),o.setTitle(MSG(t.name)+" ("+e+")"),r())}),n.remove()}}})]});i.stop()}}})}),o};d.open(),l.open(),e.on("paramsChange",e=>{o=e.objectId,c=void 0,a=void 0,d.removeAllItems(),l.removeAllItems(),s.empty(),BigWorld.ObjectModel.get(o,e=>{i=e,EACH(e.kinds,(e,t)=>{T(t,e)}),d.getItem(0).tap(),EACH(e.states,(e,t)=>{k(t,e)}),EACH(e.states,(e,t)=>{return l.getItem(t).tap(),!1})})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{g.remove()})}}),BigWorld.TileEditor=CLASS({preset:()=>{return VIEW},init:(e,t)=>{TITLE("BigWorld 타일 에디터");let o,i,n,r,d,l,c,a,s,p,u,g=BigWorld.STORE("tileEditorStore"),f=TABLE({style:{position:"absolute",width:"100%",height:"100%"},c:[TR({c:TD({style:{height:28},c:SkyDesktop.Toolbar({buttons:[SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),title:"정보 수정",on:{tap:()=>{BigWorld.ValidPrompt({title:"타일 정보 변경",inputName:"name",placeholder:"타일 이름",value:i.name,errorMsgs:{name:{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"변경 완료"},(e,t,o)=>{""===e.trim()?SkyDesktop.Alert({msg:"변경할 타일 이름을 입력해주세요."}):(i.name=e,m(),o(),T())})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류 추가",on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 추가",inputName:"name.ko",placeholder:"종류 이름",errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"추가"},(e,t,o)=>{if(""===e.trim())SkyDesktop.Alert({msg:"추가할 종류 이름을 입력해주세요."});else{let t={name:{ko:e}};i.kinds.push(t),m(),k(i.kinds.length-1,t).tap(),o()}})}}}),SkyDesktop.ToolbarButton({icon:IMG({src:BigWorld.R("tileeditor/menu/remove.png")}),title:"타일 삭제",on:{tap:()=>{SkyDesktop.Confirm({msg:"타일을 삭제하시겠습니까?",okButtonTitle:"삭제"},()=>{SkyDesktop.LoadingBar("lime");BigWorld.TileModel.remove(o,()=>{close()})})}}})]})})}),TR({style:{height:"100%"},c:TD({c:SkyDesktop.HorizontalTabList({tabs:[SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:d=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/kind.png")}),title:"종류",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/kind.png")}))}}})}})}),SkyDesktop.Tab({size:15,c:SkyDesktop.FileTree({items:{root:l=SkyDesktop.Folder({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/menu/state.png")}),title:"상태",isToNotSort:!0,on:{open:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/state.png")}))},close:(e,t)=>{t.setIcon(IMG({src:BigWorld.R("tileeditor/menu/state.png")}))}}})}})}),SkyDesktop.Tab({size:70,c:s=DIV({style:{padding:10,width:888}})})]})})})]}).appendTo(BODY);d.open(),l.open();let m=()=>{if(void 0!==i){let e=SkyDesktop.LoadingBar("lime");EACH(i.states,e=>{void 0===e.sectionMap&&(e.sectionMap=BigWorld.Tile.getInitSectionMap())}),BigWorld.TileModel.update(i,{notValid:()=>{e.done(),SkyDesktop.Alert({msg:"타일을 저장할 수 없습니다. 데이터를 확인해주시기 바랍니다."})},success:()=>{e.done(),SkyDesktop.Noti("타일을 저장했습니다.")}}),void 0!==p&&(p.refresh(),u.refresh())}},T=()=>{if(s.empty(),void 0!==n&&void 0!==r){s.append(H3({c:i.name+" / 선택된 종류: "+MSG(i.kinds[n].name)+" / 선택된 상태: "+a.getTitle()})),s.append(p=BigWorld.SectionEditor({mode:"tile",style:{flt:"left",marginTop:10},sectionLevels:{left:(CONFIG.BigWorld.tileSectionLevel-1)/2,up:(CONFIG.BigWorld.tileSectionLevel-1)/2,right:(CONFIG.BigWorld.tileSectionLevel-1)/2,down:(CONFIG.BigWorld.tileSectionLevel-1)/2},sectionMap:void 0===i.states[r]?BigWorld.Tile.getInitSectionMap():i.states[r].sectionMap,save:m,refresh:(e,t)=>{let o=i.states[r];void 0!==o&&EACH(o.parts,t=>{let o=t.frames[n];void 0!==o&&e.append(SkyEngine.Sprite({src:BigWorld.RF(o),fps:t.fps,frameCount:t.frameCount,zIndex:t.zIndex,x:t.x,y:t.y}))})}})),s.append(u=BigWorld.TilePreview({style:{flt:"left",marginLeft:10,marginTop:10},refresh:(e,t)=>{let o={};EACH(BigWorld.TILE_STATES,e=>{let t=i.states[e];void 0!==t&&(o[e]=[],EACH(t.parts,(t,i)=>{o[e][i]=n}))}),BigWorld.Tile({col:0,row:0,tileData:i,kindMap:o}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:0,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-2,tileData:i,kindMap:o,topTileId:i.id,rightTopTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:-3,tileData:i,kindMap:o,rightTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-2,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id,leftBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-1,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:0,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:1,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:2,row:-3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id,rightBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-3,tileData:i,kindMap:o,leftTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-2,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id,leftTopTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:-1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:0,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:2,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id,leftBottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:3,row:3,tileData:i,kindMap:o,topTileId:i.id,leftTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:2,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTopTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:1,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:0,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-1,row:3,tileData:i,kindMap:o,leftTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-2,row:3,tileData:i,kindMap:o,leftTileId:i.id,leftTopTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:3,tileData:i,kindMap:o,topTileId:i.id,rightTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:2,tileData:i,kindMap:o,topTileId:i.id,rightBottomTileId:i.id,bottomTileId:i.id}).appendTo(e).draw(),BigWorld.Tile({col:-3,row:1,tileData:i,kindMap:o,topTileId:i.id,bottomTileId:i.id}).appendTo(e).draw()}})),s.append(UUI.FULL_INPUT({style:{marginLeft:10,marginTop:10,flt:"left",width:30},value:g.get("scale"),placeholder:"배율",on:{change:(e,t)=>{let o=REAL(t.getValue());g.save({name:"scale",value:o}),p.setScale(o),p.refresh(),u.setScale(o),u.refresh()}}})),s.append(CLEAR_BOTH()),void 0!=g.get("scale")&&(p.setScale(g.get("scale")),u.setScale(g.get("scale")));let e;s.append(e=BigWorld.PartsEditor({style:{marginTop:10},stateInfos:i.states,state:r,kind:n,save:m}));let t=i.states[r];void 0!==t&&EACH(t.parts,e.addPartEditor)}},k=(e,t)=>{let o;return d.addItem({key:e,item:o=SkyDesktop.File({style:{cursor:"pointer"},title:MSG(t.name),on:{tap:()=>{void 0!==c&&c.deselect(),o.select(),c=o,n=e,T()},contextmenu:e=>{let r=SkyDesktop.ContextMenu({e:e,c:[SkyDesktop.ContextMenuItem({title:"정보 수정",icon:IMG({src:BigWorld.R("tileeditor/menu/edit.png")}),on:{tap:()=>{BigWorld.ValidPrompt({title:"종류 수정",inputName:"name.ko",placeholder:"종류 이름",value:t.name.ko,errorMsgs:{"name.ko":{size:e=>{return"최대 "+e.max+"글자입니다."}}},okButtonTitle:"수정"},(e,i,n)=>{""===e.trim()?SkyDesktop.Alert({msg:"종류 이름을 입력해주세요."}):(t.name={ko:e},m(),o.setTitle(MSG(t.name)),n())}),r.remove()}}}),i.kinds.length<=1?void 0:SkyDesktop.ContextMenuItem({title:"종류 삭제",icon:IMG({src:BigWorld.R("tileeditor/menu/remove.png")}),on:{tap:()=>{SkyDesktop.Confirm({msg:"정말 종류를 삭제하시겠습니까?"},()=>{let e=FIND({array:i.kinds,value:t});i.kinds.splice(e,1),EACH(i.states,t=>{EACH(t.parts,t=>{t.frames.splice(e,1)})}),m(),d.removeItem(e),n===e&&(n=0,T())}),r.remove()}}})]});e.stop()}}})}),o};EACH(BigWorld.TILE_STATES,e=>{let t;l.addItem({key:e,item:t=SkyDesktop.File({style:{cursor:"pointer"},icon:IMG({src:BigWorld.R("tileeditor/state/"+e+".png")}),title:e.replace(/([A-Z]+)*([A-Z][a-z])/g,"$1 $2").toLowerCase(),on:{tap:()=>{void 0!==a&&a.deselect(),t.select(),a=t,r=e,T()}}})})}),e.on("paramsChange",e=>{o=e.tileId,c=void 0,d.removeAllItems(),s.empty(),BigWorld.TileModel.get(o,e=>{i=e,EACH(e.kinds,(e,t)=>{k(t,e)}),d.getItem(0).tap(),l.getItem("center").tap()})}),DELAY(.2,()=>{EVENT.fireAll("resize")}),e.on("close",()=>{f.remove()})}});